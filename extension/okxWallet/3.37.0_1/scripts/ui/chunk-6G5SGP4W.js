import{e as ni,f as va}from"./chunk-SAG4ZEZI.js";import{a as jp,b as Et}from"./chunk-WAUW7WG4.js";import{e as Oa}from"./chunk-PF2X6IYY.js";import{I as Ta,Q as Ia,d as ga,m as Sa,n as ya,v as ma,w as wa,x as ba,z as Ea}from"./chunk-67OZVYSW.js";import{a as gn,c as Ne}from"./chunk-Z6RMGQXT.js";import{e as Qt}from"./chunk-BLEQOMHN.js";import{e as vr,h as _a,k as ri}from"./chunk-SEXC6U4O.js";import{b as U,d as Ss}from"./chunk-IV5YQZMD.js";import{b as na,f as ia,i as _n,k as sa}from"./chunk-BNWEXJ7R.js";import{a as ti,d as ha,f as da}from"./chunk-RCQMEJEP.js";import{Ec as la,Fc as pa,Na as Zt,Xa as bt,Ya as gs,Z as aa,m as oa,ob as ca,pb as fa,r as $t,xa as ua}from"./chunk-WTBIP24L.js";import{k as ei}from"./chunk-HWYDZOOB.js";import{A as _s,H as Jn,I as ra,g as hn,o as dn,y as ds}from"./chunk-PLHFXPVU.js";import{C as ls,F as wt,T as $o,a as Lr,aa as pn,d as Yo,ga as Zo,j as W,ka as Qo,pa as Yt}from"./chunk-5BQQ5BTM.js";import{D as Qn,M as ea,N as Ur,a as $n,b as Ir,c as Zn,v as Jo}from"./chunk-4IQZG47E.js";import{A as ta,T as ps,Z as hs,ca as Ae}from"./chunk-X62Q7VCJ.js";import{a as je}from"./chunk-WQYVBC56.js";import{b as ke}from"./chunk-SGN6V33I.js";import{N as qp,d as fs,e as Kp}from"./chunk-METSMHFB.js";import{c as T,f as le,h as I,l as process,m as h,n as f,o as d}from"./chunk-CS4SUKWE.js";var En=T(Ce=>{"use strict";h();d();var ch=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function fh(e,t){return Object.prototype.hasOwnProperty.call(e,t)}Ce.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(!!r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(var n in r)fh(r,n)&&(e[n]=r[n])}}return e};Ce.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var lh={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray){e.set(t.subarray(r,r+n),i);return}for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){var t,r,n,i,s,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)s=e[t],o.set(s,i),i+=s.length;return o}},ph={arraySet:function(e,t,r,n,i){for(var s=0;s<n;s++)e[i+s]=t[r+s]},flattenChunks:function(e){return[].concat.apply([],e)}};Ce.setTyped=function(e){e?(Ce.Buf8=Uint8Array,Ce.Buf16=Uint16Array,Ce.Buf32=Int32Array,Ce.assign(Ce,lh)):(Ce.Buf8=Array,Ce.Buf16=Array,Ce.Buf32=Array,Ce.assign(Ce,ph))};Ce.setTyped(ch)});var Ya=T((sT,za)=>{"use strict";h();d();function hh(e,t,r,n){for(var i=e&65535|0,s=e>>>16&65535|0,o=0;r!==0;){o=r>2e3?2e3:r,r-=o;do i=i+t[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}za.exports=hh});var Za=T((uT,$a)=>{"use strict";h();d();function dh(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;t[r]=e}return t}var _h=dh();function gh(e,t,r,n){var i=_h,s=n+r;e^=-1;for(var o=n;o<s;o++)e=e>>>8^i[(e^t[o])&255];return e^-1}$a.exports=gh});var Ja=T((lT,Qa)=>{"use strict";h();d();var li=30,Sh=12;Qa.exports=function(t,r){var n,i,s,o,a,l,u,c,p,_,g,S,y,m,w,A,v,E,b,B,F,x,j,ie,R;n=t.state,i=t.next_in,ie=t.input,s=i+(t.avail_in-5),o=t.next_out,R=t.output,a=o-(r-t.avail_out),l=o+(t.avail_out-257),u=n.dmax,c=n.wsize,p=n.whave,_=n.wnext,g=n.window,S=n.hold,y=n.bits,m=n.lencode,w=n.distcode,A=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{y<15&&(S+=ie[i++]<<y,y+=8,S+=ie[i++]<<y,y+=8),E=m[S&A];t:for(;;){if(b=E>>>24,S>>>=b,y-=b,b=E>>>16&255,b===0)R[o++]=E&65535;else if(b&16){B=E&65535,b&=15,b&&(y<b&&(S+=ie[i++]<<y,y+=8),B+=S&(1<<b)-1,S>>>=b,y-=b),y<15&&(S+=ie[i++]<<y,y+=8,S+=ie[i++]<<y,y+=8),E=w[S&v];r:for(;;){if(b=E>>>24,S>>>=b,y-=b,b=E>>>16&255,b&16){if(F=E&65535,b&=15,y<b&&(S+=ie[i++]<<y,y+=8,y<b&&(S+=ie[i++]<<y,y+=8)),F+=S&(1<<b)-1,F>u){t.msg="invalid distance too far back",n.mode=li;break e}if(S>>>=b,y-=b,b=o-a,F>b){if(b=F-b,b>p&&n.sane){t.msg="invalid distance too far back",n.mode=li;break e}if(x=0,j=g,_===0){if(x+=c-b,b<B){B-=b;do R[o++]=g[x++];while(--b);x=o-F,j=R}}else if(_<b){if(x+=c+_-b,b-=_,b<B){B-=b;do R[o++]=g[x++];while(--b);if(x=0,_<B){b=_,B-=b;do R[o++]=g[x++];while(--b);x=o-F,j=R}}}else if(x+=_-b,b<B){B-=b;do R[o++]=g[x++];while(--b);x=o-F,j=R}for(;B>2;)R[o++]=j[x++],R[o++]=j[x++],R[o++]=j[x++],B-=3;B&&(R[o++]=j[x++],B>1&&(R[o++]=j[x++]))}else{x=o-F;do R[o++]=R[x++],R[o++]=R[x++],R[o++]=R[x++],B-=3;while(B>2);B&&(R[o++]=R[x++],B>1&&(R[o++]=R[x++]))}}else if((b&64)===0){E=w[(E&65535)+(S&(1<<b)-1)];continue r}else{t.msg="invalid distance code",n.mode=li;break e}break}}else if((b&64)===0){E=m[(E&65535)+(S&(1<<b)-1)];continue t}else if(b&32){n.mode=Sh;break e}else{t.msg="invalid literal/length code",n.mode=li;break e}break}}while(i<s&&o<l);B=y>>3,i-=B,y-=B<<3,S&=(1<<y)-1,t.next_in=i,t.next_out=o,t.avail_in=i<s?5+(s-i):5-(i-s),t.avail_out=o<l?257+(l-o):257-(o-l),n.hold=S,n.bits=y}});var ou=T((dT,su)=>{"use strict";h();d();var eu=En(),Mr=15,tu=852,ru=592,nu=0,Os=1,iu=2,yh=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],mh=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],wh=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],bh=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];su.exports=function(t,r,n,i,s,o,a,l){var u=l.bits,c=0,p=0,_=0,g=0,S=0,y=0,m=0,w=0,A=0,v=0,E,b,B,F,x,j=null,ie=0,R,He=new eu.Buf16(Mr+1),P=new eu.Buf16(Mr+1),fe=null,ze=0,Er,Tr,Br;for(c=0;c<=Mr;c++)He[c]=0;for(p=0;p<i;p++)He[r[n+p]]++;for(S=u,g=Mr;g>=1&&He[g]===0;g--);if(S>g&&(S=g),g===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,l.bits=1,0;for(_=1;_<g&&He[_]===0;_++);for(S<_&&(S=_),w=1,c=1;c<=Mr;c++)if(w<<=1,w-=He[c],w<0)return-1;if(w>0&&(t===nu||g!==1))return-1;for(P[1]=0,c=1;c<Mr;c++)P[c+1]=P[c]+He[c];for(p=0;p<i;p++)r[n+p]!==0&&(a[P[r[n+p]]++]=p);if(t===nu?(j=fe=a,R=19):t===Os?(j=yh,ie-=257,fe=mh,ze-=257,R=256):(j=wh,fe=bh,R=-1),v=0,p=0,c=_,x=o,y=S,m=0,B=-1,A=1<<S,F=A-1,t===Os&&A>tu||t===iu&&A>ru)return 1;for(;;){Er=c-m,a[p]<R?(Tr=0,Br=a[p]):a[p]>R?(Tr=fe[ze+a[p]],Br=j[ie+a[p]]):(Tr=32+64,Br=0),E=1<<c-m,b=1<<y,_=b;do b-=E,s[x+(v>>m)+b]=Er<<24|Tr<<16|Br|0;while(b!==0);for(E=1<<c-1;v&E;)E>>=1;if(E!==0?(v&=E-1,v+=E):v=0,p++,--He[c]===0){if(c===g)break;c=r[n+a[p]]}if(c>S&&(v&F)!==B){for(m===0&&(m=S),x+=_,y=c-m,w=1<<y;y+m<g&&(w-=He[y+m],!(w<=0));)y++,w<<=1;if(A+=1<<y,t===Os&&A>tu||t===iu&&A>ru)return 1;B=v&F,s[B]=S<<24|y<<16|x-o|0}}return v!==0&&(s[x+v]=c-m<<24|64<<16|0),l.bits=S,0}});var Ku=T(_t=>{"use strict";h();d();var We=En(),xs=Ya(),vt=Za(),Eh=Ja(),Tn=ou(),Th=0,xu=1,Ru=2,au=4,Ih=5,pi=6,Pr=0,vh=1,Oh=2,$e=-2,Hu=-3,Rs=-4,Ph=-5,uu=8,Bu=1,cu=2,fu=3,lu=4,pu=5,hu=6,du=7,_u=8,gu=9,Su=10,_i=11,Ft=12,Ps=13,yu=14,As=15,mu=16,wu=17,bu=18,Eu=19,hi=20,di=21,Tu=22,Iu=23,vu=24,Ou=25,Pu=26,ks=27,Au=28,ku=29,te=30,Hs=31,Ah=32,kh=852,Nh=592,Ch=15,xh=Ch;function Nu(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function Rh(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new We.Buf16(320),this.work=new We.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Lu(e){var t;return!e||!e.state?$e:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=Bu,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new We.Buf32(kh),t.distcode=t.distdyn=new We.Buf32(Nh),t.sane=1,t.back=-1,Pr)}function Uu(e){var t;return!e||!e.state?$e:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,Lu(e))}function Mu(e,t){var r,n;return!e||!e.state||(n=e.state,t<0?(r=0,t=-t):(r=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15))?$e:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,Uu(e))}function Du(e,t){var r,n;return e?(n=new Rh,e.state=n,n.window=null,r=Mu(e,t),r!==Pr&&(e.state=null),r):$e}function Hh(e){return Du(e,xh)}var Cu=!0,Ns,Cs;function Bh(e){if(Cu){var t;for(Ns=new We.Buf32(512),Cs=new We.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Tn(xu,e.lens,0,288,Ns,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Tn(Ru,e.lens,0,32,Cs,0,e.work,{bits:5}),Cu=!1}e.lencode=Ns,e.lenbits=9,e.distcode=Cs,e.distbits=5}function Fu(e,t,r,n){var i,s=e.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new We.Buf8(s.wsize)),n>=s.wsize?(We.arraySet(s.window,t,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),We.arraySet(s.window,t,r-n,i,s.wnext),n-=i,n?(We.arraySet(s.window,t,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function Lh(e,t){var r,n,i,s,o,a,l,u,c,p,_,g,S,y,m=0,w,A,v,E,b,B,F,x,j=new We.Buf8(4),ie,R,He=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return $e;r=e.state,r.mode===Ft&&(r.mode=Ps),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,n=e.input,a=e.avail_in,u=r.hold,c=r.bits,p=a,_=l,x=Pr;e:for(;;)switch(r.mode){case Bu:if(r.wrap===0){r.mode=Ps;break}for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(r.wrap&2&&u===35615){r.check=0,j[0]=u&255,j[1]=u>>>8&255,r.check=vt(r.check,j,2,0),u=0,c=0,r.mode=cu;break}if(r.flags=0,r.head&&(r.head.done=!1),!(r.wrap&1)||(((u&255)<<8)+(u>>8))%31){e.msg="incorrect header check",r.mode=te;break}if((u&15)!==uu){e.msg="unknown compression method",r.mode=te;break}if(u>>>=4,c-=4,F=(u&15)+8,r.wbits===0)r.wbits=F;else if(F>r.wbits){e.msg="invalid window size",r.mode=te;break}r.dmax=1<<F,e.adler=r.check=1,r.mode=u&512?Su:Ft,u=0,c=0;break;case cu:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(r.flags=u,(r.flags&255)!==uu){e.msg="unknown compression method",r.mode=te;break}if(r.flags&57344){e.msg="unknown header flags set",r.mode=te;break}r.head&&(r.head.text=u>>8&1),r.flags&512&&(j[0]=u&255,j[1]=u>>>8&255,r.check=vt(r.check,j,2,0)),u=0,c=0,r.mode=fu;case fu:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.head&&(r.head.time=u),r.flags&512&&(j[0]=u&255,j[1]=u>>>8&255,j[2]=u>>>16&255,j[3]=u>>>24&255,r.check=vt(r.check,j,4,0)),u=0,c=0,r.mode=lu;case lu:for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.head&&(r.head.xflags=u&255,r.head.os=u>>8),r.flags&512&&(j[0]=u&255,j[1]=u>>>8&255,r.check=vt(r.check,j,2,0)),u=0,c=0,r.mode=pu;case pu:if(r.flags&1024){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.length=u,r.head&&(r.head.extra_len=u),r.flags&512&&(j[0]=u&255,j[1]=u>>>8&255,r.check=vt(r.check,j,2,0)),u=0,c=0}else r.head&&(r.head.extra=null);r.mode=hu;case hu:if(r.flags&1024&&(g=r.length,g>a&&(g=a),g&&(r.head&&(F=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),We.arraySet(r.head.extra,n,s,g,F)),r.flags&512&&(r.check=vt(r.check,n,g,s)),a-=g,s+=g,r.length-=g),r.length))break e;r.length=0,r.mode=du;case du:if(r.flags&2048){if(a===0)break e;g=0;do F=n[s+g++],r.head&&F&&r.length<65536&&(r.head.name+=String.fromCharCode(F));while(F&&g<a);if(r.flags&512&&(r.check=vt(r.check,n,g,s)),a-=g,s+=g,F)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=_u;case _u:if(r.flags&4096){if(a===0)break e;g=0;do F=n[s+g++],r.head&&F&&r.length<65536&&(r.head.comment+=String.fromCharCode(F));while(F&&g<a);if(r.flags&512&&(r.check=vt(r.check,n,g,s)),a-=g,s+=g,F)break e}else r.head&&(r.head.comment=null);r.mode=gu;case gu:if(r.flags&512){for(;c<16;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u!==(r.check&65535)){e.msg="header crc mismatch",r.mode=te;break}u=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Ft;break;case Su:for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}e.adler=r.check=Nu(u),u=0,c=0,r.mode=_i;case _i:if(r.havedict===0)return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,r.hold=u,r.bits=c,Oh;e.adler=r.check=1,r.mode=Ft;case Ft:if(t===Ih||t===pi)break e;case Ps:if(r.last){u>>>=c&7,c-=c&7,r.mode=ks;break}for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}switch(r.last=u&1,u>>>=1,c-=1,u&3){case 0:r.mode=yu;break;case 1:if(Bh(r),r.mode=hi,t===pi){u>>>=2,c-=2;break e}break;case 2:r.mode=wu;break;case 3:e.msg="invalid block type",r.mode=te}u>>>=2,c-=2;break;case yu:for(u>>>=c&7,c-=c&7;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if((u&65535)!==(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=te;break}if(r.length=u&65535,u=0,c=0,r.mode=As,t===pi)break e;case As:r.mode=mu;case mu:if(g=r.length,g){if(g>a&&(g=a),g>l&&(g=l),g===0)break e;We.arraySet(i,n,s,g,o),a-=g,s+=g,l-=g,o+=g,r.length-=g;break}r.mode=Ft;break;case wu:for(;c<14;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(r.nlen=(u&31)+257,u>>>=5,c-=5,r.ndist=(u&31)+1,u>>>=5,c-=5,r.ncode=(u&15)+4,u>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=te;break}r.have=0,r.mode=bu;case bu:for(;r.have<r.ncode;){for(;c<3;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.lens[He[r.have++]]=u&7,u>>>=3,c-=3}for(;r.have<19;)r.lens[He[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ie={bits:r.lenbits},x=Tn(Th,r.lens,0,19,r.lencode,0,r.work,ie),r.lenbits=ie.bits,x){e.msg="invalid code lengths set",r.mode=te;break}r.have=0,r.mode=Eu;case Eu:for(;r.have<r.nlen+r.ndist;){for(;m=r.lencode[u&(1<<r.lenbits)-1],w=m>>>24,A=m>>>16&255,v=m&65535,!(w<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(v<16)u>>>=w,c-=w,r.lens[r.have++]=v;else{if(v===16){for(R=w+2;c<R;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u>>>=w,c-=w,r.have===0){e.msg="invalid bit length repeat",r.mode=te;break}F=r.lens[r.have-1],g=3+(u&3),u>>>=2,c-=2}else if(v===17){for(R=w+3;c<R;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=w,c-=w,F=0,g=3+(u&7),u>>>=3,c-=3}else{for(R=w+7;c<R;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=w,c-=w,F=0,g=11+(u&127),u>>>=7,c-=7}if(r.have+g>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=te;break}for(;g--;)r.lens[r.have++]=F}}if(r.mode===te)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=te;break}if(r.lenbits=9,ie={bits:r.lenbits},x=Tn(xu,r.lens,0,r.nlen,r.lencode,0,r.work,ie),r.lenbits=ie.bits,x){e.msg="invalid literal/lengths set",r.mode=te;break}if(r.distbits=6,r.distcode=r.distdyn,ie={bits:r.distbits},x=Tn(Ru,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ie),r.distbits=ie.bits,x){e.msg="invalid distances set",r.mode=te;break}if(r.mode=hi,t===pi)break e;case hi:r.mode=di;case di:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,r.hold=u,r.bits=c,Eh(e,_),o=e.next_out,i=e.output,l=e.avail_out,s=e.next_in,n=e.input,a=e.avail_in,u=r.hold,c=r.bits,r.mode===Ft&&(r.back=-1);break}for(r.back=0;m=r.lencode[u&(1<<r.lenbits)-1],w=m>>>24,A=m>>>16&255,v=m&65535,!(w<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(A&&(A&240)===0){for(E=w,b=A,B=v;m=r.lencode[B+((u&(1<<E+b)-1)>>E)],w=m>>>24,A=m>>>16&255,v=m&65535,!(E+w<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=E,c-=E,r.back+=E}if(u>>>=w,c-=w,r.back+=w,r.length=v,A===0){r.mode=Pu;break}if(A&32){r.back=-1,r.mode=Ft;break}if(A&64){e.msg="invalid literal/length code",r.mode=te;break}r.extra=A&15,r.mode=Tu;case Tu:if(r.extra){for(R=r.extra;c<R;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Iu;case Iu:for(;m=r.distcode[u&(1<<r.distbits)-1],w=m>>>24,A=m>>>16&255,v=m&65535,!(w<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if((A&240)===0){for(E=w,b=A,B=v;m=r.distcode[B+((u&(1<<E+b)-1)>>E)],w=m>>>24,A=m>>>16&255,v=m&65535,!(E+w<=c);){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}u>>>=E,c-=E,r.back+=E}if(u>>>=w,c-=w,r.back+=w,A&64){e.msg="invalid distance code",r.mode=te;break}r.offset=v,r.extra=A&15,r.mode=vu;case vu:if(r.extra){for(R=r.extra;c<R;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=te;break}r.mode=Ou;case Ou:if(l===0)break e;if(g=_-l,r.offset>g){if(g=r.offset-g,g>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=te;break}g>r.wnext?(g-=r.wnext,S=r.wsize-g):S=r.wnext-g,g>r.length&&(g=r.length),y=r.window}else y=i,S=o-r.offset,g=r.length;g>l&&(g=l),l-=g,r.length-=g;do i[o++]=y[S++];while(--g);r.length===0&&(r.mode=di);break;case Pu:if(l===0)break e;i[o++]=r.length,l--,r.mode=di;break;case ks:if(r.wrap){for(;c<32;){if(a===0)break e;a--,u|=n[s++]<<c,c+=8}if(_-=l,e.total_out+=_,r.total+=_,_&&(e.adler=r.check=r.flags?vt(r.check,i,_,o-_):xs(r.check,i,_,o-_)),_=l,(r.flags?u:Nu(u))!==r.check){e.msg="incorrect data check",r.mode=te;break}u=0,c=0}r.mode=Au;case Au:if(r.wrap&&r.flags){for(;c<32;){if(a===0)break e;a--,u+=n[s++]<<c,c+=8}if(u!==(r.total&4294967295)){e.msg="incorrect length check",r.mode=te;break}u=0,c=0}r.mode=ku;case ku:x=vh;break e;case te:x=Hu;break e;case Hs:return Rs;case Ah:default:return $e}return e.next_out=o,e.avail_out=l,e.next_in=s,e.avail_in=a,r.hold=u,r.bits=c,(r.wsize||_!==e.avail_out&&r.mode<te&&(r.mode<ks||t!==au))&&Fu(e,e.output,e.next_out,_-e.avail_out)?(r.mode=Hs,Rs):(p-=e.avail_in,_-=e.avail_out,e.total_in+=p,e.total_out+=_,r.total+=_,r.wrap&&_&&(e.adler=r.check=r.flags?vt(r.check,i,_,e.next_out-_):xs(r.check,i,_,e.next_out-_)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Ft?128:0)+(r.mode===hi||r.mode===As?256:0),(p===0&&_===0||t===au)&&x===Pr&&(x=Ph),x)}function Uh(e){if(!e||!e.state)return $e;var t=e.state;return t.window&&(t.window=null),e.state=null,Pr}function Mh(e,t){var r;return!e||!e.state||(r=e.state,(r.wrap&2)===0)?$e:(r.head=t,t.done=!1,Pr)}function Dh(e,t){var r=t.length,n,i,s;return!e||!e.state||(n=e.state,n.wrap!==0&&n.mode!==_i)?$e:n.mode===_i&&(i=1,i=xs(i,t,r,0),i!==n.check)?Hu:(s=Fu(e,t,r,r),s?(n.mode=Hs,Rs):(n.havedict=1,Pr))}_t.inflateReset=Uu;_t.inflateReset2=Mu;_t.inflateResetKeep=Lu;_t.inflateInit=Hh;_t.inflateInit2=Du;_t.inflate=Lh;_t.inflateEnd=Uh;_t.inflateGetHeader=Mh;_t.inflateSetDictionary=Dh;_t.inflateInfo="pako inflate (from Nodeca project)"});var Wu=T(Dr=>{"use strict";h();d();var gi=En(),qu=!0,ju=!0;try{String.fromCharCode.apply(null,[0])}catch{qu=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ju=!1}var In=new gi.Buf8(256);for(Kt=0;Kt<256;Kt++)In[Kt]=Kt>=252?6:Kt>=248?5:Kt>=240?4:Kt>=224?3:Kt>=192?2:1;var Kt;In[254]=In[254]=1;Dr.string2buf=function(e){var t,r,n,i,s,o=e.length,a=0;for(i=0;i<o;i++)r=e.charCodeAt(i),(r&64512)===55296&&i+1<o&&(n=e.charCodeAt(i+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new gi.Buf8(a),s=0,i=0;s<a;i++)r=e.charCodeAt(i),(r&64512)===55296&&i+1<o&&(n=e.charCodeAt(i+1),(n&64512)===56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[s++]=r:r<2048?(t[s++]=192|r>>>6,t[s++]=128|r&63):r<65536?(t[s++]=224|r>>>12,t[s++]=128|r>>>6&63,t[s++]=128|r&63):(t[s++]=240|r>>>18,t[s++]=128|r>>>12&63,t[s++]=128|r>>>6&63,t[s++]=128|r&63);return t};function Gu(e,t){if(t<65534&&(e.subarray&&ju||!e.subarray&&qu))return String.fromCharCode.apply(null,gi.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}Dr.buf2binstring=function(e){return Gu(e,e.length)};Dr.binstring2buf=function(e){for(var t=new gi.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t};Dr.buf2string=function(e,t){var r,n,i,s,o=t||e.length,a=new Array(o*2);for(n=0,r=0;r<o;){if(i=e[r++],i<128){a[n++]=i;continue}if(s=In[i],s>4){a[n++]=65533,r+=s-1;continue}for(i&=s===2?31:s===3?15:7;s>1&&r<o;)i=i<<6|e[r++]&63,s--;if(s>1){a[n++]=65533;continue}i<65536?a[n++]=i:(i-=65536,a[n++]=55296|i>>10&1023,a[n++]=56320|i&1023)}return Gu(a,n)};Dr.utf8border=function(e,t){var r;for(t=t||e.length,t>e.length&&(t=e.length),r=t-1;r>=0&&(e[r]&192)===128;)r--;return r<0||r===0?t:r+In[e[r]]>t?r:t}});var Xu=T((TT,Vu)=>{"use strict";h();d();Vu.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}});var Yu=T((OT,zu)=>{"use strict";h();d();zu.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}});var Zu=T((kT,$u)=>{"use strict";h();d();function Fh(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}$u.exports=Fh});var Ju=T((xT,Qu)=>{"use strict";h();d();function Kh(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}Qu.exports=Kh});var tc=T(On=>{"use strict";h();d();var Fr=Ku(),vn=En(),Si=Wu(),ue=Xu(),Bs=Yu(),qh=Zu(),jh=Ju(),ec=Object.prototype.toString;function Ar(e){if(!(this instanceof Ar))return new Ar(e);this.options=vn.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qh,this.strm.avail_out=0;var r=Fr.inflateInit2(this.strm,t.windowBits);if(r!==ue.Z_OK)throw new Error(Bs[r]);if(this.header=new jh,Fr.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Si.string2buf(t.dictionary):ec.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Fr.inflateSetDictionary(this.strm,t.dictionary),r!==ue.Z_OK)))throw new Error(Bs[r])}Ar.prototype.push=function(e,t){var r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,a,l,u,c=!1;if(this.ended)return!1;o=t===~~t?t:t===!0?ue.Z_FINISH:ue.Z_NO_FLUSH,typeof e=="string"?r.input=Si.binstring2buf(e):ec.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(r.avail_out===0&&(r.output=new vn.Buf8(n),r.next_out=0,r.avail_out=n),s=Fr.inflate(r,ue.Z_NO_FLUSH),s===ue.Z_NEED_DICT&&i&&(s=Fr.inflateSetDictionary(this.strm,i)),s===ue.Z_BUF_ERROR&&c===!0&&(s=ue.Z_OK,c=!1),s!==ue.Z_STREAM_END&&s!==ue.Z_OK)return this.onEnd(s),this.ended=!0,!1;r.next_out&&(r.avail_out===0||s===ue.Z_STREAM_END||r.avail_in===0&&(o===ue.Z_FINISH||o===ue.Z_SYNC_FLUSH))&&(this.options.to==="string"?(a=Si.utf8border(r.output,r.next_out),l=r.next_out-a,u=Si.buf2string(r.output,a),r.next_out=l,r.avail_out=n-l,l&&vn.arraySet(r.output,r.output,a,l,0),this.onData(u)):this.onData(vn.shrinkBuf(r.output,r.next_out))),r.avail_in===0&&r.avail_out===0&&(c=!0)}while((r.avail_in>0||r.avail_out===0)&&s!==ue.Z_STREAM_END);return s===ue.Z_STREAM_END&&(o=ue.Z_FINISH),o===ue.Z_FINISH?(s=Fr.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ue.Z_OK):(o===ue.Z_SYNC_FLUSH&&(this.onEnd(ue.Z_OK),r.avail_out=0),!0)};Ar.prototype.onData=function(e){this.chunks.push(e)};Ar.prototype.onEnd=function(e){e===ue.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Ls(e,t){var r=new Ar(t);if(r.push(e,!0),r.err)throw r.msg||Bs[r.err];return r.result}function Gh(e,t){return t=t||{},t.raw=!0,Ls(e,t)}On.Inflate=Ar;On.inflate=Ls;On.inflateRaw=Gh;On.ungzip=Ls});var Ve=T(nr=>{"use strict";h();d();Object.defineProperty(nr,"__esModule",{value:!0});nr.testnet=nr.regtest=nr.bitcoin=void 0;nr.bitcoin={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};nr.regtest={messagePrefix:`Bitcoin Signed Message:
`,bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};nr.testnet={messagePrefix:`Bitcoin Signed Message:
`,bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}});var Ks=T(ir=>{"use strict";h();d();Object.defineProperty(ir,"__esModule",{value:!0});ir.encode=ir.decode=ir.check=void 0;function zh(e){if(e.length<8||e.length>72||e[0]!==48||e[1]!==e.length-2||e[2]!==2)return!1;let t=e[3];if(t===0||5+t>=e.length||e[4+t]!==2)return!1;let r=e[5+t];return!(r===0||6+t+r!==e.length||e[4]&128||t>1&&e[4]===0&&!(e[5]&128)||e[t+6]&128||r>1&&e[t+6]===0&&!(e[t+7]&128))}ir.check=zh;function Yh(e){if(e.length<8)throw new Error("DER sequence length is too short");if(e.length>72)throw new Error("DER sequence length is too long");if(e[0]!==48)throw new Error("Expected DER sequence");if(e[1]!==e.length-2)throw new Error("DER sequence length is invalid");if(e[2]!==2)throw new Error("Expected DER integer");let t=e[3];if(t===0)throw new Error("R length is zero");if(5+t>=e.length)throw new Error("R length is too long");if(e[4+t]!==2)throw new Error("Expected DER integer (2)");let r=e[5+t];if(r===0)throw new Error("S length is zero");if(6+t+r!==e.length)throw new Error("S length is invalid");if(e[4]&128)throw new Error("R value is negative");if(t>1&&e[4]===0&&!(e[5]&128))throw new Error("R value excessively padded");if(e[t+6]&128)throw new Error("S value is negative");if(r>1&&e[t+6]===0&&!(e[t+7]&128))throw new Error("S value excessively padded");return{r:e.slice(4,4+t),s:e.slice(6+t)}}ir.decode=Yh;function $h(e,t){let r=e.length,n=t.length;if(r===0)throw new Error("R length is zero");if(n===0)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(n>33)throw new Error("S length is too long");if(e[0]&128)throw new Error("R value is negative");if(t[0]&128)throw new Error("S value is negative");if(r>1&&e[0]===0&&!(e[1]&128))throw new Error("R value excessively padded");if(n>1&&t[0]===0&&!(t[1]&128))throw new Error("S value excessively padded");let i=f.Buffer.allocUnsafe(6+r+n);return i[0]=48,i[1]=i.length-2,i[2]=2,i[3]=e.length,e.copy(i,4),i[4+r]=2,i[5+r]=t.length,t.copy(i,6+r),i}ir.encode=$h});var Pn=T(qr=>{"use strict";h();d();Object.defineProperty(qr,"__esModule",{value:!0});qr.REVERSE_OPS=qr.OPS=void 0;var qs={OP_FALSE:0,OP_0:0,OP_DATA_1:1,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_CHECKSIGADD:186,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255};qr.OPS=qs;var fc={};qr.REVERSE_OPS=fc;for(let e of Object.keys(qs)){let t=qs[e];fc[t]=e}});var pc=T(or=>{"use strict";h();d();Object.defineProperty(or,"__esModule",{value:!0});or.decode=or.encode=or.encodingLength=void 0;var sr=Pn();function lc(e){return e<sr.OPS.OP_PUSHDATA1?1:e<=255?2:e<=65535?3:5}or.encodingLength=lc;function Zh(e,t,r){let n=lc(t);return n===1?e.writeUInt8(t,r):n===2?(e.writeUInt8(sr.OPS.OP_PUSHDATA1,r),e.writeUInt8(t,r+1)):n===3?(e.writeUInt8(sr.OPS.OP_PUSHDATA2,r),e.writeUInt16LE(t,r+1)):(e.writeUInt8(sr.OPS.OP_PUSHDATA4,r),e.writeUInt32LE(t,r+1)),n}or.encode=Zh;function Qh(e,t){let r=e.readUInt8(t),n,i;if(r<sr.OPS.OP_PUSHDATA1)n=r,i=1;else if(r===sr.OPS.OP_PUSHDATA1){if(t+2>e.length)return null;n=e.readUInt8(t+1),i=2}else if(r===sr.OPS.OP_PUSHDATA2){if(t+3>e.length)return null;n=e.readUInt16LE(t+1),i=3}else{if(t+5>e.length)return null;if(r!==sr.OPS.OP_PUSHDATA4)throw new Error("Unexpected opcode");n=e.readUInt32LE(t+1),i=5}return{opcode:r,number:n,size:i}}or.decode=Qh});var hc=T(jr=>{"use strict";h();d();Object.defineProperty(jr,"__esModule",{value:!0});jr.encode=jr.decode=void 0;function Jh(e,t,r){t=t||4,r=r===void 0?!0:r;let n=e.length;if(n===0)return 0;if(n>t)throw new TypeError("Script number overflow");if(r&&(e[n-1]&127)===0&&(n<=1||(e[n-2]&128)===0))throw new Error("Non-minimally encoded script number");if(n===5){let s=e.readUInt32LE(0),o=e.readUInt8(4);return o&128?-((o&-129)*4294967296+s):o*4294967296+s}let i=0;for(let s=0;s<n;++s)i|=e[s]<<8*s;return e[n-1]&128?-(i&~(128<<8*(n-1))):i}jr.decode=Jh;function ed(e){return e>2147483647?5:e>8388607?4:e>32767?3:e>127?2:e>0?1:0}function td(e){let t=Math.abs(e),r=ed(t),n=f.Buffer.allocUnsafe(r),i=e<0;for(let s=0;s<r;++s)n.writeUInt8(t&255,s),t>>=8;return n[r-1]&128?n.writeUInt8(i?128:0,r-1):i&&(n[r-1]|=128),n}jr.encode=td});var Pe=T(k=>{"use strict";h();d();Object.defineProperty(k,"__esModule",{value:!0});k.oneOf=k.Null=k.BufferN=k.Function=k.UInt32=k.UInt8=k.tuple=k.maybe=k.Hex=k.Buffer=k.String=k.Boolean=k.Array=k.Number=k.Hash256bit=k.Hash160bit=k.Buffer256bit=k.isTaptree=k.isTapleaf=k.TAPLEAF_VERSION_MASK=k.Satoshi=k.Signer=k.BIP32Path=k.UInt31=k.isPoint=k.typeforce=void 0;var Ei=fs(),se=ke();Object.defineProperty(k,"typeforce",{enumerable:!0,get:function(){return se.typeforce}});var dc=Ei.Buffer.alloc(32,0),_c=Ei.Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex");function rd(e){if(!Ei.Buffer.isBuffer(e)||e.length<33)return!1;let t=e[0],r=e.slice(1,33);if(r.compare(dc)===0||r.compare(_c)>=0)return!1;if((t===2||t===3)&&e.length===33)return!0;let n=e.slice(33);return n.compare(dc)===0||n.compare(_c)>=0?!1:t===4&&e.length===65}k.isPoint=rd;var nd=Math.pow(2,31)-1;function id(e){return se.typeforce.UInt32(e)&&e<=nd}k.UInt31=id;function gc(e){return se.typeforce.String(e)&&!!e.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}k.BIP32Path=gc;gc.toJSON=()=>"BIP32 derivation path";function sd(e){return(se.typeforce.Buffer(e.publicKey)||typeof e.getPublicKey=="function")&&typeof e.sign=="function"}k.Signer=sd;var od=21*1e14;function ad(e){return se.typeforce.UInt53(e)&&e<=od}k.Satoshi=ad;k.TAPLEAF_VERSION_MASK=254;function Sc(e){return!e||!("output"in e)||!Ei.Buffer.isBuffer(e.output)?!1:e.version!==void 0?(e.version&k.TAPLEAF_VERSION_MASK)===e.version:!0}k.isTapleaf=Sc;function yc(e){return(0,k.Array)(e)?e.length!==2?!1:e.every(t=>yc(t)):Sc(e)}k.isTaptree=yc;k.Buffer256bit=se.typeforce.BufferN(32);k.Hash160bit=se.typeforce.BufferN(20);k.Hash256bit=se.typeforce.BufferN(32);k.Number=se.typeforce.Number;k.Array=se.typeforce.Array;k.Boolean=se.typeforce.Boolean;k.String=se.typeforce.String;k.Buffer=se.typeforce.Buffer;k.Hex=se.typeforce.Hex;k.maybe=se.typeforce.maybe;k.tuple=se.typeforce.tuple;k.UInt8=se.typeforce.UInt8;k.UInt32=se.typeforce.UInt32;k.Function=se.typeforce.Function;k.BufferN=se.typeforce.BufferN;k.Null=se.typeforce.Null;k.oneOf=se.typeforce.oneOf});var Ic=T(Ze=>{"use strict";h();d();var ud=Ze&&Ze.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),cd=Ze&&Ze.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ec=Ze&&Ze.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&ud(t,e,r);return cd(t,e),t};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.encode=Ze.decode=void 0;var Tc=Ec(Ks()),js=Ec(Pe()),{typeforce:fd}=js,mc=f.Buffer.alloc(1,0);function wc(e){let t=0;for(;e[t]===0;)++t;return t===e.length?mc:(e=e.slice(t),e[0]&128?f.Buffer.concat([mc,e],1+e.length):e)}function bc(e){e[0]===0&&(e=e.slice(1));let t=f.Buffer.alloc(32,0),r=Math.max(0,32-e.length);return e.copy(t,r),t}function ld(e){let t=e.readUInt8(e.length-1),r=t&-193;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);let n=Tc.decode(e.slice(0,-1)),i=bc(n.r),s=bc(n.s);return{signature:f.Buffer.concat([i,s],64),hashType:t}}Ze.decode=ld;function pd(e,t){fd({signature:js.BufferN(64),hashType:js.UInt8},{signature:e,hashType:t});let r=t&-193;if(r<=0||r>=4)throw new Error("Invalid hashType "+t);let n=f.Buffer.allocUnsafe(1);n.writeUInt8(t,0);let i=wc(e.slice(0,32)),s=wc(e.slice(32,64));return f.Buffer.concat([Tc.encode(i,s),n])}Ze.encode=pd});var ye=T(X=>{"use strict";h();d();var hd=X&&X.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),dd=X&&X.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),kn=X&&X.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&hd(t,e,r);return dd(t,e),t};Object.defineProperty(X,"__esModule",{value:!0});X.signature=X.number=X.isCanonicalScriptSignature=X.isDefinedHashType=X.isCanonicalPubKey=X.toStack=X.fromASM=X.toASM=X.decompile=X.compile=X.isPushOnly=X.OPS=void 0;var _d=kn(Ks()),Be=Pn();Object.defineProperty(X,"OPS",{enumerable:!0,get:function(){return Be.OPS}});var Gs=kn(pc()),vc=kn(hc()),gd=kn(Ic()),Ot=kn(Pe()),{typeforce:An}=Ot,Oc=Be.OPS.OP_RESERVED;function Sd(e){return Ot.Number(e)&&(e===Be.OPS.OP_0||e>=Be.OPS.OP_1&&e<=Be.OPS.OP_16||e===Be.OPS.OP_1NEGATE)}function yd(e){return Ot.Buffer(e)||Sd(e)}function Pc(e){return Ot.Array(e)&&e.every(yd)}X.isPushOnly=Pc;function Ti(e){if(e.length===0)return Be.OPS.OP_0;if(e.length===1){if(e[0]>=1&&e[0]<=16)return Oc+e[0];if(e[0]===129)return Be.OPS.OP_1NEGATE}}function Ac(e){return f.Buffer.isBuffer(e)}function md(e){return Ot.Array(e)}function Ii(e){return f.Buffer.isBuffer(e)}function kc(e){if(Ac(e))return e;An(Ot.Array,e);let t=e.reduce((i,s)=>Ii(s)?s.length===1&&Ti(s)!==void 0?i+1:i+Gs.encodingLength(s.length)+s.length:i+1,0),r=f.Buffer.allocUnsafe(t),n=0;if(e.forEach(i=>{if(Ii(i)){let s=Ti(i);if(s!==void 0){r.writeUInt8(s,n),n+=1;return}n+=Gs.encode(r,i.length,n),i.copy(r,n),n+=i.length}else r.writeUInt8(i,n),n+=1}),n!==r.length)throw new Error("Could not decode chunks");return r}X.compile=kc;function Ws(e){if(md(e))return e;An(Ot.Buffer,e);let t=[],r=0;for(;r<e.length;){let n=e[r];if(n>Be.OPS.OP_0&&n<=Be.OPS.OP_PUSHDATA4){let i=Gs.decode(e,r);if(i===null||(r+=i.size,r+i.number>e.length))return null;let s=e.slice(r,r+i.number);r+=i.number;let o=Ti(s);o!==void 0?t.push(o):t.push(s)}else t.push(n),r+=1}return t}X.decompile=Ws;function wd(e){return Ac(e)&&(e=Ws(e)),e.map(t=>{if(Ii(t)){let r=Ti(t);if(r===void 0)return t.toString("hex");t=r}return Be.REVERSE_OPS[t]}).join(" ")}X.toASM=wd;function bd(e){return An(Ot.String,e),kc(e.split(" ").map(t=>Be.OPS[t]!==void 0?Be.OPS[t]:(An(Ot.Hex,t),f.Buffer.from(t,"hex"))))}X.fromASM=bd;function Ed(e){return e=Ws(e),An(Pc,e),e.map(t=>Ii(t)?t:t===Be.OPS.OP_0?f.Buffer.allocUnsafe(0):vc.encode(t-Oc))}X.toStack=Ed;function Td(e){return Ot.isPoint(e)}X.isCanonicalPubKey=Td;function Nc(e){let t=e;return t&128&&(t=t&-129),t&64&&(t=t&-65),t>0&&t<4}X.isDefinedHashType=Nc;function Id(e){return!f.Buffer.isBuffer(e)||!Nc(e[e.length-1])?!1:_d.check(e.slice(0,-1))}X.isCanonicalScriptSignature=Id;X.number=vc;X.signature=gd});var qt=T(Gr=>{"use strict";h();d();Object.defineProperty(Gr,"__esModule",{value:!0});Gr.value=Gr.prop=void 0;function vd(e,t,r){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get(){let n=r.call(this);return this[t]=n,n},set(n){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:n,writable:!0})}})}Gr.prop=vd;function Od(e){let t;return()=>(t!==void 0||(t=e()),t)}Gr.value=Od});var Hc=T(Pt=>{"use strict";h();d();var Pd=Pt&&Pt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ad=Pt&&Pt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Rc=Pt&&Pt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Pd(t,e,r);return Ad(t,e),t};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.p2data=void 0;var kd=Ve(),vi=Rc(ye()),jt=Pe(),Cc=Rc(qt()),xc=vi.OPS;function Nd(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Cd(e,t){if(!e.data&&!e.output)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,jt.typeforce)({network:jt.typeforce.maybe(jt.typeforce.Object),output:jt.typeforce.maybe(jt.typeforce.Buffer),data:jt.typeforce.maybe(jt.typeforce.arrayOf(jt.typeforce.Buffer))},e);let r=e.network||kd.bitcoin,n={name:"embed",network:r};if(Cc.prop(n,"output",()=>{if(!!e.data)return vi.compile([xc.OP_RETURN].concat(e.data))}),Cc.prop(n,"data",()=>{if(!!e.output)return vi.decompile(e.output).slice(1)}),t.validate&&e.output){let i=vi.decompile(e.output);if(i[0]!==xc.OP_RETURN)throw new TypeError("Output is invalid");if(!i.slice(1).every(jt.typeforce.Buffer))throw new TypeError("Output is invalid");if(e.data&&!Nd(e.data,n.data))throw new TypeError("Data mismatch")}return Object.assign(n,e)}Pt.p2data=Cd});var Uc=T(At=>{"use strict";h();d();var xd=At&&At.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Rd=At&&At.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Lc=At&&At.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&xd(t,e,r);return Rd(t,e),t};Object.defineProperty(At,"__esModule",{value:!0});At.p2ms=void 0;var Hd=Ve(),Wr=Lc(ye()),ge=Pe(),ar=Lc(qt()),Vr=Wr.OPS,Oi=Vr.OP_RESERVED;function Bc(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Bd(e,t){if(!e.input&&!e.output&&!(e.pubkeys&&e.m!==void 0)&&!e.signatures)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{});function r(l){return Wr.isCanonicalScriptSignature(l)||(t.allowIncomplete&&l===Vr.OP_0)!==void 0}(0,ge.typeforce)({network:ge.typeforce.maybe(ge.typeforce.Object),m:ge.typeforce.maybe(ge.typeforce.Number),n:ge.typeforce.maybe(ge.typeforce.Number),output:ge.typeforce.maybe(ge.typeforce.Buffer),pubkeys:ge.typeforce.maybe(ge.typeforce.arrayOf(ge.isPoint)),signatures:ge.typeforce.maybe(ge.typeforce.arrayOf(r)),input:ge.typeforce.maybe(ge.typeforce.Buffer)},e);let i={network:e.network||Hd.bitcoin},s=[],o=!1;function a(l){o||(o=!0,s=Wr.decompile(l),i.m=s[0]-Oi,i.n=s[s.length-2]-Oi,i.pubkeys=s.slice(1,-2))}if(ar.prop(i,"output",()=>{if(!!e.m&&!!i.n&&!!e.pubkeys)return Wr.compile([].concat(Oi+e.m,e.pubkeys,Oi+i.n,Vr.OP_CHECKMULTISIG))}),ar.prop(i,"m",()=>{if(!!i.output)return a(i.output),i.m}),ar.prop(i,"n",()=>{if(!!i.pubkeys)return i.pubkeys.length}),ar.prop(i,"pubkeys",()=>{if(!!e.output)return a(e.output),i.pubkeys}),ar.prop(i,"signatures",()=>{if(!!e.input)return Wr.decompile(e.input).slice(1)}),ar.prop(i,"input",()=>{if(!!e.signatures)return Wr.compile([Vr.OP_0].concat(e.signatures))}),ar.prop(i,"witness",()=>{if(!!i.input)return[]}),ar.prop(i,"name",()=>{if(!(!i.m||!i.n))return`p2ms(${i.m} of ${i.n})`}),t.validate){if(e.output){if(a(e.output),!ge.typeforce.Number(s[0]))throw new TypeError("Output is invalid");if(!ge.typeforce.Number(s[s.length-2]))throw new TypeError("Output is invalid");if(s[s.length-1]!==Vr.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(i.m<=0||i.n>16||i.m>i.n||i.n!==s.length-3)throw new TypeError("Output is invalid");if(!i.pubkeys.every(l=>(0,ge.isPoint)(l)))throw new TypeError("Output is invalid");if(e.m!==void 0&&e.m!==i.m)throw new TypeError("m mismatch");if(e.n!==void 0&&e.n!==i.n)throw new TypeError("n mismatch");if(e.pubkeys&&!Bc(e.pubkeys,i.pubkeys))throw new TypeError("Pubkeys mismatch")}if(e.pubkeys){if(e.n!==void 0&&e.n!==e.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(i.n=e.pubkeys.length,i.n<i.m)throw new TypeError("Pubkey count cannot be less than m")}if(e.signatures){if(e.signatures.length<i.m)throw new TypeError("Not enough signatures provided");if(e.signatures.length>i.m)throw new TypeError("Too many signatures provided")}if(e.input){if(e.input[0]!==Vr.OP_0)throw new TypeError("Input is invalid");if(i.signatures.length===0||!i.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(e.signatures&&!Bc(e.signatures,i.signatures))throw new TypeError("Signature mismatch");if(e.m!==void 0&&e.m!==e.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(i,e)}At.p2ms=Bd});var Fc=T(kt=>{"use strict";h();d();var Ld=kt&&kt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Ud=kt&&kt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Dc=kt&&kt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Ld(t,e,r);return Ud(t,e),t};Object.defineProperty(kt,"__esModule",{value:!0});kt.p2pk=void 0;var Md=Ve(),zr=Dc(ye()),gt=Pe(),Xr=Dc(qt()),Mc=zr.OPS;function Dd(e,t){if(!e.input&&!e.output&&!e.pubkey&&!e.input&&!e.signature)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,gt.typeforce)({network:gt.typeforce.maybe(gt.typeforce.Object),output:gt.typeforce.maybe(gt.typeforce.Buffer),pubkey:gt.typeforce.maybe(gt.isPoint),signature:gt.typeforce.maybe(zr.isCanonicalScriptSignature),input:gt.typeforce.maybe(gt.typeforce.Buffer)},e);let r=Xr.value(()=>zr.decompile(e.input)),n=e.network||Md.bitcoin,i={name:"p2pk",network:n};if(Xr.prop(i,"output",()=>{if(!!e.pubkey)return zr.compile([e.pubkey,Mc.OP_CHECKSIG])}),Xr.prop(i,"pubkey",()=>{if(!!e.output)return e.output.slice(1,-1)}),Xr.prop(i,"signature",()=>{if(!!e.input)return r()[0]}),Xr.prop(i,"input",()=>{if(!!e.signature)return zr.compile([e.signature])}),Xr.prop(i,"witness",()=>{if(!!i.input)return[]}),t.validate){if(e.output){if(e.output[e.output.length-1]!==Mc.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!(0,gt.isPoint)(i.pubkey))throw new TypeError("Output pubkey is invalid");if(e.pubkey&&!e.pubkey.equals(i.pubkey))throw new TypeError("Pubkey mismatch")}if(e.signature&&e.input&&!e.input.equals(i.input))throw new TypeError("Signature mismatch");if(e.input){if(r().length!==1)throw new TypeError("Input is invalid");if(!zr.isCanonicalScriptSignature(i.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(i,e)}kt.p2pk=Dd});var St=T(Qe=>{"use strict";h();d();Object.defineProperty(Qe,"__esModule",{value:!0});Qe.taggedHash=Qe.hash256=Qe.hash160=Qe.sha256=Qe.ripemd160=void 0;var Kc=ke();function qc(e){return f.Buffer.from(Kc.base.ripemd160(e))}Qe.ripemd160=qc;function Yr(e){return f.Buffer.from(Kc.base.sha256(e))}Qe.sha256=Yr;function Fd(e){return qc(Yr(e))}Qe.hash160=Fd;function Kd(e){return Yr(Yr(e))}Qe.hash256=Kd;var qd=["BIP0340/challenge","BIP0340/aux","BIP0340/nonce","TapLeaf","TapBranch","TapSighash","TapTweak","KeyAgg list","KeyAgg coefficient"],jd=Object.fromEntries(qd.map(e=>{let t=Yr(f.Buffer.from(e));return[e,f.Buffer.concat([t,t])]}));function Gd(e,t){return Yr(f.Buffer.concat([jd[e],t]))}Qe.taggedHash=Gd});var Gc=T(Nt=>{"use strict";h();d();var Wd=Nt&&Nt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Vd=Nt&&Nt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Xs=Nt&&Nt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Wd(t,e,r);return Vd(t,e),t};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.p2pkh=void 0;var Vs=Xs(St()),Xd=Ve(),$r=Xs(ye()),xe=Pe(),Gt=Xs(qt()),ur=$r.OPS,jc=ke();function zd(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,xe.typeforce)({network:xe.typeforce.maybe(xe.typeforce.Object),address:xe.typeforce.maybe(xe.typeforce.String),hash:xe.typeforce.maybe(xe.typeforce.BufferN(20)),output:xe.typeforce.maybe(xe.typeforce.BufferN(25)),pubkey:xe.typeforce.maybe(xe.isPoint),signature:xe.typeforce.maybe($r.isCanonicalScriptSignature),input:xe.typeforce.maybe(xe.typeforce.Buffer)},e);let r=Gt.value(()=>{let o=jc.base.fromBase58Check(e.address),a=o.readUInt8(0),l=o.slice(1);return{version:a,hash:l}}),n=Gt.value(()=>$r.decompile(e.input)),i=e.network||Xd.bitcoin,s={name:"p2pkh",network:i};if(Gt.prop(s,"address",()=>{if(!s.hash)return;let o=f.Buffer.allocUnsafe(21);return o.writeUInt8(i.pubKeyHash,0),s.hash.copy(o,1),jc.base.toBase58Check(o)}),Gt.prop(s,"hash",()=>{if(e.output)return e.output.slice(3,23);if(e.address)return r().hash;if(e.pubkey||s.pubkey)return Vs.hash160(e.pubkey||s.pubkey)}),Gt.prop(s,"output",()=>{if(!!s.hash)return $r.compile([ur.OP_DUP,ur.OP_HASH160,s.hash,ur.OP_EQUALVERIFY,ur.OP_CHECKSIG])}),Gt.prop(s,"pubkey",()=>{if(!!e.input)return n()[1]}),Gt.prop(s,"signature",()=>{if(!!e.input)return n()[0]}),Gt.prop(s,"input",()=>{if(!!e.pubkey&&!!e.signature)return $r.compile([e.signature,e.pubkey])}),Gt.prop(s,"witness",()=>{if(!!s.input)return[]}),t.validate){let o=f.Buffer.from([]);if(e.address){if(r().version!==i.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(r().hash.length!==20)throw new TypeError("Invalid address");o=r().hash}if(e.hash){if(o.length>0&&!o.equals(e.hash))throw new TypeError("Hash mismatch");o=e.hash}if(e.output){if(e.output.length!==25||e.output[0]!==ur.OP_DUP||e.output[1]!==ur.OP_HASH160||e.output[2]!==20||e.output[23]!==ur.OP_EQUALVERIFY||e.output[24]!==ur.OP_CHECKSIG)throw new TypeError("Output is invalid");let a=e.output.slice(3,23);if(o.length>0&&!o.equals(a))throw new TypeError("Hash mismatch");o=a}if(e.pubkey){let a=Vs.hash160(e.pubkey);if(o.length>0&&!o.equals(a))throw new TypeError("Hash mismatch");o=a}if(e.input){let a=n();if(a.length!==2)throw new TypeError("Input is invalid");if(!$r.isCanonicalScriptSignature(a[0]))throw new TypeError("Input has invalid signature");if(!(0,xe.isPoint)(a[1]))throw new TypeError("Input has invalid pubkey");if(e.signature&&!e.signature.equals(a[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(a[1]))throw new TypeError("Pubkey mismatch");let l=Vs.hash160(a[1]);if(o.length>0&&!o.equals(l))throw new TypeError("Hash mismatch")}}return Object.assign(s,e)}Nt.p2pkh=zd});var Xc=T(xt=>{"use strict";h();d();var Yd=xt&&xt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),$d=xt&&xt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),zs=xt&&xt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Yd(t,e,r);return $d(t,e),t};Object.defineProperty(xt,"__esModule",{value:!0});xt.p2sh=void 0;var Wc=zs(St()),Zd=Ve(),Wt=zs(ye()),re=Pe(),Ct=zs(qt()),Vc=ke(),Pi=Wt.OPS;function Qd(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Jd(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.input)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,re.typeforce)({network:re.typeforce.maybe(re.typeforce.Object),address:re.typeforce.maybe(re.typeforce.String),hash:re.typeforce.maybe(re.typeforce.BufferN(20)),output:re.typeforce.maybe(re.typeforce.BufferN(23)),redeem:re.typeforce.maybe({network:re.typeforce.maybe(re.typeforce.Object),output:re.typeforce.maybe(re.typeforce.Buffer),input:re.typeforce.maybe(re.typeforce.Buffer),witness:re.typeforce.maybe(re.typeforce.arrayOf(re.typeforce.Buffer))}),input:re.typeforce.maybe(re.typeforce.Buffer),witness:re.typeforce.maybe(re.typeforce.arrayOf(re.typeforce.Buffer))},e);let r=e.network;r||(r=e.redeem&&e.redeem.network||Zd.bitcoin);let n={network:r},i=Ct.value(()=>{let a=Vc.base.fromBase58Check(e.address),l=a.readUInt8(0),u=a.slice(1);return{version:l,hash:u}}),s=Ct.value(()=>Wt.decompile(e.input)),o=Ct.value(()=>{let a=s();return{network:r,output:a[a.length-1],input:Wt.compile(a.slice(0,-1)),witness:e.witness||[]}});if(Ct.prop(n,"address",()=>{if(!n.hash)return;let a=f.Buffer.allocUnsafe(21);return a.writeUInt8(n.network.scriptHash,0),n.hash.copy(a,1),Vc.base.toBase58Check(a)}),Ct.prop(n,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return i().hash;if(n.redeem&&n.redeem.output)return Wc.hash160(n.redeem.output)}),Ct.prop(n,"output",()=>{if(!!n.hash)return Wt.compile([Pi.OP_HASH160,n.hash,Pi.OP_EQUAL])}),Ct.prop(n,"redeem",()=>{if(!!e.input)return o()}),Ct.prop(n,"input",()=>{if(!(!e.redeem||!e.redeem.input||!e.redeem.output))return Wt.compile([].concat(Wt.decompile(e.redeem.input),e.redeem.output))}),Ct.prop(n,"witness",()=>{if(n.redeem&&n.redeem.witness)return n.redeem.witness;if(n.input)return[]}),Ct.prop(n,"name",()=>{let a=["p2sh"];return n.redeem!==void 0&&n.redeem.name!==void 0&&a.push(n.redeem.name),a.join("-")}),t.validate){let a=f.Buffer.from([]);if(e.address){if(i().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(i().hash.length!==20)throw new TypeError("Invalid address");a=i().hash}if(e.hash){if(a.length>0&&!a.equals(e.hash))throw new TypeError("Hash mismatch");a=e.hash}if(e.output){if(e.output.length!==23||e.output[0]!==Pi.OP_HASH160||e.output[1]!==20||e.output[22]!==Pi.OP_EQUAL)throw new TypeError("Output is invalid");let u=e.output.slice(2,22);if(a.length>0&&!a.equals(u))throw new TypeError("Hash mismatch");a=u}let l=u=>{if(u.output){let c=Wt.decompile(u.output);if(!c||c.length<1)throw new TypeError("Redeem.output too short");let p=Wc.hash160(u.output);if(a.length>0&&!a.equals(p))throw new TypeError("Hash mismatch");a=p}if(u.input){let c=u.input.length>0,p=u.witness&&u.witness.length>0;if(!c&&!p)throw new TypeError("Empty input");if(c&&p)throw new TypeError("Input and witness provided");if(c){let _=Wt.decompile(u.input);if(!Wt.isPushOnly(_))throw new TypeError("Non push-only scriptSig")}}};if(e.input){let u=s();if(!u||u.length<1)throw new TypeError("Input too short");if(!f.Buffer.isBuffer(o().output))throw new TypeError("Input is invalid");l(o())}if(e.redeem){if(e.redeem.network&&e.redeem.network!==r)throw new TypeError("Network mismatch");if(e.input){let u=o();if(e.redeem.output&&!e.redeem.output.equals(u.output))throw new TypeError("Redeem.output mismatch");if(e.redeem.input&&!e.redeem.input.equals(u.input))throw new TypeError("Redeem.input mismatch")}l(e.redeem)}if(e.witness&&e.redeem&&e.redeem.witness&&!Qd(e.redeem.witness,e.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(n,e)}xt.p2sh=Jd});var Yc=T(Rt=>{"use strict";h();d();var e_=Rt&&Rt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),t_=Rt&&Rt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),$s=Rt&&Rt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&e_(t,e,r);return t_(t,e),t};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.p2wpkh=void 0;var Ys=$s(St()),r_=Ve(),ki=$s(ye()),Se=Pe(),cr=$s(qt()),Ai=ke(),zc=ki.OPS,n_=f.Buffer.alloc(0);function i_(e,t){if(!e.address&&!e.hash&&!e.output&&!e.pubkey&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Se.typeforce)({address:Se.typeforce.maybe(Se.typeforce.String),hash:Se.typeforce.maybe(Se.typeforce.BufferN(20)),input:Se.typeforce.maybe(Se.typeforce.BufferN(0)),network:Se.typeforce.maybe(Se.typeforce.Object),output:Se.typeforce.maybe(Se.typeforce.BufferN(22)),pubkey:Se.typeforce.maybe(Se.isPoint),signature:Se.typeforce.maybe(ki.isCanonicalScriptSignature),witness:Se.typeforce.maybe(Se.typeforce.arrayOf(Se.typeforce.Buffer))},e);let r=cr.value(()=>{let s=Ai.base.bech32.decode(e.address),o=s.words.shift(),a=Ai.base.bech32.fromWords(s.words);return{version:o,prefix:s.prefix,data:f.Buffer.from(a)}}),n=e.network||r_.bitcoin,i={name:"p2wpkh",network:n};if(cr.prop(i,"address",()=>{if(!i.hash)return;let s=Ai.base.bech32.toWords(i.hash);return s.unshift(0),Ai.base.bech32.encode(n.bech32,s)}),cr.prop(i,"hash",()=>{if(e.output)return e.output.slice(2,22);if(e.address)return r().data;if(e.pubkey||i.pubkey)return Ys.hash160(e.pubkey||i.pubkey)}),cr.prop(i,"output",()=>{if(!!i.hash)return ki.compile([zc.OP_0,i.hash])}),cr.prop(i,"pubkey",()=>{if(e.pubkey)return e.pubkey;if(!!e.witness)return e.witness[1]}),cr.prop(i,"signature",()=>{if(!!e.witness)return e.witness[0]}),cr.prop(i,"input",()=>{if(!!i.witness)return n_}),cr.prop(i,"witness",()=>{if(!!e.pubkey&&!!e.signature)return[e.signature,e.pubkey]}),t.validate){let s=f.Buffer.from([]);if(e.address){if(n&&n.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==20)throw new TypeError("Invalid address data");s=r().data}if(e.hash){if(s.length>0&&!s.equals(e.hash))throw new TypeError("Hash mismatch");s=e.hash}if(e.output){if(e.output.length!==22||e.output[0]!==zc.OP_0||e.output[1]!==20)throw new TypeError("Output is invalid");if(s.length>0&&!s.equals(e.output.slice(2)))throw new TypeError("Hash mismatch");s=e.output.slice(2)}if(e.pubkey){let o=Ys.hash160(e.pubkey);if(s.length>0&&!s.equals(o))throw new TypeError("Hash mismatch");if(s=o,!(0,Se.isPoint)(e.pubkey)||e.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(e.witness){if(e.witness.length!==2)throw new TypeError("Witness is invalid");if(!ki.isCanonicalScriptSignature(e.witness[0]))throw new TypeError("Witness has invalid signature");if(!(0,Se.isPoint)(e.witness[1])||e.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(e.signature&&!e.signature.equals(e.witness[0]))throw new TypeError("Signature mismatch");if(e.pubkey&&!e.pubkey.equals(e.witness[1]))throw new TypeError("Pubkey mismatch");let o=Ys.hash160(e.witness[1]);if(s.length>0&&!s.equals(o))throw new TypeError("Hash mismatch")}}return Object.assign(i,e)}Rt.p2wpkh=i_});var Qc=T(Ht=>{"use strict";h();d();var s_=Ht&&Ht.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),o_=Ht&&Ht.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Qs=Ht&&Ht.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&s_(t,e,r);return o_(t,e),t};Object.defineProperty(Ht,"__esModule",{value:!0});Ht.p2wsh=void 0;var $c=Qs(St()),a_=Ve(),fr=Qs(ye()),Z=Pe(),Vt=Qs(qt()),Ni=ke(),Zc=fr.OPS,Zs=f.Buffer.alloc(0);function u_(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}function Ci(e){return!!(f.Buffer.isBuffer(e)&&e.length===65&&e[0]===4&&(0,Z.isPoint)(e))}function c_(e,t){if(!e.address&&!e.hash&&!e.output&&!e.redeem&&!e.witness)throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,Z.typeforce)({network:Z.typeforce.maybe(Z.typeforce.Object),address:Z.typeforce.maybe(Z.typeforce.String),hash:Z.typeforce.maybe(Z.typeforce.BufferN(32)),output:Z.typeforce.maybe(Z.typeforce.BufferN(34)),redeem:Z.typeforce.maybe({input:Z.typeforce.maybe(Z.typeforce.Buffer),network:Z.typeforce.maybe(Z.typeforce.Object),output:Z.typeforce.maybe(Z.typeforce.Buffer),witness:Z.typeforce.maybe(Z.typeforce.arrayOf(Z.typeforce.Buffer))}),input:Z.typeforce.maybe(Z.typeforce.BufferN(0)),witness:Z.typeforce.maybe(Z.typeforce.arrayOf(Z.typeforce.Buffer))},e);let r=Vt.value(()=>{let o=Ni.base.bech32.decode(e.address),a=o.words.shift(),l=Ni.base.bech32.fromWords(o.words);return{version:a,prefix:o.prefix,data:f.Buffer.from(l)}}),n=Vt.value(()=>fr.decompile(e.redeem.input)),i=e.network;i||(i=e.redeem&&e.redeem.network||a_.bitcoin);let s={network:i};if(Vt.prop(s,"address",()=>{if(!s.hash)return;let o=Ni.base.bech32.toWords(s.hash);return o.unshift(0),Ni.base.bech32.encode(i.bech32,o)}),Vt.prop(s,"hash",()=>{if(e.output)return e.output.slice(2);if(e.address)return r().data;if(s.redeem&&s.redeem.output)return $c.sha256(s.redeem.output)}),Vt.prop(s,"output",()=>{if(!!s.hash)return fr.compile([Zc.OP_0,s.hash])}),Vt.prop(s,"redeem",()=>{if(!!e.witness)return{output:e.witness[e.witness.length-1],input:Zs,witness:e.witness.slice(0,-1)}}),Vt.prop(s,"input",()=>{if(!!s.witness)return Zs}),Vt.prop(s,"witness",()=>{if(e.redeem&&e.redeem.input&&e.redeem.input.length>0&&e.redeem.output&&e.redeem.output.length>0){let o=fr.toStack(n());return s.redeem=Object.assign({witness:o},e.redeem),s.redeem.input=Zs,[].concat(o,e.redeem.output)}if(!!e.redeem&&!!e.redeem.output&&!!e.redeem.witness)return[].concat(e.redeem.witness,e.redeem.output)}),Vt.prop(s,"name",()=>{let o=["p2wsh"];return s.redeem!==void 0&&s.redeem.name!==void 0&&o.push(s.redeem.name),o.join("-")}),t.validate){let o=f.Buffer.from([]);if(e.address){if(r().prefix!==i.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==0)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");o=r().data}if(e.hash){if(o.length>0&&!o.equals(e.hash))throw new TypeError("Hash mismatch");o=e.hash}if(e.output){if(e.output.length!==34||e.output[0]!==Zc.OP_0||e.output[1]!==32)throw new TypeError("Output is invalid");let a=e.output.slice(2);if(o.length>0&&!o.equals(a))throw new TypeError("Hash mismatch");o=a}if(e.redeem){if(e.redeem.network&&e.redeem.network!==i)throw new TypeError("Network mismatch");if(e.redeem.input&&e.redeem.input.length>0&&e.redeem.witness&&e.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(e.redeem.output){if(fr.decompile(e.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");let a=$c.sha256(e.redeem.output);if(o.length>0&&!o.equals(a))throw new TypeError("Hash mismatch");o=a}if(e.redeem.input&&!fr.isPushOnly(n()))throw new TypeError("Non push-only scriptSig");if(e.witness&&e.redeem.witness&&!u_(e.witness,e.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(e.redeem.input&&n().some(Ci)||e.redeem.output&&(fr.decompile(e.redeem.output)||[]).some(Ci))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(e.witness&&e.witness.length>0){let a=e.witness[e.witness.length-1];if(e.redeem&&e.redeem.output&&!e.redeem.output.equals(a))throw new TypeError("Witness and redeem.output mismatch");if(e.witness.some(Ci)||(fr.decompile(a)||[]).some(Ci))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(s,e)}Ht.p2wsh=c_});var to=T((Gv,ef)=>{"use strict";h();d();var Js=Kp().Buffer,f_=9007199254740991;function eo(e){if(e<0||e>f_||e%1!==0)throw new RangeError("value out of range")}function Nn(e,t,r){if(eo(e),t||(t=Js.allocUnsafe(Jc(e))),!Js.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),e<253?(t.writeUInt8(e,r),Nn.bytes=1):e<=65535?(t.writeUInt8(253,r),t.writeUInt16LE(e,r+1),Nn.bytes=3):e<=4294967295?(t.writeUInt8(254,r),t.writeUInt32LE(e,r+1),Nn.bytes=5):(t.writeUInt8(255,r),t.writeUInt32LE(e>>>0,r+1),t.writeUInt32LE(e/4294967296|0,r+5),Nn.bytes=9),t}function Cn(e,t){if(!Js.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");t||(t=0);var r=e.readUInt8(t);if(r<253)return Cn.bytes=1,r;if(r===253)return Cn.bytes=3,e.readUInt16LE(t+1);if(r===254)return Cn.bytes=5,e.readUInt32LE(t+1);Cn.bytes=9;var n=e.readUInt32LE(t+1),i=e.readUInt32LE(t+5),s=i*4294967296+n;return eo(s),s}function Jc(e){return eo(e),e<253?1:e<=65535?3:e<=4294967295?5:9}ef.exports={encode:Nn,decode:Cn,encodingLength:Jc}});var Zr=T(oe=>{"use strict";h();d();var l_=oe&&oe.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),p_=oe&&oe.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),tf=oe&&oe.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&l_(t,e,r);return p_(t,e),t};Object.defineProperty(oe,"__esModule",{value:!0});oe.BufferReader=oe.BufferWriter=oe.cloneBuffer=oe.reverseBuffer=oe.writeUInt64LE=oe.readUInt64LE=oe.varuint=void 0;var kr=tf(Pe()),{typeforce:rf}=kr,xn=tf(to());oe.varuint=xn;function nf(e,t){if(typeof e!="number")throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function sf(e,t){let r=e.readUInt32LE(t),n=e.readUInt32LE(t+4);return n*=4294967296,nf(n+r,9007199254740991),n+r}oe.readUInt64LE=sf;function of(e,t,r){return nf(t,9007199254740991),e.writeInt32LE(t&-1,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}oe.writeUInt64LE=of;function h_(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e}oe.reverseBuffer=h_;function d_(e){let t=f.Buffer.allocUnsafe(e.length);return e.copy(t),t}oe.cloneBuffer=d_;var Rn=class{static withCapacity(t){return new Rn(f.Buffer.alloc(t))}constructor(t,r=0){this.buffer=t,this.offset=r,rf(kr.tuple(kr.Buffer,kr.UInt32),[t,r])}writeUInt8(t){this.offset=this.buffer.writeUInt8(t,this.offset)}writeInt32(t){this.offset=this.buffer.writeInt32LE(t,this.offset)}writeUInt32(t){this.offset=this.buffer.writeUInt32LE(t,this.offset)}writeUInt64(t){this.offset=of(this.buffer,t,this.offset)}writeVarInt(t){xn.encode(t,this.buffer,this.offset),this.offset+=xn.encode.bytes}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.offset+=t.copy(this.buffer,this.offset)}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach(r=>this.writeVarSlice(r))}end(){if(this.buffer.length===this.offset)return this.buffer;throw new Error(`buffer size ${this.buffer.length}, offset ${this.offset}`)}};oe.BufferWriter=Rn;var ro=class{constructor(t,r=0){this.buffer=t,this.offset=r,rf(kr.tuple(kr.Buffer,kr.UInt32),[t,r])}readUInt8(){let t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){let t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){let t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){let t=sf(this.buffer,this.offset);return this.offset+=8,t}readVarInt(){let t=xn.decode(this.buffer,this.offset);return this.offset+=xn.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");let r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){let t=this.readVarInt(),r=[];for(let n=0;n<t;n++)r.push(this.readVarSlice());return r}};oe.BufferReader=ro});var Jr=T(Ue=>{"use strict";h();d();var __=Ue&&Ue.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),g_=Ue&&Ue.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),no=Ue&&Ue.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&__(t,e,r);return g_(t,e),t};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.Transaction=Ue.vectorSize=Ue.varSliceSize=void 0;var Q=Zr(),pe=no(St()),af=no(ye()),S_=ye(),K=no(Pe()),{typeforce:yt}=K;function Le(e){let t=e.length;return Q.varuint.encodingLength(t)+t}Ue.varSliceSize=Le;function ff(e){let t=e.length;return Q.varuint.encodingLength(t)+e.reduce((r,n)=>r+Le(n),0)}Ue.vectorSize=ff;var lr=f.Buffer.allocUnsafe(0),uf=[],Qr=f.Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),cf=f.Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),y_=f.Buffer.from("ffffffffffffffff","hex"),m_={script:lr,valueBuffer:y_};function w_(e){return e.value!==void 0}var N=class{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(t,r){let n=new Q.BufferReader(t),i=new N;i.version=n.readInt32();let s=n.readUInt8(),o=n.readUInt8(),a=!1;s===N.ADVANCED_TRANSACTION_MARKER&&o===N.ADVANCED_TRANSACTION_FLAG?a=!0:n.offset-=2;let l=n.readVarInt();for(let c=0;c<l;++c)i.ins.push({hash:n.readSlice(32),index:n.readUInt32(),script:n.readVarSlice(),sequence:n.readUInt32(),witness:uf});let u=n.readVarInt();for(let c=0;c<u;++c)i.outs.push({value:n.readUInt64(),script:n.readVarSlice()});if(a){for(let c=0;c<l;++c)i.ins[c].witness=n.readVector();if(!i.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(i.locktime=n.readUInt32(),r)return i;if(n.offset!==t.length)throw new Error("Transaction has unexpected data");return i}static fromHex(t){return N.fromBuffer(f.Buffer.from(t,"hex"),!1)}static isCoinbaseHash(t){yt(K.Hash256bit,t);for(let r=0;r<32;++r)if(t[r]!==0)return!1;return!0}isCoinbase(){return this.ins.length===1&&N.isCoinbaseHash(this.ins[0].hash)}addInput(t,r,n,i){return yt(K.tuple(K.Hash256bit,K.UInt32,K.maybe(K.UInt32),K.maybe(K.Buffer)),arguments),K.Null(n)&&(n=N.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:r,script:i||lr,sequence:n,witness:uf})-1}addOutput(t,r){return yt(K.tuple(K.Buffer,K.Satoshi),arguments),this.outs.push({script:t,value:r})-1}hasWitnesses(){return this.ins.some(t=>t.witness.length!==0)}weight(){let t=this.byteLength(!1),r=this.byteLength(!0);return t*3+r}virtualSize(){return Math.ceil(this.weight()/4)}dogeByteLength(){let t=26+this.ins.reduce((r,n)=>{let i=40+Le(n.script);return r+32+4+i},0)+this.outs.reduce((r,n)=>r+9+n.script.length,0);return Math.ceil(t)}byteLength(t=!0){let r=t&&this.hasWitnesses();return(r?10:8)+Q.varuint.encodingLength(this.ins.length)+Q.varuint.encodingLength(this.outs.length)+this.ins.reduce((n,i)=>n+40+Le(i.script),0)+this.outs.reduce((n,i)=>n+8+Le(i.script),0)+(r?this.ins.reduce((n,i)=>n+ff(i.witness),0):0)}clone(){let t=new N;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map(r=>({hash:r.hash,index:r.index,script:r.script,sequence:r.sequence,witness:r.witness})),t.outs=this.outs.map(r=>({script:r.script,value:r.value})),t}hashForSignature(t,r,n){if(yt(K.tuple(K.UInt32,K.Buffer,K.Number),arguments),t>=this.ins.length)return cf;let i=af.compile(af.decompile(r).filter(a=>a!==S_.OPS.OP_CODESEPARATOR)),s=this.clone();if((n&31)===N.SIGHASH_NONE)s.outs=[],s.ins.forEach((a,l)=>{l!==t&&(a.sequence=0)});else if((n&31)===N.SIGHASH_SINGLE){if(t>=this.outs.length)return cf;s.outs.length=t+1;for(let a=0;a<t;a++)s.outs[a]=m_;s.ins.forEach((a,l)=>{l!==t&&(a.sequence=0)})}n&N.SIGHASH_ANYONECANPAY?(s.ins=[s.ins[t]],s.ins[0].script=i):(s.ins.forEach(a=>{a.script=lr}),s.ins[t].script=i);let o=f.Buffer.allocUnsafe(s.byteLength(!1)+4);return o.writeInt32LE(n,o.length-4),s.__toBuffer(o,0,!1),pe.hash256(o)}hashForCashSignature(t,r,n,i){if(i&N.SIGHASH_BITCOINCASHBIP143){if(K.Null(n))throw new Error("Bitcoin Cash sighash requires value of input to be signed.");return this.hashForWitnessV0(t,r,n,i)}else return this.hashForSignature(t,r,i)}hashForWitnessV1(t,r,n,i,s,o){if(yt(K.tuple(K.UInt32,yt.arrayOf(K.Buffer),yt.arrayOf(K.Satoshi),K.UInt32),arguments),n.length!==this.ins.length||r.length!==this.ins.length)throw new Error("Must supply prevout script and value for all inputs");let a=i===N.SIGHASH_DEFAULT?N.SIGHASH_ALL:i&N.SIGHASH_OUTPUT_MASK,u=(i&N.SIGHASH_INPUT_MASK)===N.SIGHASH_ANYONECANPAY,c=a===N.SIGHASH_NONE,p=a===N.SIGHASH_SINGLE,_=lr,g=lr,S=lr,y=lr,m=lr;if(!u){let E=Q.BufferWriter.withCapacity(36*this.ins.length);this.ins.forEach(b=>{E.writeSlice(b.hash),E.writeUInt32(b.index)}),_=pe.sha256(E.end()),E=Q.BufferWriter.withCapacity(8*this.ins.length),n.forEach(b=>E.writeUInt64(b)),g=pe.sha256(E.end()),E=Q.BufferWriter.withCapacity(r.map(Le).reduce((b,B)=>b+B)),r.forEach(b=>E.writeVarSlice(b)),S=pe.sha256(E.end()),E=Q.BufferWriter.withCapacity(4*this.ins.length),this.ins.forEach(b=>E.writeUInt32(b.sequence)),y=pe.sha256(E.end())}if(c||p){if(p&&t<this.outs.length){let E=this.outs[t],b=Q.BufferWriter.withCapacity(8+Le(E.script));b.writeUInt64(E.value),b.writeVarSlice(E.script),m=pe.sha256(b.end())}}else{let E=this.outs.map(B=>8+Le(B.script)).reduce((B,F)=>B+F),b=Q.BufferWriter.withCapacity(E);this.outs.forEach(B=>{b.writeUInt64(B.value),b.writeVarSlice(B.script)}),m=pe.sha256(b.end())}let w=(s?2:0)+(o?1:0),A=174-(u?49:0)-(c?32:0)+(o?32:0)+(s?37:0),v=Q.BufferWriter.withCapacity(A);if(v.writeUInt8(i),v.writeInt32(this.version),v.writeUInt32(this.locktime),v.writeSlice(_),v.writeSlice(g),v.writeSlice(S),v.writeSlice(y),c||p||v.writeSlice(m),v.writeUInt8(w),u){let E=this.ins[t];v.writeSlice(E.hash),v.writeUInt32(E.index),v.writeUInt64(n[t]),v.writeVarSlice(r[t]),v.writeUInt32(E.sequence)}else v.writeUInt32(t);if(o){let E=Q.BufferWriter.withCapacity(Le(o));E.writeVarSlice(o),v.writeSlice(pe.sha256(E.end()))}return p&&v.writeSlice(m),s&&(v.writeSlice(s),v.writeUInt8(0),v.writeUInt32(4294967295)),pe.taggedHash("TapSighash",f.Buffer.concat([f.Buffer.of(0),v.end()]))}hashForWitnessV0(t,r,n,i){yt(K.tuple(K.UInt32,K.Buffer,K.Satoshi,K.UInt32),arguments);let s=f.Buffer.from([]),o,a=Qr,l=Qr,u=Qr;if(i&N.SIGHASH_ANYONECANPAY||(s=f.Buffer.allocUnsafe(36*this.ins.length),o=new Q.BufferWriter(s,0),this.ins.forEach(p=>{o.writeSlice(p.hash),o.writeUInt32(p.index)}),l=pe.hash256(s)),!(i&N.SIGHASH_ANYONECANPAY)&&(i&31)!==N.SIGHASH_SINGLE&&(i&31)!==N.SIGHASH_NONE&&(s=f.Buffer.allocUnsafe(4*this.ins.length),o=new Q.BufferWriter(s,0),this.ins.forEach(p=>{o.writeUInt32(p.sequence)}),u=pe.hash256(s)),(i&31)!==N.SIGHASH_SINGLE&&(i&31)!==N.SIGHASH_NONE){let p=this.outs.reduce((_,g)=>_+8+Le(g.script),0);s=f.Buffer.allocUnsafe(p),o=new Q.BufferWriter(s,0),this.outs.forEach(_=>{o.writeUInt64(_.value),o.writeVarSlice(_.script)}),a=pe.hash256(s)}else if((i&31)===N.SIGHASH_SINGLE&&t<this.outs.length){let p=this.outs[t];s=f.Buffer.allocUnsafe(8+Le(p.script)),o=new Q.BufferWriter(s,0),o.writeUInt64(p.value),o.writeVarSlice(p.script),a=pe.hash256(s)}s=f.Buffer.allocUnsafe(156+Le(r)),o=new Q.BufferWriter(s,0);let c=this.ins[t];return o.writeInt32(this.version),o.writeSlice(l),o.writeSlice(u),o.writeSlice(c.hash),o.writeUInt32(c.index),o.writeVarSlice(r),o.writeUInt64(n),o.writeUInt32(c.sequence),o.writeSlice(a),o.writeUInt32(this.locktime),o.writeUInt32(i),pe.hash256(s)}getHash(t){return t&&this.isCoinbase()?f.Buffer.alloc(32,0):pe.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return(0,Q.reverseBuffer)(this.getHash(!1)).toString("hex")}toBuffer(t,r){return this.__toBuffer(t,r,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,r){yt(K.tuple(K.Number,K.Buffer),arguments),this.ins[t].script=r}setWitness(t,r){yt(K.tuple(K.Number,[K.Buffer]),arguments),this.ins[t].witness=r}__toBuffer(t,r,n=!1){t||(t=f.Buffer.allocUnsafe(this.byteLength(n)));let i=new Q.BufferWriter(t,r||0);i.writeInt32(this.version);let s=n&&this.hasWitnesses();return s&&(i.writeUInt8(N.ADVANCED_TRANSACTION_MARKER),i.writeUInt8(N.ADVANCED_TRANSACTION_FLAG)),i.writeVarInt(this.ins.length),this.ins.forEach(o=>{i.writeSlice(o.hash),i.writeUInt32(o.index),i.writeVarSlice(o.script),i.writeUInt32(o.sequence)}),i.writeVarInt(this.outs.length),this.outs.forEach(o=>{w_(o)?i.writeUInt64(o.value):i.writeSlice(o.valueBuffer),i.writeVarSlice(o.script)}),s&&this.ins.forEach(o=>{i.writeVector(o.witness)}),i.writeUInt32(this.locktime),r!==void 0?t.slice(r,i.offset):t}hashForWitness(t,r,n,i){yt(K.tuple(K.UInt32,K.Buffer,K.Satoshi,K.UInt32),arguments);let s=f.Buffer.from([]),o,a=Qr,l=Qr,u=Qr;if(i&N.SIGHASH_ANYONECANPAY||(s=f.Buffer.allocUnsafe(36*this.ins.length),o=new Q.BufferWriter(s,0),this.ins.forEach(p=>{o.writeSlice(p.hash),o.writeUInt32(p.index)}),l=pe.hash256(s)),!(i&N.SIGHASH_ANYONECANPAY)&&(i&31)!==N.SIGHASH_SINGLE&&(i&31)!==N.SIGHASH_NONE&&(s=f.Buffer.allocUnsafe(4*this.ins.length),o=new Q.BufferWriter(s,0),this.ins.forEach(p=>{o.writeUInt32(p.sequence)}),u=pe.hash256(s)),(i&31)!==N.SIGHASH_SINGLE&&(i&31)!==N.SIGHASH_NONE){let p=this.outs.reduce((_,g)=>_+8+Le(g.script),0);s=f.Buffer.allocUnsafe(p),o=new Q.BufferWriter(s,0),this.outs.forEach(_=>{o.writeUInt64(_.value),o.writeVarSlice(_.script)}),a=pe.hash256(s)}else if((i&31)===N.SIGHASH_SINGLE&&t<this.outs.length){let p=this.outs[t];s=f.Buffer.allocUnsafe(8+Le(p.script)),o=new Q.BufferWriter(s,0),o.writeUInt64(p.value),o.writeVarSlice(p.script),a=pe.hash256(s)}s=f.Buffer.allocUnsafe(156+r.length),o=new Q.BufferWriter(s,0);let c=this.ins[t];return o.writeInt32(this.version),o.writeSlice(l),o.writeSlice(u),o.writeSlice(c.hash),o.writeUInt32(c.index),o.writeSlice(r),o.writeUInt64(n),o.writeUInt32(c.sequence),o.writeSlice(a),o.writeUInt32(this.locktime),o.writeUInt32(i),pe.hash256(s)}};Ue.Transaction=N;N.DEFAULT_SEQUENCE=4294967295;N.SIGHASH_DEFAULT=0;N.SIGHASH_ALL=1;N.SIGHASH_NONE=2;N.SIGHASH_SINGLE=3;N.SIGHASH_ANYONECANPAY=128;N.SIGHASH_OUTPUT_MASK=3;N.SIGHASH_INPUT_MASK=128;N.SIGHASH_BITCOINCASHBIP143=64;N.ADVANCED_TRANSACTION_MARKER=0;N.ADVANCED_TRANSACTION_FLAG=1});var me=T(Ie=>{"use strict";h();d();Object.defineProperty(Ie,"__esModule",{value:!0});Ie.OUTPUT_TYPE_NAMES=Ie.OutputTypes=Ie.INPUT_TYPE_NAMES=Ie.InputTypes=Ie.GLOBAL_TYPE_NAMES=Ie.GlobalTypes=void 0;var b_;(function(e){e[e.UNSIGNED_TX=0]="UNSIGNED_TX",e[e.GLOBAL_XPUB=1]="GLOBAL_XPUB"})(b_=Ie.GlobalTypes||(Ie.GlobalTypes={}));Ie.GLOBAL_TYPE_NAMES=["unsignedTx","globalXpub"];var E_;(function(e){e[e.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",e[e.WITNESS_UTXO=1]="WITNESS_UTXO",e[e.PARTIAL_SIG=2]="PARTIAL_SIG",e[e.SIGHASH_TYPE=3]="SIGHASH_TYPE",e[e.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=5]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=6]="BIP32_DERIVATION",e[e.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",e[e.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",e[e.POR_COMMITMENT=9]="POR_COMMITMENT",e[e.TAP_KEY_SIG=19]="TAP_KEY_SIG",e[e.TAP_SCRIPT_SIG=20]="TAP_SCRIPT_SIG",e[e.TAP_LEAF_SCRIPT=21]="TAP_LEAF_SCRIPT",e[e.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=23]="TAP_INTERNAL_KEY",e[e.TAP_MERKLE_ROOT=24]="TAP_MERKLE_ROOT"})(E_=Ie.InputTypes||(Ie.InputTypes={}));Ie.INPUT_TYPE_NAMES=["nonWitnessUtxo","witnessUtxo","partialSig","sighashType","redeemScript","witnessScript","bip32Derivation","finalScriptSig","finalScriptWitness","porCommitment","tapKeySig","tapScriptSig","tapLeafScript","tapBip32Derivation","tapInternalKey","tapMerkleRoot"];var T_;(function(e){e[e.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",e[e.WITNESS_SCRIPT=1]="WITNESS_SCRIPT",e[e.BIP32_DERIVATION=2]="BIP32_DERIVATION",e[e.TAP_INTERNAL_KEY=5]="TAP_INTERNAL_KEY",e[e.TAP_TREE=6]="TAP_TREE",e[e.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(T_=Ie.OutputTypes||(Ie.OutputTypes={}));Ie.OUTPUT_TYPE_NAMES=["redeemScript","witnessScript","bip32Derivation","tapInternalKey","tapTree","tapBip32Derivation"]});var pf=T(Je=>{"use strict";h();d();Object.defineProperty(Je,"__esModule",{value:!0});Je.canAddToArray=Je.check=Je.expected=Je.encode=Je.decode=void 0;var lf=me(),I_=e=>[...Array(e).keys()];function v_(e){if(e.key[0]!==lf.GlobalTypes.GLOBAL_XPUB)throw new Error("Decode Error: could not decode globalXpub with key 0x"+e.key.toString("hex"));if(e.key.length!==79||![2,3].includes(e.key[46]))throw new Error("Decode Error: globalXpub has invalid extended pubkey in key 0x"+e.key.toString("hex"));if(e.value.length/4%1!==0)throw new Error("Decode Error: Global GLOBAL_XPUB value length should be multiple of 4");let t=e.key.slice(1),r={masterFingerprint:e.value.slice(0,4),extendedPubkey:t,path:"m"};for(let n of I_(e.value.length/4-1)){let i=e.value.readUInt32LE(n*4+4),s=!!(i&2147483648),o=i&2147483647;r.path+="/"+o.toString(10)+(s?"'":"")}return r}Je.decode=v_;function O_(e){let t=f.Buffer.from([lf.GlobalTypes.GLOBAL_XPUB]),r=f.Buffer.concat([t,e.extendedPubkey]),n=e.path.split("/"),i=f.Buffer.allocUnsafe(n.length*4);e.masterFingerprint.copy(i,0);let s=4;return n.slice(1).forEach(o=>{let a=o.slice(-1)==="'",l=2147483647&parseInt(a?o.slice(0,-1):o,10);a&&(l+=2147483648),i.writeUInt32LE(l,s),s+=4}),{key:r,value:i}}Je.encode=O_;Je.expected="{ masterFingerprint: Buffer; extendedPubkey: Buffer; path: string; }";function P_(e){let t=e.extendedPubkey,r=e.masterFingerprint,n=e.path;return f.Buffer.isBuffer(t)&&t.length===78&&[2,3].indexOf(t[45])>-1&&f.Buffer.isBuffer(r)&&r.length===4&&typeof n=="string"&&!!n.match(/^m(\/\d+'?)*$/)}Je.check=P_;function A_(e,t,r){let n=t.extendedPubkey.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(i=>i.extendedPubkey.equals(t.extendedPubkey)).length===0)}Je.canAddToArray=A_});var hf=T(xi=>{"use strict";h();d();Object.defineProperty(xi,"__esModule",{value:!0});xi.encode=void 0;var k_=me();function N_(e){return{key:f.Buffer.from([k_.GlobalTypes.UNSIGNED_TX]),value:e.toBuffer()}}xi.encode=N_});var _f=T(et=>{"use strict";h();d();Object.defineProperty(et,"__esModule",{value:!0});et.canAdd=et.check=et.expected=et.encode=et.decode=void 0;var df=me();function C_(e){if(e.key[0]!==df.InputTypes.FINAL_SCRIPTSIG)throw new Error("Decode Error: could not decode finalScriptSig with key 0x"+e.key.toString("hex"));return e.value}et.decode=C_;function x_(e){return{key:f.Buffer.from([df.InputTypes.FINAL_SCRIPTSIG]),value:e}}et.encode=x_;et.expected="Buffer";function R_(e){return f.Buffer.isBuffer(e)}et.check=R_;function H_(e,t){return!!e&&!!t&&e.finalScriptSig===void 0}et.canAdd=H_});var Sf=T(tt=>{"use strict";h();d();Object.defineProperty(tt,"__esModule",{value:!0});tt.canAdd=tt.check=tt.expected=tt.encode=tt.decode=void 0;var gf=me();function B_(e){if(e.key[0]!==gf.InputTypes.FINAL_SCRIPTWITNESS)throw new Error("Decode Error: could not decode finalScriptWitness with key 0x"+e.key.toString("hex"));return e.value}tt.decode=B_;function L_(e){return{key:f.Buffer.from([gf.InputTypes.FINAL_SCRIPTWITNESS]),value:e}}tt.encode=L_;tt.expected="Buffer";function U_(e){return f.Buffer.isBuffer(e)}tt.check=U_;function M_(e,t){return!!e&&!!t&&e.finalScriptWitness===void 0}tt.canAdd=M_});var mf=T(rt=>{"use strict";h();d();Object.defineProperty(rt,"__esModule",{value:!0});rt.canAdd=rt.check=rt.expected=rt.encode=rt.decode=void 0;var yf=me();function D_(e){if(e.key[0]!==yf.InputTypes.NON_WITNESS_UTXO)throw new Error("Decode Error: could not decode nonWitnessUtxo with key 0x"+e.key.toString("hex"));return e.value}rt.decode=D_;function F_(e){return{key:f.Buffer.from([yf.InputTypes.NON_WITNESS_UTXO]),value:e}}rt.encode=F_;rt.expected="Buffer";function K_(e){return f.Buffer.isBuffer(e)}rt.check=K_;function q_(e,t){return!!e&&!!t&&e.nonWitnessUtxo===void 0}rt.canAdd=q_});var bf=T(nt=>{"use strict";h();d();Object.defineProperty(nt,"__esModule",{value:!0});nt.canAddToArray=nt.check=nt.expected=nt.encode=nt.decode=void 0;var wf=me();function j_(e){if(e.key[0]!==wf.InputTypes.PARTIAL_SIG)throw new Error("Decode Error: could not decode partialSig with key 0x"+e.key.toString("hex"));if(!(e.key.length===34||e.key.length===66)||![2,3,4].includes(e.key[1]))throw new Error("Decode Error: partialSig has invalid pubkey in key 0x"+e.key.toString("hex"));return{pubkey:e.key.slice(1),signature:e.value}}nt.decode=j_;function G_(e){let t=f.Buffer.from([wf.InputTypes.PARTIAL_SIG]);return{key:f.Buffer.concat([t,e.pubkey]),value:e.signature}}nt.encode=G_;nt.expected="{ pubkey: Buffer; signature: Buffer; }";function W_(e){return f.Buffer.isBuffer(e.pubkey)&&f.Buffer.isBuffer(e.signature)&&[33,65].includes(e.pubkey.length)&&[2,3,4].includes(e.pubkey[0])&&V_(e.signature)}nt.check=W_;function V_(e){if(!f.Buffer.isBuffer(e)||e.length<9||e[0]!==48||e.length!==e[1]+3||e[2]!==2)return!1;let t=e[3];if(t>33||t<1||e[3+t+1]!==2)return!1;let r=e[3+t+2];return!(r>33||r<1||e.length!==3+t+2+r+2)}function X_(e,t,r){let n=t.pubkey.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(i=>i.pubkey.equals(t.pubkey)).length===0)}nt.canAddToArray=X_});var Tf=T(it=>{"use strict";h();d();Object.defineProperty(it,"__esModule",{value:!0});it.canAdd=it.check=it.expected=it.encode=it.decode=void 0;var Ef=me();function z_(e){if(e.key[0]!==Ef.InputTypes.POR_COMMITMENT)throw new Error("Decode Error: could not decode porCommitment with key 0x"+e.key.toString("hex"));return e.value.toString("utf8")}it.decode=z_;function Y_(e){return{key:f.Buffer.from([Ef.InputTypes.POR_COMMITMENT]),value:f.Buffer.from(e,"utf8")}}it.encode=Y_;it.expected="string";function $_(e){return typeof e=="string"}it.check=$_;function Z_(e,t){return!!e&&!!t&&e.porCommitment===void 0}it.canAdd=Z_});var vf=T(st=>{"use strict";h();d();Object.defineProperty(st,"__esModule",{value:!0});st.canAdd=st.check=st.expected=st.encode=st.decode=void 0;var If=me();function Q_(e){if(e.key[0]!==If.InputTypes.SIGHASH_TYPE)throw new Error("Decode Error: could not decode sighashType with key 0x"+e.key.toString("hex"));return e.value.readUInt32LE(0)}st.decode=Q_;function J_(e){let t=f.Buffer.from([If.InputTypes.SIGHASH_TYPE]),r=f.Buffer.allocUnsafe(4);return r.writeUInt32LE(e,0),{key:t,value:r}}st.encode=J_;st.expected="number";function eg(e){return typeof e=="number"}st.check=eg;function tg(e,t){return!!e&&!!t&&e.sighashType===void 0}st.canAdd=tg});var Af=T(ot=>{"use strict";h();d();Object.defineProperty(ot,"__esModule",{value:!0});ot.canAdd=ot.check=ot.expected=ot.encode=ot.decode=void 0;var Of=me();function rg(e){if(e.key[0]!==Of.InputTypes.TAP_KEY_SIG||e.key.length!==1)throw new Error("Decode Error: could not decode tapKeySig with key 0x"+e.key.toString("hex"));if(!Pf(e.value))throw new Error("Decode Error: tapKeySig not a valid 64-65-byte BIP340 signature");return e.value}ot.decode=rg;function ng(e){return{key:f.Buffer.from([Of.InputTypes.TAP_KEY_SIG]),value:e}}ot.encode=ng;ot.expected="Buffer";function Pf(e){return f.Buffer.isBuffer(e)&&(e.length===64||e.length===65)}ot.check=Pf;function ig(e,t){return!!e&&!!t&&e.tapKeySig===void 0}ot.canAdd=ig});var Nf=T(at=>{"use strict";h();d();Object.defineProperty(at,"__esModule",{value:!0});at.canAddToArray=at.check=at.expected=at.encode=at.decode=void 0;var kf=me();function sg(e){if(e.key[0]!==kf.InputTypes.TAP_LEAF_SCRIPT)throw new Error("Decode Error: could not decode tapLeafScript with key 0x"+e.key.toString("hex"));if((e.key.length-2)%32!==0)throw new Error("Decode Error: tapLeafScript has invalid control block in key 0x"+e.key.toString("hex"));let t=e.value[e.value.length-1];if((e.key[1]&254)!==t)throw new Error("Decode Error: tapLeafScript bad leaf version in key 0x"+e.key.toString("hex"));let r=e.value.slice(0,-1);return{controlBlock:e.key.slice(1),script:r,leafVersion:t}}at.decode=sg;function og(e){let t=f.Buffer.from([kf.InputTypes.TAP_LEAF_SCRIPT]),r=f.Buffer.from([e.leafVersion]);return{key:f.Buffer.concat([t,e.controlBlock]),value:f.Buffer.concat([e.script,r])}}at.encode=og;at.expected="{ controlBlock: Buffer; leafVersion: number, script: Buffer; }";function ag(e){return f.Buffer.isBuffer(e.controlBlock)&&(e.controlBlock.length-1)%32===0&&(e.controlBlock[0]&254)===e.leafVersion&&f.Buffer.isBuffer(e.script)}at.check=ag;function ug(e,t,r){let n=t.controlBlock.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(i=>i.controlBlock.equals(t.controlBlock)).length===0)}at.canAddToArray=ug});var Rf=T(ut=>{"use strict";h();d();Object.defineProperty(ut,"__esModule",{value:!0});ut.canAdd=ut.check=ut.expected=ut.encode=ut.decode=void 0;var Cf=me();function cg(e){if(e.key[0]!==Cf.InputTypes.TAP_MERKLE_ROOT||e.key.length!==1)throw new Error("Decode Error: could not decode tapMerkleRoot with key 0x"+e.key.toString("hex"));if(!xf(e.value))throw new Error("Decode Error: tapMerkleRoot not a 32-byte hash");return e.value}ut.decode=cg;function fg(e){return{key:f.Buffer.from([Cf.InputTypes.TAP_MERKLE_ROOT]),value:e}}ut.encode=fg;ut.expected="Buffer";function xf(e){return f.Buffer.isBuffer(e)&&e.length===32}ut.check=xf;function lg(e,t){return!!e&&!!t&&e.tapMerkleRoot===void 0}ut.canAdd=lg});var Bf=T(ct=>{"use strict";h();d();Object.defineProperty(ct,"__esModule",{value:!0});ct.canAddToArray=ct.check=ct.expected=ct.encode=ct.decode=void 0;var Hf=me();function pg(e){if(e.key[0]!==Hf.InputTypes.TAP_SCRIPT_SIG)throw new Error("Decode Error: could not decode tapScriptSig with key 0x"+e.key.toString("hex"));if(e.key.length!==65)throw new Error("Decode Error: tapScriptSig has invalid key 0x"+e.key.toString("hex"));if(e.value.length!==64&&e.value.length!==65)throw new Error("Decode Error: tapScriptSig has invalid signature in key 0x"+e.key.toString("hex"));let t=e.key.slice(1,33),r=e.key.slice(33);return{pubkey:t,leafHash:r,signature:e.value}}ct.decode=pg;function hg(e){let t=f.Buffer.from([Hf.InputTypes.TAP_SCRIPT_SIG]);return{key:f.Buffer.concat([t,e.pubkey,e.leafHash]),value:e.signature}}ct.encode=hg;ct.expected="{ pubkey: Buffer; leafHash: Buffer; signature: Buffer; }";function dg(e){return f.Buffer.isBuffer(e.pubkey)&&f.Buffer.isBuffer(e.leafHash)&&f.Buffer.isBuffer(e.signature)&&e.pubkey.length===32&&e.leafHash.length===32&&(e.signature.length===64||e.signature.length===65)}ct.check=dg;function _g(e,t,r){let n=t.pubkey.toString("hex")+t.leafHash.toString("hex");return r.has(n)?!1:(r.add(n),e.filter(i=>i.pubkey.equals(t.pubkey)&&i.leafHash.equals(t.leafHash)).length===0)}ct.canAddToArray=_g});var hr=T(pr=>{"use strict";h();d();Object.defineProperty(pr,"__esModule",{value:!0});pr.encodingLength=pr.decode=pr.encode=void 0;var gg=9007199254740991;function io(e){if(e<0||e>gg||e%1!==0)throw new RangeError("value out of range")}function Hn(e,t,r){if(io(e),t||(t=f.Buffer.allocUnsafe(Lf(e))),!f.Buffer.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");return r||(r=0),e<253?(t.writeUInt8(e,r),Object.assign(Hn,{bytes:1})):e<=65535?(t.writeUInt8(253,r),t.writeUInt16LE(e,r+1),Object.assign(Hn,{bytes:3})):e<=4294967295?(t.writeUInt8(254,r),t.writeUInt32LE(e,r+1),Object.assign(Hn,{bytes:5})):(t.writeUInt8(255,r),t.writeUInt32LE(e>>>0,r+1),t.writeUInt32LE(e/4294967296|0,r+5),Object.assign(Hn,{bytes:9})),t}pr.encode=Hn;function Bn(e,t){if(!f.Buffer.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");t||(t=0);let r=e.readUInt8(t);if(r<253)return Object.assign(Bn,{bytes:1}),r;if(r===253)return Object.assign(Bn,{bytes:3}),e.readUInt16LE(t+1);if(r===254)return Object.assign(Bn,{bytes:5}),e.readUInt32LE(t+1);{Object.assign(Bn,{bytes:9});let n=e.readUInt32LE(t+1),s=e.readUInt32LE(t+5)*4294967296+n;return io(s),s}}pr.decode=Bn;function Lf(e){return io(e),e<253?1:e<=65535?3:e<=4294967295?5:9}pr.encodingLength=Lf});var Hi=T(he=>{"use strict";h();d();var Sg=he&&he.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),yg=he&&he.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),mg=he&&he.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Sg(t,e,r);return yg(t,e),t};Object.defineProperty(he,"__esModule",{value:!0});he.writeUInt64LE=he.readUInt64LE=he.keyValToBuffer=he.keyValsToBuffer=he.reverseBuffer=he.range=void 0;var Ri=mg(hr()),wg=e=>[...Array(e).keys()];he.range=wg;function bg(e){if(e.length<1)return e;let t=e.length-1,r=0;for(let n=0;n<e.length/2;n++)r=e[n],e[n]=e[t],e[t]=r,t--;return e}he.reverseBuffer=bg;function Eg(e){let t=e.map(Uf);return t.push(f.Buffer.from([0])),f.Buffer.concat(t)}he.keyValsToBuffer=Eg;function Uf(e){let t=e.key.length,r=e.value.length,n=Ri.encodingLength(t),i=Ri.encodingLength(r),s=f.Buffer.allocUnsafe(n+t+i+r);return Ri.encode(t,s,0),e.key.copy(s,n),Ri.encode(r,s,n+t),e.value.copy(s,n+t+i),s}he.keyValToBuffer=Uf;function Mf(e,t){if(typeof e!="number")throw new Error("cannot write a non-number as a number");if(e<0)throw new Error("specified a negative value for writing an unsigned value");if(e>t)throw new Error("RangeError: value out of range");if(Math.floor(e)!==e)throw new Error("value has a fractional component")}function Tg(e,t){let r=e.readUInt32LE(t),n=e.readUInt32LE(t+4);return n*=4294967296,Mf(n+r,9007199254740991),n+r}he.readUInt64LE=Tg;function Ig(e,t,r){return Mf(t,9007199254740991),e.writeInt32LE(t&-1,r),e.writeUInt32LE(Math.floor(t/4294967296),r+4),r+8}he.writeUInt64LE=Ig});var Kf=T(we=>{"use strict";h();d();var vg=we&&we.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Og=we&&we.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Pg=we&&we.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&vg(t,e,r);return Og(t,e),t};Object.defineProperty(we,"__esModule",{value:!0});we.canAdd=we.check=we.expected=we.encode=we.decode=void 0;var Df=me(),Ff=Hi(),Bi=Pg(hr());function Ag(e){if(e.key[0]!==Df.InputTypes.WITNESS_UTXO)throw new Error("Decode Error: could not decode witnessUtxo with key 0x"+e.key.toString("hex"));let t=(0,Ff.readUInt64LE)(e.value,0),r=8,n=Bi.decode(e.value,r);r+=Bi.encodingLength(n);let i=e.value.slice(r);if(i.length!==n)throw new Error("Decode Error: WITNESS_UTXO script is not proper length");return{script:i,value:t}}we.decode=Ag;function kg(e){let{script:t,value:r}=e,n=Bi.encodingLength(t.length),i=f.Buffer.allocUnsafe(8+n+t.length);return(0,Ff.writeUInt64LE)(i,r,0),Bi.encode(t.length,i,8),t.copy(i,8+n),{key:f.Buffer.from([Df.InputTypes.WITNESS_UTXO]),value:i}}we.encode=kg;we.expected="{ script: Buffer; value: number; }";function Ng(e){return f.Buffer.isBuffer(e.script)&&typeof e.value=="number"}we.check=Ng;function Cg(e,t){return!!e&&!!t&&e.witnessUtxo===void 0}we.canAdd=Cg});var jf=T(be=>{"use strict";h();d();var xg=be&&be.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Rg=be&&be.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Hg=be&&be.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&xg(t,e,r);return Rg(t,e),t};Object.defineProperty(be,"__esModule",{value:!0});be.canAdd=be.check=be.expected=be.encode=be.decode=void 0;var qf=me(),so=Hg(hr());function Bg(e){if(e.key[0]!==qf.OutputTypes.TAP_TREE||e.key.length!==1)throw new Error("Decode Error: could not decode tapTree with key 0x"+e.key.toString("hex"));let t=0,r=[];for(;t<e.value.length;){let n=e.value[t++],i=e.value[t++],s=so.decode(e.value,t);t+=so.encodingLength(s),r.push({depth:n,leafVersion:i,script:e.value.slice(t,t+s)}),t+=s}return{leaves:r}}be.decode=Bg;function Lg(e){let t=f.Buffer.from([qf.OutputTypes.TAP_TREE]),r=[].concat(...e.leaves.map(n=>[f.Buffer.of(n.depth,n.leafVersion),so.encode(n.script.length),n.script]));return{key:t,value:f.Buffer.concat(r)}}be.encode=Lg;be.expected="{ leaves: [{ depth: number; leafVersion: number, script: Buffer; }] }";function Ug(e){return Array.isArray(e.leaves)&&e.leaves.every(t=>t.depth>=0&&t.depth<=128&&(t.leafVersion&254)===t.leafVersion&&f.Buffer.isBuffer(t.script))}be.check=Ug;function Mg(e,t){return!!e&&!!t&&e.tapTree===void 0}be.canAdd=Mg});var oo=T(Li=>{"use strict";h();d();Object.defineProperty(Li,"__esModule",{value:!0});Li.makeConverter=void 0;var Dg=e=>[...Array(e).keys()],Fg=e=>e.length===33&&[2,3].includes(e[0])||e.length===65&&e[0]===4;function Kg(e,t=Fg){function r(a){if(a.key[0]!==e)throw new Error("Decode Error: could not decode bip32Derivation with key 0x"+a.key.toString("hex"));let l=a.key.slice(1);if(!t(l))throw new Error("Decode Error: bip32Derivation has invalid pubkey in key 0x"+a.key.toString("hex"));if(a.value.length/4%1!==0)throw new Error("Decode Error: Input BIP32_DERIVATION value length should be multiple of 4");let u={masterFingerprint:a.value.slice(0,4),pubkey:l,path:"m"};for(let c of Dg(a.value.length/4-1)){let p=a.value.readUInt32LE(c*4+4),_=!!(p&2147483648),g=p&2147483647;u.path+="/"+g.toString(10)+(_?"'":"")}return u}function n(a){let l=f.Buffer.from([e]),u=f.Buffer.concat([l,a.pubkey]),c=a.path.split("/"),p=f.Buffer.allocUnsafe(c.length*4);a.masterFingerprint.copy(p,0);let _=4;return c.slice(1).forEach(g=>{let S=g.slice(-1)==="'",y=2147483647&parseInt(S?g.slice(0,-1):g,10);S&&(y+=2147483648),p.writeUInt32LE(y,_),_+=4}),{key:u,value:p}}let i="{ masterFingerprint: Buffer; pubkey: Buffer; path: string; }";function s(a){return f.Buffer.isBuffer(a.pubkey)&&f.Buffer.isBuffer(a.masterFingerprint)&&typeof a.path=="string"&&t(a.pubkey)&&a.masterFingerprint.length===4}function o(a,l,u){let c=l.pubkey.toString("hex");return u.has(c)?!1:(u.add(c),a.filter(p=>p.pubkey.equals(l.pubkey)).length===0)}return{decode:r,encode:n,check:s,expected:i,canAddToArray:o}}Li.makeConverter=Kg});var Gf=T(Ui=>{"use strict";h();d();Object.defineProperty(Ui,"__esModule",{value:!0});Ui.makeChecker=void 0;function qg(e){return t;function t(r){let n;if(e.includes(r.key[0])&&(n=r.key.slice(1),!(n.length===33||n.length===65)||![2,3,4].includes(n[0])))throw new Error("Format Error: invalid pubkey in key 0x"+r.key.toString("hex"));return n}}Ui.makeChecker=qg});var Wf=T(Mi=>{"use strict";h();d();Object.defineProperty(Mi,"__esModule",{value:!0});Mi.makeConverter=void 0;function jg(e){function t(o){if(o.key[0]!==e)throw new Error("Decode Error: could not decode redeemScript with key 0x"+o.key.toString("hex"));return o.value}function r(o){return{key:f.Buffer.from([e]),value:o}}let n="Buffer";function i(o){return f.Buffer.isBuffer(o)}function s(o,a){return!!o&&!!a&&o.redeemScript===void 0}return{decode:t,encode:r,check:i,expected:n,canAdd:s}}Mi.makeConverter=jg});var Xf=T(Bt=>{"use strict";h();d();var Gg=Bt&&Bt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Wg=Bt&&Bt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Vf=Bt&&Bt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Gg(t,e,r);return Wg(t,e),t};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.makeConverter=void 0;var Di=Vf(hr()),Vg=Vf(oo()),Xg=e=>e.length===32;function zg(e){let t=Vg.makeConverter(e,Xg);function r(o){let a=Di.decode(o.value),l=Di.encodingLength(a),u=t.decode({key:o.key,value:o.value.slice(l+a*32)}),c=new Array(a);for(let p=0,_=l;p<a;p++,_+=32)c[p]=o.value.slice(_,_+32);return{...u,leafHashes:c}}function n(o){let a=t.encode(o),l=Di.encodingLength(o.leafHashes.length),u=f.Buffer.allocUnsafe(l);Di.encode(o.leafHashes.length,u);let c=f.Buffer.concat([u,...o.leafHashes,a.value]);return{...a,value:c}}let i="{ masterFingerprint: Buffer; pubkey: Buffer; path: string; leafHashes: Buffer[]; }";function s(o){return Array.isArray(o.leafHashes)&&o.leafHashes.every(a=>f.Buffer.isBuffer(a)&&a.length===32)&&t.check(o)}return{decode:r,encode:n,check:s,expected:i,canAddToArray:t.canAddToArray}}Bt.makeConverter=zg});var zf=T(Fi=>{"use strict";h();d();Object.defineProperty(Fi,"__esModule",{value:!0});Fi.makeConverter=void 0;function Yg(e){function t(o){if(o.key[0]!==e||o.key.length!==1)throw new Error("Decode Error: could not decode tapInternalKey with key 0x"+o.key.toString("hex"));if(o.value.length!==32)throw new Error("Decode Error: tapInternalKey not a 32-byte x-only pubkey");return o.value}function r(o){return{key:f.Buffer.from([e]),value:o}}let n="Buffer";function i(o){return f.Buffer.isBuffer(o)&&o.length===32}function s(o,a){return!!o&&!!a&&o.tapInternalKey===void 0}return{decode:t,encode:r,check:i,expected:n,canAdd:s}}Fi.makeConverter=Yg});var Yf=T(Ki=>{"use strict";h();d();Object.defineProperty(Ki,"__esModule",{value:!0});Ki.makeConverter=void 0;function $g(e){function t(o){if(o.key[0]!==e)throw new Error("Decode Error: could not decode witnessScript with key 0x"+o.key.toString("hex"));return o.value}function r(o){return{key:f.Buffer.from([e]),value:o}}let n="Buffer";function i(o){return f.Buffer.isBuffer(o)}function s(o,a){return!!o&&!!a&&o.witnessScript===void 0}return{decode:t,encode:r,check:i,expected:n,canAdd:s}}Ki.makeConverter=$g});var qi=T(Me=>{"use strict";h();d();var Zg=Me&&Me.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Qg=Me&&Me.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),de=Me&&Me.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Zg(t,e,r);return Qg(t,e),t};Object.defineProperty(Me,"__esModule",{value:!0});Me.outputs=Me.inputs=Me.globals=void 0;var Xe=me(),Jg=de(pf()),e0=de(hf()),t0=de(_f()),r0=de(Sf()),n0=de(mf()),i0=de(bf()),s0=de(Tf()),o0=de(vf()),a0=de(Af()),u0=de(Nf()),c0=de(Rf()),f0=de(Bf()),l0=de(Kf()),p0=de(jf()),$f=de(oo()),ao=de(Gf()),Zf=de(Wf()),Qf=de(Xf()),Jf=de(zf()),el=de(Yf()),h0={unsignedTx:e0,globalXpub:Jg,checkPubkey:ao.makeChecker([])};Me.globals=h0;var d0={nonWitnessUtxo:n0,partialSig:i0,sighashType:o0,finalScriptSig:t0,finalScriptWitness:r0,porCommitment:s0,witnessUtxo:l0,bip32Derivation:$f.makeConverter(Xe.InputTypes.BIP32_DERIVATION),redeemScript:Zf.makeConverter(Xe.InputTypes.REDEEM_SCRIPT),witnessScript:el.makeConverter(Xe.InputTypes.WITNESS_SCRIPT),checkPubkey:ao.makeChecker([Xe.InputTypes.PARTIAL_SIG,Xe.InputTypes.BIP32_DERIVATION]),tapKeySig:a0,tapScriptSig:f0,tapLeafScript:u0,tapBip32Derivation:Qf.makeConverter(Xe.InputTypes.TAP_BIP32_DERIVATION),tapInternalKey:Jf.makeConverter(Xe.InputTypes.TAP_INTERNAL_KEY),tapMerkleRoot:c0};Me.inputs=d0;var _0={bip32Derivation:$f.makeConverter(Xe.OutputTypes.BIP32_DERIVATION),redeemScript:Zf.makeConverter(Xe.OutputTypes.REDEEM_SCRIPT),witnessScript:el.makeConverter(Xe.OutputTypes.WITNESS_SCRIPT),checkPubkey:ao.makeChecker([Xe.OutputTypes.BIP32_DERIVATION]),tapBip32Derivation:Qf.makeConverter(Xe.OutputTypes.TAP_BIP32_DERIVATION),tapTree:p0,tapInternalKey:Jf.makeConverter(Xe.OutputTypes.TAP_INTERNAL_KEY)};Me.outputs=_0});var il=T(De=>{"use strict";h();d();var g0=De&&De.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),S0=De&&De.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),rl=De&&De.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&g0(t,e,r);return S0(t,e),t};Object.defineProperty(De,"__esModule",{value:!0});De.psbtFromKeyVals=De.checkKeyBuffer=De.psbtFromBuffer=void 0;var J=rl(qi()),ji=Hi(),tl=rl(hr()),M=me();function y0(e,t){let r=0;function n(){let m=tl.decode(e,r);r+=tl.encodingLength(m);let w=e.slice(r,r+m);return r+=m,w}function i(){let m=e.readUInt32BE(r);return r+=4,m}function s(){let m=e.readUInt8(r);return r+=1,m}function o(){let m=n(),w=n();return{key:m,value:w}}function a(){if(r>=e.length)throw new Error("Format Error: Unexpected End of PSBT");let m=e.readUInt8(r)===0;return m&&r++,m}if(i()!==1886610036)throw new Error("Format Error: Invalid Magic Number");if(s()!==255)throw new Error("Format Error: Magic Number must be followed by 0xff separator");let l=[],u={};for(;!a();){let m=o(),w=m.key.toString("hex");if(u[w])throw new Error("Format Error: Keys must be unique for global keymap: key "+w);u[w]=1,l.push(m)}let c=l.filter(m=>m.key[0]===M.GlobalTypes.UNSIGNED_TX);if(c.length!==1)throw new Error("Format Error: Only one UNSIGNED_TX allowed");let p=t(c[0].value),{inputCount:_,outputCount:g}=p.getInputOutputCounts(),S=[],y=[];for(let m of(0,ji.range)(_)){let w={},A=[];for(;!a();){let v=o(),E=v.key.toString("hex");if(w[E])throw new Error("Format Error: Keys must be unique for each input: input index "+m+" key "+E);w[E]=1,A.push(v)}S.push(A)}for(let m of(0,ji.range)(g)){let w={},A=[];for(;!a();){let v=o(),E=v.key.toString("hex");if(w[E])throw new Error("Format Error: Keys must be unique for each output: output index "+m+" key "+E);w[E]=1,A.push(v)}y.push(A)}return nl(p,{globalMapKeyVals:l,inputKeyVals:S,outputKeyVals:y})}De.psbtFromBuffer=y0;function ve(e,t,r){if(!t.equals(f.Buffer.from([r])))throw new Error(`Format Error: Invalid ${e} key: ${t.toString("hex")}`)}De.checkKeyBuffer=ve;function nl(e,{globalMapKeyVals:t,inputKeyVals:r,outputKeyVals:n}){let i={unsignedTx:e},s=0;for(let c of t)switch(c.key[0]){case M.GlobalTypes.UNSIGNED_TX:if(ve("global",c.key,M.GlobalTypes.UNSIGNED_TX),s>0)throw new Error("Format Error: GlobalMap has multiple UNSIGNED_TX");s++;break;case M.GlobalTypes.GLOBAL_XPUB:i.globalXpub===void 0&&(i.globalXpub=[]),i.globalXpub.push(J.globals.globalXpub.decode(c));break;default:i.unknownKeyVals||(i.unknownKeyVals=[]),i.unknownKeyVals.push(c)}let o=r.length,a=n.length,l=[],u=[];for(let c of(0,ji.range)(o)){let p={};for(let _ of r[c])switch(J.inputs.checkPubkey(_),_.key[0]){case M.InputTypes.NON_WITNESS_UTXO:if(ve("input",_.key,M.InputTypes.NON_WITNESS_UTXO),p.nonWitnessUtxo!==void 0)throw new Error("Format Error: Input has multiple NON_WITNESS_UTXO");p.nonWitnessUtxo=J.inputs.nonWitnessUtxo.decode(_);break;case M.InputTypes.WITNESS_UTXO:if(ve("input",_.key,M.InputTypes.WITNESS_UTXO),p.witnessUtxo!==void 0)throw new Error("Format Error: Input has multiple WITNESS_UTXO");p.witnessUtxo=J.inputs.witnessUtxo.decode(_);break;case M.InputTypes.PARTIAL_SIG:p.partialSig===void 0&&(p.partialSig=[]),p.partialSig.push(J.inputs.partialSig.decode(_));break;case M.InputTypes.SIGHASH_TYPE:if(ve("input",_.key,M.InputTypes.SIGHASH_TYPE),p.sighashType!==void 0)throw new Error("Format Error: Input has multiple SIGHASH_TYPE");p.sighashType=J.inputs.sighashType.decode(_);break;case M.InputTypes.REDEEM_SCRIPT:if(ve("input",_.key,M.InputTypes.REDEEM_SCRIPT),p.redeemScript!==void 0)throw new Error("Format Error: Input has multiple REDEEM_SCRIPT");p.redeemScript=J.inputs.redeemScript.decode(_);break;case M.InputTypes.WITNESS_SCRIPT:if(ve("input",_.key,M.InputTypes.WITNESS_SCRIPT),p.witnessScript!==void 0)throw new Error("Format Error: Input has multiple WITNESS_SCRIPT");p.witnessScript=J.inputs.witnessScript.decode(_);break;case M.InputTypes.BIP32_DERIVATION:p.bip32Derivation===void 0&&(p.bip32Derivation=[]),p.bip32Derivation.push(J.inputs.bip32Derivation.decode(_));break;case M.InputTypes.FINAL_SCRIPTSIG:ve("input",_.key,M.InputTypes.FINAL_SCRIPTSIG),p.finalScriptSig=J.inputs.finalScriptSig.decode(_);break;case M.InputTypes.FINAL_SCRIPTWITNESS:ve("input",_.key,M.InputTypes.FINAL_SCRIPTWITNESS),p.finalScriptWitness=J.inputs.finalScriptWitness.decode(_);break;case M.InputTypes.POR_COMMITMENT:ve("input",_.key,M.InputTypes.POR_COMMITMENT),p.porCommitment=J.inputs.porCommitment.decode(_);break;case M.InputTypes.TAP_KEY_SIG:ve("input",_.key,M.InputTypes.TAP_KEY_SIG),p.tapKeySig=J.inputs.tapKeySig.decode(_);break;case M.InputTypes.TAP_SCRIPT_SIG:p.tapScriptSig===void 0&&(p.tapScriptSig=[]),p.tapScriptSig.push(J.inputs.tapScriptSig.decode(_));break;case M.InputTypes.TAP_LEAF_SCRIPT:p.tapLeafScript===void 0&&(p.tapLeafScript=[]),p.tapLeafScript.push(J.inputs.tapLeafScript.decode(_));break;case M.InputTypes.TAP_BIP32_DERIVATION:p.tapBip32Derivation===void 0&&(p.tapBip32Derivation=[]),p.tapBip32Derivation.push(J.inputs.tapBip32Derivation.decode(_));break;case M.InputTypes.TAP_INTERNAL_KEY:ve("input",_.key,M.InputTypes.TAP_INTERNAL_KEY),p.tapInternalKey=J.inputs.tapInternalKey.decode(_);break;case M.InputTypes.TAP_MERKLE_ROOT:ve("input",_.key,M.InputTypes.TAP_MERKLE_ROOT),p.tapMerkleRoot=J.inputs.tapMerkleRoot.decode(_);break;default:p.unknownKeyVals||(p.unknownKeyVals=[]),p.unknownKeyVals.push(_)}l.push(p)}for(let c of(0,ji.range)(a)){let p={};for(let _ of n[c])switch(J.outputs.checkPubkey(_),_.key[0]){case M.OutputTypes.REDEEM_SCRIPT:if(ve("output",_.key,M.OutputTypes.REDEEM_SCRIPT),p.redeemScript!==void 0)throw new Error("Format Error: Output has multiple REDEEM_SCRIPT");p.redeemScript=J.outputs.redeemScript.decode(_);break;case M.OutputTypes.WITNESS_SCRIPT:if(ve("output",_.key,M.OutputTypes.WITNESS_SCRIPT),p.witnessScript!==void 0)throw new Error("Format Error: Output has multiple WITNESS_SCRIPT");p.witnessScript=J.outputs.witnessScript.decode(_);break;case M.OutputTypes.BIP32_DERIVATION:p.bip32Derivation===void 0&&(p.bip32Derivation=[]),p.bip32Derivation.push(J.outputs.bip32Derivation.decode(_));break;case M.OutputTypes.TAP_INTERNAL_KEY:ve("output",_.key,M.OutputTypes.TAP_INTERNAL_KEY),p.tapInternalKey=J.outputs.tapInternalKey.decode(_);break;case M.OutputTypes.TAP_TREE:ve("output",_.key,M.OutputTypes.TAP_TREE),p.tapTree=J.outputs.tapTree.decode(_);break;case M.OutputTypes.TAP_BIP32_DERIVATION:p.tapBip32Derivation===void 0&&(p.tapBip32Derivation=[]),p.tapBip32Derivation.push(J.outputs.tapBip32Derivation.decode(_));break;default:p.unknownKeyVals||(p.unknownKeyVals=[]),p.unknownKeyVals.push(_)}u.push(p)}return{globalMap:i,inputs:l,outputs:u}}De.psbtFromKeyVals=nl});var al=T(ft=>{"use strict";h();d();var m0=ft&&ft.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),w0=ft&&ft.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),b0=ft&&ft.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&m0(t,e,r);return w0(t,e),t};Object.defineProperty(ft,"__esModule",{value:!0});ft.psbtToKeyVals=ft.psbtToBuffer=void 0;var uo=b0(qi()),sl=Hi();function E0({globalMap:e,inputs:t,outputs:r}){let{globalKeyVals:n,inputKeyVals:i,outputKeyVals:s}=ol({globalMap:e,inputs:t,outputs:r}),o=(0,sl.keyValsToBuffer)(n),a=p=>p.length===0?[f.Buffer.from([0])]:p.map(sl.keyValsToBuffer),l=a(i),u=a(s),c=f.Buffer.allocUnsafe(5);return c.writeUIntBE(482972169471,0,5),f.Buffer.concat([c,o].concat(l,u))}ft.psbtToBuffer=E0;var T0=(e,t)=>e.key.compare(t.key);function co(e,t){let r=new Set,n=Object.entries(e).reduce((s,[o,a])=>{if(o==="unknownKeyVals")return s;let l=t[o];if(l===void 0)return s;let u=(Array.isArray(a)?a:[a]).map(l.encode);return u.map(p=>p.key.toString("hex")).forEach(p=>{if(r.has(p))throw new Error("Serialize Error: Duplicate key: "+p);r.add(p)}),s.concat(u)},[]),i=e.unknownKeyVals?e.unknownKeyVals.filter(s=>!r.has(s.key.toString("hex"))):[];return n.concat(i).sort(T0)}function ol({globalMap:e,inputs:t,outputs:r}){return{globalKeyVals:co(e,uo.globals),inputKeyVals:t.map(n=>co(n,uo.inputs)),outputKeyVals:r.map(n=>co(n,uo.outputs))}}ft.psbtToKeyVals=ol});var fo=T(dr=>{"use strict";h();d();var I0=dr&&dr.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),ul=dr&&dr.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&I0(t,e,r)};Object.defineProperty(dr,"__esModule",{value:!0});ul(il(),dr);ul(al(),dr)});var fl=T(Gi=>{"use strict";h();d();Object.defineProperty(Gi,"__esModule",{value:!0});Gi.combine=void 0;var lo=fo();function v0(e){let t=e[0],r=(0,lo.psbtToKeyVals)(t),n=e.slice(1);if(n.length===0)throw new Error("Combine: Nothing to combine");let i=cl(t);if(i===void 0)throw new Error("Combine: Self missing transaction");let s=en(r.globalKeyVals),o=r.inputKeyVals.map(en),a=r.outputKeyVals.map(en);for(let l of n){let u=cl(l);if(u===void 0||!u.toBuffer().equals(i.toBuffer()))throw new Error("Combine: One of the Psbts does not have the same transaction.");let c=(0,lo.psbtToKeyVals)(l);en(c.globalKeyVals).forEach(po(s,r.globalKeyVals,c.globalKeyVals)),c.inputKeyVals.map(en).forEach((S,y)=>S.forEach(po(o[y],r.inputKeyVals[y],c.inputKeyVals[y]))),c.outputKeyVals.map(en).forEach((S,y)=>S.forEach(po(a[y],r.outputKeyVals[y],c.outputKeyVals[y])))}return(0,lo.psbtFromKeyVals)(i,{globalMapKeyVals:r.globalKeyVals,inputKeyVals:r.inputKeyVals,outputKeyVals:r.outputKeyVals})}Gi.combine=v0;function po(e,t,r){return n=>{if(e.has(n))return;let i=r.filter(s=>s.key.toString("hex")===n)[0];t.push(i),e.add(n)}}function cl(e){return e.globalMap.unsignedTx}function en(e){let t=new Set;return e.forEach(r=>{let n=r.key.toString("hex");if(t.has(n))throw new Error("Combine: KeyValue Map keys should be unique");t.add(n)}),t}});var _o=T(G=>{"use strict";h();d();var O0=G&&G.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),P0=G&&G.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),A0=G&&G.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&O0(t,e,r);return P0(t,e),t};Object.defineProperty(G,"__esModule",{value:!0});G.defaultLocktimeSetter=G.defaultVersionSetter=G.addOutputAttributes=G.addInputAttributes=G.updateOutput=G.updateInput=G.updateGlobal=G.inputCheckUncleanFinalized=G.getEnumLength=G.checkHasKey=G.checkForOutput=G.checkForInput=void 0;var k0=A0(qi());function pl(e,t){let r=e[t];if(r===void 0)throw new Error(`No input #${t}`);return r}G.checkForInput=pl;function hl(e,t){let r=e[t];if(r===void 0)throw new Error(`No output #${t}`);return r}G.checkForOutput=hl;function N0(e,t,r){if(e.key[0]<r)throw new Error("Use the method for your specific key instead of addUnknownKeyVal*");if(t&&t.filter(n=>n.key.equals(e.key)).length!==0)throw new Error(`Duplicate Key: ${e.key.toString("hex")}`)}G.checkHasKey=N0;function C0(e){let t=0;return Object.keys(e).forEach(r=>{Number(isNaN(Number(r)))&&t++}),t}G.getEnumLength=C0;function x0(e,t){let r=!1;if(t.nonWitnessUtxo||t.witnessUtxo){let n=!!t.redeemScript,i=!!t.witnessScript,s=!n||!!t.finalScriptSig,o=!i||!!t.finalScriptWitness,a=!!t.finalScriptSig||!!t.finalScriptWitness;r=s&&o&&a}if(r===!1)throw new Error(`Input #${e} has too much or too little data to clean`)}G.inputCheckUncleanFinalized=x0;function ll(e,t,r,n){throw new Error(`Data for ${e} key ${t} is incorrect: Expected ${r} and got ${JSON.stringify(n)}`)}function ho(e){return(t,r)=>{for(let n of Object.keys(t)){let i=t[n],{canAdd:s,canAddToArray:o,check:a,expected:l}=k0[e+"s"][n]||{},u=!!o;if(a)if(u){if(!Array.isArray(i)||r[n]&&!Array.isArray(r[n]))throw new Error(`Key type ${n} must be an array`);i.every(a)||ll(e,n,l,i);let c=r[n]||[],p=new Set;if(!i.every(_=>o(c,_,p)))throw new Error("Can not add duplicate data to array");r[n]=c.concat(i)}else{if(a(i)||ll(e,n,l,i),!s(r,i))throw new Error(`Can not add duplicate data to ${e}`);r[n]=i}}}}G.updateGlobal=ho("global");G.updateInput=ho("input");G.updateOutput=ho("output");function R0(e,t){let r=e.length-1,n=pl(e,r);(0,G.updateInput)(t,n)}G.addInputAttributes=R0;function H0(e,t){let r=e.length-1,n=hl(e,r);(0,G.updateOutput)(t,n)}G.addOutputAttributes=H0;function B0(e,t){if(!f.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Version: Invalid Transaction");return t.writeUInt32LE(e,0),t}G.defaultVersionSetter=B0;function L0(e,t){if(!f.Buffer.isBuffer(t)||t.length<4)throw new Error("Set Locktime: Invalid Transaction");return t.writeUInt32LE(e,t.length-4),t}G.defaultLocktimeSetter=L0});var _l=T(Wi=>{"use strict";h();d();Object.defineProperty(Wi,"__esModule",{value:!0});Wi.Psbt=void 0;var U0=fl(),dl=fo(),go=me(),Oe=_o(),So=class{static fromBase64(t,r){let n=f.Buffer.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r){let n=f.Buffer.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(t,r){let n=(0,dl.psbtFromBuffer)(t,r),i=new this(n.globalMap.unsignedTx);return Object.assign(i,n),i}constructor(t){this.inputs=[],this.outputs=[],this.globalMap={unsignedTx:t}}toBase64(){return this.toBuffer().toString("base64")}toHex(){return this.toBuffer().toString("hex")}toBuffer(){return(0,dl.psbtToBuffer)(this)}updateGlobal(t){return(0,Oe.updateGlobal)(t,this.globalMap),this}updateInput(t,r){let n=(0,Oe.checkForInput)(this.inputs,t);return(0,Oe.updateInput)(r,n),this}updateOutput(t,r){let n=(0,Oe.checkForOutput)(this.outputs,t);return(0,Oe.updateOutput)(r,n),this}addUnknownKeyValToGlobal(t){return(0,Oe.checkHasKey)(t,this.globalMap.unknownKeyVals,(0,Oe.getEnumLength)(go.GlobalTypes)),this.globalMap.unknownKeyVals||(this.globalMap.unknownKeyVals=[]),this.globalMap.unknownKeyVals.push(t),this}addUnknownKeyValToInput(t,r){let n=(0,Oe.checkForInput)(this.inputs,t);return(0,Oe.checkHasKey)(r,n.unknownKeyVals,(0,Oe.getEnumLength)(go.InputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addUnknownKeyValToOutput(t,r){let n=(0,Oe.checkForOutput)(this.outputs,t);return(0,Oe.checkHasKey)(r,n.unknownKeyVals,(0,Oe.getEnumLength)(go.OutputTypes)),n.unknownKeyVals||(n.unknownKeyVals=[]),n.unknownKeyVals.push(r),this}addInput(t){this.globalMap.unsignedTx.addInput(t),this.inputs.push({unknownKeyVals:[]});let r=t.unknownKeyVals||[],n=this.inputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(i=>this.addUnknownKeyValToInput(n,i)),(0,Oe.addInputAttributes)(this.inputs,t),this}addOutput(t){this.globalMap.unsignedTx.addOutput(t),this.outputs.push({unknownKeyVals:[]});let r=t.unknownKeyVals||[],n=this.outputs.length-1;if(!Array.isArray(r))throw new Error("unknownKeyVals must be an Array");return r.forEach(i=>this.addUnknownKeyValToInput(n,i)),(0,Oe.addOutputAttributes)(this.outputs,t),this}clearFinalizedInput(t){let r=(0,Oe.checkForInput)(this.inputs,t);(0,Oe.inputCheckUncleanFinalized)(t,r);for(let n of Object.keys(r))["witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknownKeyVals"].includes(n)||delete r[n];return this}combine(...t){let r=(0,U0.combine)([this].concat(t));return Object.assign(this,r),this}getTransaction(){return this.globalMap.unsignedTx.toBuffer()}};Wi.Psbt=So});var tn=T(z=>{"use strict";h();d();var M0=z&&z.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),D0=z&&z.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),yo=z&&z.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&M0(t,e,r);return D0(t,e),t};Object.defineProperty(z,"__esModule",{value:!0});z.signatureBlocksAction=z.checkInputForSig=z.pubkeyInScript=z.pubkeyPositionInScript=z.witnessStackToScriptWitness=z.isP2TR=z.isP2SHScript=z.isP2WSHScript=z.isP2WPKH=z.isP2PKH=z.isP2PK=z.isP2MS=void 0;var gl=yo(hr()),Ln=yo(ye()),Vi=Jr(),F0=St(),Nr=yo(rn());function Cr(e){return t=>{try{return e({output:t}),!0}catch{return!1}}}z.isP2MS=Cr(Nr.p2ms);z.isP2PK=Cr(Nr.p2pk);z.isP2PKH=Cr(Nr.p2pkh);z.isP2WPKH=Cr(Nr.p2wpkh);z.isP2WSHScript=Cr(Nr.p2wsh);z.isP2SHScript=Cr(Nr.p2sh);z.isP2TR=Cr(Nr.p2tr);function K0(e){let t=f.Buffer.allocUnsafe(0);function r(o){t=f.Buffer.concat([t,f.Buffer.from(o)])}function n(o){let a=t.length,l=gl.encodingLength(o);t=f.Buffer.concat([t,f.Buffer.allocUnsafe(l)]),gl.encode(o,t,a)}function i(o){n(o.length),r(o)}function s(o){n(o.length),o.forEach(i)}return s(e),t}z.witnessStackToScriptWitness=K0;function Sl(e,t){let r=(0,F0.hash160)(e),n=e.slice(1,33),i=Ln.decompile(t);if(i===null)throw new Error("Unknown script error");return i.findIndex(s=>typeof s=="number"?!1:s.equals(e)||s.equals(r)||s.equals(n))}z.pubkeyPositionInScript=Sl;function q0(e,t){return Sl(e,t)!==-1}z.pubkeyInScript=q0;function j0(e,t){return G0(e).some(n=>yl(n,Ln.signature.decode,t))}z.checkInputForSig=j0;function yl(e,t,r){let{hashType:n}=t(e),i=[];switch(n&Vi.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput"),n&31){case Vi.Transaction.SIGHASH_ALL:break;case Vi.Transaction.SIGHASH_SINGLE:case Vi.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence");break}return i.indexOf(r)===-1}z.signatureBlocksAction=yl;function G0(e){let t=[];if((e.partialSig||[]).length===0){if(!e.finalScriptSig&&!e.finalScriptWitness)return[];t=W0(e)}else t=e.partialSig;return t.map(r=>r.signature)}function W0(e){let t=e.finalScriptSig?Ln.decompile(e.finalScriptSig)||[]:[],r=e.finalScriptWitness?Ln.decompile(e.finalScriptWitness)||[]:[];return t.concat(r).filter(n=>f.Buffer.isBuffer(n)&&Ln.isCanonicalScriptSignature(n)).map(n=>({signature:n}))}});var To=T(ne=>{"use strict";h();d();Object.defineProperty(ne,"__esModule",{value:!0});ne.checkTaprootInputForSigs=ne.tapTreeFromList=ne.tapTreeToList=ne.tweakInternalPubKey=ne.checkTaprootOutputFields=ne.checkTaprootInputFields=ne.isTaprootOutput=ne.isTaprootInput=ne.serializeTaprootSignature=ne.tapScriptFinalizer=ne.toXOnly=void 0;var Eo=Pe(),V0=Jr(),Yi=tn(),_r=$i(),X0=rn(),z0=tn(),Y0=e=>e.length===32?e:e.slice(1,33);ne.toXOnly=Y0;function $0(e,t,r){let n=dS(t,e,r);try{let s=pS(t,n).concat(n.script).concat(n.controlBlock);return{finalScriptWitness:(0,Yi.witnessStackToScriptWitness)(s)}}catch(i){throw new Error(`Can not finalize taproot input #${e}: ${i}`)}}ne.tapScriptFinalizer=$0;function Z0(e,t){let r=t?f.Buffer.from([t]):f.Buffer.from([]);return f.Buffer.concat([e,r])}ne.serializeTaprootSignature=Z0;function Xi(e){return e&&!!(e.tapInternalKey||e.tapMerkleRoot||e.tapLeafScript&&e.tapLeafScript.length||e.tapBip32Derivation&&e.tapBip32Derivation.length||e.witnessUtxo&&(0,Yi.isP2TR)(e.witnessUtxo.script))}ne.isTaprootInput=Xi;function zi(e,t){return e&&!!(e.tapInternalKey||e.tapTree||e.tapBip32Derivation&&e.tapBip32Derivation.length||t&&(0,Yi.isP2TR)(t))}ne.isTaprootOutput=zi;function Q0(e,t,r){cS(e,t,r),lS(e,t,r)}ne.checkTaprootInputFields=Q0;function J0(e,t,r){fS(e,t,r),eS(e,t)}ne.checkTaprootOutputFields=J0;function eS(e,t){if(!t.tapTree&&!t.tapInternalKey)return;let r=t.tapInternalKey||e.tapInternalKey,n=t.tapTree||e.tapTree;if(r){let{script:i}=e,s=tS(r,n);if(i&&!i.equals(s))throw new Error("Error adding output. Script or address missmatch.")}}function tS(e,t){let r=t&&ml(t.leaves),{output:n}=(0,X0.p2tr)({internalPubkey:e,scriptTree:r});return n}function rS(e,t){let r=t.tapInternalKey,n=r&&(0,_r.tweakKey)(r,t.tapMerkleRoot);if(!n)throw new Error(`Cannot tweak tap internal key for input #${e}. Public key: ${r&&r.toString("hex")}`);return n.x}ne.tweakInternalPubKey=rS;function nS(e){if(!(0,Eo.isTaptree)(e))throw new Error("Cannot convert taptree to tapleaf list. Expecting a tapree structure.");return wo(e)}ne.tapTreeToList=nS;function ml(e=[]){return e.length===1&&e[0].depth===0?{output:e[0].script,version:e[0].leafVersion}:uS(e)}ne.tapTreeFromList=ml;function iS(e,t){return oS(e).some(n=>(0,z0.signatureBlocksAction)(n,sS,t))}ne.checkTaprootInputForSigs=iS;function sS(e){return{signature:e.slice(0,64),hashType:e.slice(64)[0]||V0.Transaction.SIGHASH_DEFAULT}}function oS(e){let t=[];if(e.tapKeySig&&t.push(e.tapKeySig),e.tapScriptSig&&t.push(...e.tapScriptSig.map(r=>r.signature)),!t.length){let r=aS(e.finalScriptWitness);r&&t.push(r)}return t}function aS(e){if(!e)return;let t=e.slice(2);if(t.length===64||t.length===65)return t}function wo(e,t=[],r=0){if(r>_r.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");return e?(0,Eo.isTapleaf)(e)?(t.push({depth:r,leafVersion:e.version||_r.LEAF_VERSION_TAPSCRIPT,script:e.output}),t):(e[0]&&wo(e[0],t,r+1),e[1]&&wo(e[1],t,r+1),t):[]}function uS(e){let t;for(let r of e)if(t=bo(r,t),!t)throw new Error("No room left to insert tapleaf in tree");return t}function bo(e,t,r=0){if(r>_r.MAX_TAPTREE_DEPTH)throw new Error("Max taptree depth exceeded.");if(e.depth===r)return t?void 0:{output:e.script,version:e.leafVersion};if((0,Eo.isTapleaf)(t))return;let n=bo(e,t&&t[0],r+1);if(n)return[n,t&&t[1]];let i=bo(e,t&&t[1],r+1);if(i)return[t&&t[0],i]}function cS(e,t,r){let n=Xi(e)&&nn(t),i=nn(e)&&Xi(t),s=e===t&&Xi(t)&&nn(t);if(n||i||s)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}function fS(e,t,r){let n=zi(e)&&nn(t),i=nn(e)&&zi(t),s=e===t&&zi(t)&&nn(t);if(n||i||s)throw new Error(`Invalid arguments for Psbt.${r}. Cannot use both taproot and non-taproot fields.`)}function lS(e,t,r){if(t.tapMerkleRoot){let n=(t.tapLeafScript||[]).every(s=>mo(s,t.tapMerkleRoot)),i=(e.tapLeafScript||[]).every(s=>mo(s,t.tapMerkleRoot));if(!n||!i)throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}else if(e.tapMerkleRoot&&!(t.tapLeafScript||[]).every(i=>mo(i,e.tapMerkleRoot)))throw new Error(`Invalid arguments for Psbt.${r}. Tapleaf not part of taptree.`)}function mo(e,t){if(!t)return!0;let r=(0,_r.tapleafHash)({output:e.script,version:e.leafVersion});return(0,_r.rootHashFromPath)(e.controlBlock,r).equals(t)}function pS(e,t){let r=(0,_r.tapleafHash)({output:t.script,version:t.leafVersion});return(e.tapScriptSig||[]).filter(n=>n.leafHash.equals(r)).map(n=>hS(t.script,n)).sort((n,i)=>i.positionInScript-n.positionInScript).map(n=>n.signature)}function hS(e,t){return Object.assign({positionInScript:(0,Yi.pubkeyPositionInScript)(t.pubkey,e)},t)}function dS(e,t,r){if(!e.tapScriptSig||!e.tapScriptSig.length)throw new Error(`Can not finalize taproot input #${t}. No tapleaf script signature provided.`);let n=(e.tapLeafScript||[]).sort((i,s)=>i.controlBlock.length-s.controlBlock.length).find(i=>_S(i,e.tapScriptSig,r));if(!n)throw new Error(`Can not finalize taproot input #${t}. Signature for tapleaf script not found.`);return n}function _S(e,t,r){let n=(0,_r.tapleafHash)({output:e.script,version:e.leafVersion});return(!r||r.equals(n))&&t.find(s=>s.leafHash.equals(n))!==void 0}function nn(e){return e&&!!(e.redeemScript||e.witnessScript||e.bip32Derivation&&e.bip32Derivation.length)}});var rs=T(pt=>{"use strict";h();d();var gS=pt&&pt.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),SS=pt&&pt.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Po=pt&&pt.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&gS(t,e,r);return SS(t,e),t};Object.defineProperty(pt,"__esModule",{value:!0});pt.getHashAndSighashType=pt.Psbt=void 0;var wl=_l(),bl=Po(hr()),Re=_o(),El=xr(),sn=Zr(),yS=Ve(),lt=Po(rn()),mS=$i(),Xt=Po(ye()),ae=Jr(),Y=To(),Ee=tn(),Dn=ke(),wS=ye(),bS=Kn(),ES=Dn.signUtil.schnorr.secp256k1.schnorr,TS={network:yS.bitcoin,maximumFeeRate:5e3},on=class{static fromBase64(t,r={}){let n=f.Buffer.from(t,"base64");return this.fromBuffer(n,r)}static fromHex(t,r={}){let n=f.Buffer.from(t,"hex");return this.fromBuffer(n,r)}static fromBuffer(t,r={}){let n=wl.Psbt.fromBuffer(t,IS),i=new on(r,n);return kS(i.__CACHE.__TX,i.__CACHE),i}constructor(t={},r=new wl.Psbt(new Qi)){this.data=r,this.opts=Object.assign({},TS,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},this.data.inputs.length===0&&this.setVersion(2);let n=(i,s,o,a)=>Object.defineProperty(i,s,{enumerable:o,writable:a});n(this,"__CACHE",!1,!0),n(this,"opts",!1,!0)}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map(t=>({hash:(0,sn.cloneBuffer)(t.hash),index:t.index,sequence:t.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map(t=>{let r;try{r=(0,El.fromOutputScript)(t.script,this.opts.network)}catch{}return{script:(0,sn.cloneBuffer)(t.script),value:t.value,address:r}})}combine(...t){return this.data.combine(...t.map(r=>r.data)),this}clone(){let t=on.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){Zi(t),this.opts.maximumFeeRate=t}setVersion(t){Zi(t),Un(this.data.inputs,"setVersion");let r=this.__CACHE;return r.__TX.version=t,r.__EXTRACTED_TX=void 0,this}setLocktime(t){Zi(t),Un(this.data.inputs,"setLocktime");let r=this.__CACHE;return r.__TX.locktime=t,r.__EXTRACTED_TX=void 0,this}setInputSequence(t,r){Zi(r),Un(this.data.inputs,"setInputSequence");let n=this.__CACHE;if(n.__TX.ins.length<=t)throw new Error("Input index too high");return n.__TX.ins[t].sequence=r,n.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach(r=>this.addInput(r)),this}addInput(t){if(arguments.length>1||!t||t.hash===void 0||t.index===void 0)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");(0,Y.checkTaprootInputFields)(t,t,"addInput"),Un(this.data.inputs,"addInput"),t.witnessScript&&Ji(t.witnessScript);let r=this.__CACHE;this.data.addInput(t);let n=r.__TX.ins[r.__TX.ins.length-1];Cl(r,n);let i=this.data.inputs.length-1,s=this.data.inputs[i];return s.nonWitnessUtxo&&Oo(this.__CACHE,s,i),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach(r=>this.addOutput(r)),this}addOutput(t){if(arguments.length>1||!t||t.value===void 0||t.address===void 0&&t.script===void 0)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");Un(this.data.inputs,"addOutput");let{address:r}=t;if(typeof r=="string"){let{network:i}=this.opts,s=(0,El.toOutputScript)(r,i);t=Object.assign(t,{script:s})}(0,Y.checkTaprootOutputFields)(t,t,"addOutput");let n=this.__CACHE;return this.data.addOutput(t),n.__FEE=void 0,n.__FEE_RATE=void 0,n.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(kl))throw new Error("Not finalized");let r=this.__CACHE;if(t||OS(this,r,this.opts),r.__EXTRACTED_TX)return r.__EXTRACTED_TX;let n=r.__TX.clone();return Ll(this.data.inputs,n,r,!0),n}getFeeRate(){return Pl("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return Pl("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return(0,Re.checkForInput)(this.data.inputs,0),Mn(this.data.inputs.length).forEach(t=>this.finalizeInput(t)),this}finalizeInput(t,r){let n=(0,Re.checkForInput)(this.data.inputs,t);return(0,Y.isTaprootInput)(n)?this._finalizeTaprootInput(t,n,void 0,r):this._finalizeInput(t,n,r)}finalizeTaprootInput(t,r,n=Y.tapScriptFinalizer){let i=(0,Re.checkForInput)(this.data.inputs,t);if((0,Y.isTaprootInput)(i))return this._finalizeTaprootInput(t,i,r,n);throw new Error(`Cannot finalize input #${t}. Not Taproot.`)}_finalizeInput(t,r,n=NS){let{script:i,isP2SH:s,isP2WSH:o,isSegwit:a}=HS(t,r,this.__CACHE);if(!i)throw new Error(`No script found for input #${t}`);PS(r);let{finalScriptSig:l,finalScriptWitness:u}=n(t,r,i,a,s,o);if(l&&this.data.updateInput(t,{finalScriptSig:l}),u&&this.data.updateInput(t,{finalScriptWitness:u}),!l&&!u)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}_finalizeTaprootInput(t,r,n,i=Y.tapScriptFinalizer){if(!r.witnessUtxo)throw new Error(`Cannot finalize input #${t}. Missing withness utxo.`);if(r.tapKeySig){let s=lt.p2tr({output:r.witnessUtxo.script,signature:r.tapKeySig}),o=(0,Ee.witnessStackToScriptWitness)(s.witness);this.data.updateInput(t,{finalScriptWitness:o})}else{let{finalScriptWitness:s}=i(t,r,n);this.data.updateInput(t,{finalScriptWitness:s})}return this.data.clearFinalizedInput(t),this}getInputType(t){let r=(0,Re.checkForInput)(this.data.inputs,t),n=Ul(t,r,this.__CACHE),i=ts(n,t,"input",r.redeemScript||DS(r.finalScriptSig),r.witnessScript||FS(r.finalScriptWitness)),s=i.type==="raw"?"":i.type+"-",o=Fl(i.meaningfulScript);return s+o}inputHasPubkey(t,r){let n=(0,Re.checkForInput)(this.data.inputs,t);return US(r,n,t,this.__CACHE)}inputHasHDKey(t,r){let n=(0,Re.checkForInput)(this.data.inputs,t),i=Il(r);return!!n.bip32Derivation&&n.bip32Derivation.some(i)}outputHasPubkey(t,r){let n=(0,Re.checkForOutput)(this.data.outputs,t);return MS(r,n,t,this.__CACHE)}outputHasHDKey(t,r){let n=(0,Re.checkForOutput)(this.data.outputs,t),i=Il(r);return!!n.bip32Derivation&&n.bip32Derivation.some(i)}validateSignaturesOfAllInputs(t){return(0,Re.checkForInput)(this.data.inputs,0),Mn(this.data.inputs.length).map(n=>this.validateSignaturesOfInput(n,t)).reduce((n,i)=>i===!0&&n,!0)}validateSignaturesOfInput(t,r,n){let i=this.data.inputs[t];return(0,Y.isTaprootInput)(i)?this.validateSignaturesOfTaprootInput(t,r,n):this._validateSignaturesOfInput(t,r,n)}_validateSignaturesOfInput(t,r,n){let i=this.data.inputs[t],s=(i||{}).partialSig;if(!i||!s||s.length<1)throw new Error("No signatures to validate");if(typeof r!="function")throw new Error("Need validator function to validate signatures");let o=n?s.filter(p=>p.pubkey.equals(n)):s;if(o.length<1)throw new Error("No signatures for this pubkey");let a=[],l,u,c;for(let p of o){let _=Xt.signature.decode(p.signature),{hash:g,script:S}=c!==_.hashType?Rl(t,Object.assign({},i,{sighashType:_.hashType}),this.__CACHE,!0):{hash:l,script:u};c=_.hashType,l=g,u=S,Nl(p.pubkey,S,"verify"),a.push(r(p.pubkey,g,_.signature))}return a.every(p=>p===!0)}validateSignaturesOfTaprootInput(t,r,n){let i=this.data.inputs[t],s=(i||{}).tapKeySig,o=(i||{}).tapScriptSig;if(!i&&!s&&!(o&&!o.length))throw new Error("No signatures to validate");if(typeof r!="function")throw new Error("Need validator function to validate signatures");n=n&&(0,Y.toXOnly)(n);let a=n?vo(t,i,this.data.inputs,n,this.__CACHE):xS(t,i,this.data.inputs,this.__CACHE);if(!a.length)throw new Error("No signatures for this pubkey");let l=a.find(u=>!!u.leafHash);if(s&&l&&!r(l.pubkey,l.hash,s))return!1;if(o)for(let u of o){let c=a.find(p=>u.pubkey.equals(p.pubkey));if(c&&!r(u.pubkey,c.hash,u.signature))return!1}return!0}signAllInputsHD(t,r=[ae.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");let n=[];for(let i of Mn(this.data.inputs.length))try{this.signInputHD(i,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(i=>i===!1))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,r=[ae.Transaction.SIGHASH_ALL]){return new Promise((n,i)=>{if(!t||!t.publicKey||!t.fingerprint)return i(new Error("Need HDSigner to sign input"));let s=[],o=[];for(let a of Mn(this.data.inputs.length))o.push(this.signInputHDAsync(a,t,r).then(()=>{s.push(!0)},()=>{s.push(!1)}));return Promise.all(o).then(()=>{if(s.every(a=>a===!1))return i(new Error("No inputs were signed"));n()})})}signInputHD(t,r,n=[ae.Transaction.SIGHASH_ALL]){if(!r||!r.publicKey||!r.fingerprint)throw new Error("Need HDSigner to sign input");return Al(t,this.data.inputs,r).forEach(s=>this.signInput(t,s,n)),this}signInputHDAsync(t,r,n=[ae.Transaction.SIGHASH_ALL]){return new Promise((i,s)=>{if(!r||!r.publicKey||!r.fingerprint)return s(new Error("Need HDSigner to sign input"));let a=Al(t,this.data.inputs,r).map(l=>this.signInputAsync(t,l,n));return Promise.all(a).then(()=>{i()}).catch(s)})}signAllInputs(t,r){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");let n=[];for(let i of Mn(this.data.inputs.length))try{this.signInput(i,t,r),n.push(!0)}catch{n.push(!1)}if(n.every(i=>i===!1))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,r){return new Promise((n,i)=>{if(!t||!t.publicKey)return i(new Error("Need Signer to sign input"));let s=[],o=[];for(let[a]of this.data.inputs.entries())o.push(this.signInputAsync(a,t,r).then(()=>{s.push(!0)},()=>{s.push(!1)}));return Promise.all(o).then(()=>{if(s.every(a=>a===!1))return i(new Error("No inputs were signed"));n()})})}signInput(t,r,n,i){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let s=(0,Re.checkForInput)(this.data.inputs,t);return(0,Y.isTaprootInput)(s)?this._signTaprootInput(t,s,r,i,n):this._signInput(t,r,n)}signTaprootInput(t,r,n,i){if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let s=(0,Re.checkForInput)(this.data.inputs,t);if((0,Y.isTaprootInput)(s))return this._signTaprootInput(t,s,r,n,i);throw new Error(`Input #${t} is not of type Taproot.`)}getHashAndSighashType(t,r,n=[ae.Transaction.SIGHASH_ALL]){let{hash:i,sighashType:s}=Fn(this.data.inputs,t,r,this.__CACHE,n);return{hash:i,sighashType:s}}_signInput(t,r,n=[ae.Transaction.SIGHASH_ALL]){let{hash:i,sighashType:s}=Fn(this.data.inputs,t,r.publicKey,this.__CACHE,n),o=[{pubkey:r.publicKey,signature:Xt.signature.encode(r.sign(i),s)}];return this.data.updateInput(t,{partialSig:o}),this}_signTaprootInput(t,r,n,i,s=[ae.Transaction.SIGHASH_DEFAULT]){let o=this.checkTaprootHashesForSig(t,r,n,i,s),a=o.filter(u=>!u.leafHash).map(u=>(0,Y.serializeTaprootSignature)(n.signSchnorr(u.hash),r.sighashType))[0],l=o.filter(u=>!!u.leafHash).map(u=>({pubkey:(0,Y.toXOnly)(n.publicKey),signature:(0,Y.serializeTaprootSignature)(n.signSchnorr(u.hash),r.sighashType),leafHash:u.leafHash}));return a&&this.data.updateInput(t,{tapKeySig:a}),l.length&&this.data.updateInput(t,{tapScriptSig:l}),this}signInputAsync(t,r,n){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let i=(0,Re.checkForInput)(this.data.inputs,t);return(0,Y.isTaprootInput)(i)?this._signTaprootInputAsync(t,i,r,void 0,n):this._signInputAsync(t,r,n)})}signTaprootInputAsync(t,r,n,i){return Promise.resolve().then(()=>{if(!r||!r.publicKey)throw new Error("Need Signer to sign input");let s=(0,Re.checkForInput)(this.data.inputs,t);if((0,Y.isTaprootInput)(s))return this._signTaprootInputAsync(t,s,r,n,i);throw new Error(`Input #${t} is not of type Taproot.`)})}_signInputAsync(t,r,n=[ae.Transaction.SIGHASH_ALL]){let{hash:i,sighashType:s}=Fn(this.data.inputs,t,r.publicKey,this.__CACHE,n);return Promise.resolve(r.sign(i)).then(o=>{let a=[{pubkey:r.publicKey,signature:Xt.signature.encode(o,s)}];this.data.updateInput(t,{partialSig:a})})}async _signTaprootInputAsync(t,r,n,i,s=[ae.Transaction.SIGHASH_DEFAULT]){let o=this.checkTaprootHashesForSig(t,r,n,i,s),a=[],l=o.filter(c=>!c.leafHash)[0];if(l){let c=Promise.resolve(n.signSchnorr(l.hash)).then(p=>({tapKeySig:(0,Y.serializeTaprootSignature)(p,r.sighashType)}));a.push(c)}let u=o.filter(c=>!!c.leafHash);if(u.length){let c=u.map(p=>Promise.resolve(n.signSchnorr(p.hash)).then(_=>({tapScriptSig:[{pubkey:(0,Y.toXOnly)(n.publicKey),signature:(0,Y.serializeTaprootSignature)(_,r.sighashType),leafHash:p.leafHash}]})));a.push(...c)}return Promise.all(a).then(c=>{c.forEach(p=>this.data.updateInput(t,p))})}checkTaprootHashesForSig(t,r,n,i,s){if(typeof n.signSchnorr!="function")throw new Error(`Need Schnorr Signer to sign taproot input #${t}.`);let o=vo(t,r,this.data.inputs,n.publicKey,this.__CACHE,i,s);if(!o||!o.length)throw new Error(`Can not sign for input #${t} with the key ${n.publicKey.toString("hex")}`);return o}toBuffer(){return Io(this.__CACHE),this.data.toBuffer()}toHex(){return Io(this.__CACHE),this.data.toHex()}toBase64(){return Io(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,r){return r.witnessScript&&Ji(r.witnessScript),(0,Y.checkTaprootInputFields)(this.data.inputs[t],r,"updateInput"),this.data.updateInput(t,r),r.nonWitnessUtxo&&Oo(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,r){let n=this.data.outputs[t];return(0,Y.checkTaprootOutputFields)(n,r,"updateOutput"),this.data.updateOutput(t,r),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,r){return this.data.addUnknownKeyValToInput(t,r),this}addUnknownKeyValToOutput(t,r){return this.data.addUnknownKeyValToOutput(t,r),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}verify(t,r){let n=[ae.Transaction.SIGHASH_SINGLE|ae.Transaction.SIGHASH_ANYONECANPAY,ae.Transaction.SIGHASH_ALL,ae.Transaction.SIGHASH_DEFAULT];for(let i=0;i<this.inputCount;i++)if((0,Y.isTaprootInput)(this.data.inputs[i])){let s=f.Buffer.from((0,bS.taprootTweakPubkey)(t.slice(1))[0]),a=new sn.BufferReader(r).readVector(),l={publicKey:s,sign(p){return f.Buffer.alloc(64)},signSchnorr(p){return f.Buffer.alloc(64)}},c=this.checkTaprootHashesForSig(i,this.data.inputs[i],l,void 0,n).filter(p=>!p.leafHash)[0].hash;if(!ES.verify(Dn.base.toHex(a[0]),Dn.base.toHex(c),Dn.base.toHex(s)))return!1}else{let{hash:s}=Fn(this.data.inputs,i,t,this.__CACHE,n),a=new sn.BufferReader(r).readVector(),l=wS.signature.decode(a[0]).signature,u=a[1];if(!t.equals(u))throw Error("pubKey error");if(!Dn.signUtil.secp256k1.verifyWithNoRecovery(s,l,t))return!1}return!0}};pt.Psbt=on;var IS=e=>new Qi(e),Qi=class{constructor(t=f.Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=ae.Transaction.fromBuffer(t),AS(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(t.hash===void 0||t.index===void 0||!f.Buffer.isBuffer(t.hash)&&typeof t.hash!="string"||typeof t.index!="number")throw new Error("Error adding input.");let r=typeof t.hash=="string"?(0,sn.reverseBuffer)(f.Buffer.from(t.hash,"hex")):t.hash;this.tx.addInput(r,t.index,t.sequence)}addOutput(t){if(t.script===void 0||t.value===void 0||!f.Buffer.isBuffer(t.script)||typeof t.value!="number")throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}};function vS(e,t,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return Tl(1,e.partialSig);case"multisig":let n=lt.p2ms({output:t});return Tl(n.m,e.partialSig,n.pubkeys);default:return!1}}function Io(e){if(e.__UNSAFE_SIGN_NONSEGWIT!==!1)throw new Error("Not BIP174 compliant, can not export")}function Tl(e,t,r){if(!t)return!1;let n;if(r?n=r.map(i=>{let s=KS(i);return t.find(o=>o.pubkey.equals(s))}).filter(i=>!!i):n=t,n.length>e)throw new Error("Too many signatures");return n.length===e}function kl(e){return!!e.finalScriptSig||!!e.finalScriptWitness}function Il(e){return t=>!(!t.masterFingerprint.equals(e.fingerprint)||!e.derivePath(t.path).publicKey.equals(t.pubkey))}function Zi(e){if(typeof e!="number"||e!==Math.floor(e)||e>4294967295||e<0)throw new Error("Invalid 32 bit integer")}function OS(e,t,r){let n=t.__FEE_RATE||e.getFeeRate(),i=t.__EXTRACTED_TX.virtualSize(),s=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(s/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}function Un(e,t){e.forEach(r=>{if((0,Y.isTaprootInput)(r)?(0,Y.checkTaprootInputForSigs)(r,t):(0,Ee.checkInputForSig)(r,t))throw new Error("Can not modify transaction, signatures exist.")})}function PS(e){if(!e.sighashType||!e.partialSig)return;let{partialSig:t,sighashType:r}=e;t.forEach(n=>{let{hashType:i}=Xt.signature.decode(n.signature);if(r!==i)throw new Error("Signature sighash does not match input sighash type")})}function Nl(e,t,r){if(!(0,Ee.pubkeyInScript)(e,t))throw new Error(`Can not ${r} for this input with the key ${e.toString("hex")}`)}function AS(e){if(!e.ins.every(r=>r.script&&r.script.length===0&&r.witness&&r.witness.length===0))throw new Error("Format Error: Transaction ScriptSigs are not empty")}function kS(e,t){e.ins.forEach(r=>{Cl(t,r)})}function Cl(e,t){let r=(0,sn.reverseBuffer)(f.Buffer.from(t.hash)).toString("hex")+":"+t.index;if(e.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");e.__TX_IN_CACHE[r]=1}function xl(e,t){return(r,n,i,s)=>{let o=e({redeem:{output:i}}).output;if(!n.equals(o))throw new Error(`${t} for ${s} #${r} doesn't match the scriptPubKey in the prevout`)}}var vl=xl(lt.p2sh,"Redeem script"),Ol=xl(lt.p2wsh,"Witness script");function Pl(e,t,r,n){if(!r.every(kl))throw new Error(`PSBT must be finalized to calculate ${t}`);if(e==="__FEE_RATE"&&n.__FEE_RATE)return n.__FEE_RATE;if(e==="__FEE"&&n.__FEE)return n.__FEE;let i,s=!0;if(n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,s=!1):i=n.__TX.clone(),Ll(r,i,n,s),e==="__FEE_RATE")return n.__FEE_RATE;if(e==="__FEE")return n.__FEE}function NS(e,t,r,n,i,s){let o=Fl(r);if(!vS(t,r,o))throw new Error(`Can not finalize input #${e}`);return CS(r,o,t.partialSig,n,i,s)}function CS(e,t,r,n,i,s){let o,a,l=RS(e,t,r),u=s?lt.p2wsh({redeem:l}):null,c=i?lt.p2sh({redeem:u||l}):null;return n?(u?a=(0,Ee.witnessStackToScriptWitness)(u.witness):a=(0,Ee.witnessStackToScriptWitness)(l.witness),c&&(o=c.input)):c?o=c.input:o=l.input,{finalScriptSig:o,finalScriptWitness:a}}function Fn(e,t,r,n,i){let s=(0,Re.checkForInput)(e,t),{hash:o,sighashType:a,script:l}=Rl(t,s,n,!1,i);return Nl(r,l,"sign"),{hash:o,sighashType:a}}pt.getHashAndSighashType=Fn;function Rl(e,t,r,n,i){let s=r.__TX,o=t.sighashType||ae.Transaction.SIGHASH_ALL;Hl(o,i);let a,l;if(t.nonWitnessUtxo){let p=es(r,t,e),_=s.ins[e].hash,g=p.getHash();if(!_.equals(g))throw new Error(`Non-witness UTXO hash for input #${e} doesn't match the hash specified in the prevout`);let S=s.ins[e].index;l=p.outs[S]}else if(t.witnessUtxo)l=t.witnessUtxo;else throw new Error("Need a Utxo input item for signing");let{meaningfulScript:u,type:c}=ts(l.script,e,"input",t.redeemScript,t.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(c)>=0)a=s.hashForWitnessV0(e,u,l.value,o);else if((0,Ee.isP2WPKH)(u)){let p=lt.p2pkh({hash:u.slice(2)}).output;a=s.hashForWitnessV0(e,p,l.value,o)}else{if(t.nonWitnessUtxo===void 0&&r.__UNSAFE_SIGN_NONSEGWIT===!1)throw new Error(`Input #${e} has witnessUtxo but non-segwit script: ${u.toString("hex")}`);!n&&r.__UNSAFE_SIGN_NONSEGWIT!==!1&&console.warn(`Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as Psbt's predecesor (TransactionBuilder - now removed) when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.
*********************
PROCEED WITH CAUTION!
*********************`),a=s.hashForSignature(e,u,o)}return{script:u,sighashType:o,hash:a}}function xS(e,t,r,n){let i=[];if(t.tapInternalKey){let o=(0,Y.tweakInternalPubKey)(e,t);i.push(o)}if(t.tapScriptSig){let o=t.tapScriptSig.map(a=>a.pubkey);i.push(...o)}return i.map(o=>vo(e,t,r,o,n)).flat()}function vo(e,t,r,n,i,s,o){let a=i.__TX,l=t.sighashType||ae.Transaction.SIGHASH_DEFAULT;Hl(l,o);let u=r.map((S,y)=>Ml(y,S,i)),c=u.map(S=>S.script),p=u.map(S=>S.value),_=[];if(t.tapInternalKey&&!s){let S=(0,Y.tweakInternalPubKey)(e,t);if((0,Y.toXOnly)(n).equals(S)){let y=a.hashForWitnessV1(e,c,p,l);_.push({pubkey:n,hash:y})}}let g=(t.tapLeafScript||[]).map(S=>{let y=(0,mS.tapleafHash)({output:S.script,version:S.leafVersion});return Object.assign({hash:y},S)}).filter(S=>!s||s.equals(S.hash)).map(S=>{let y=a.hashForWitnessV1(e,c,p,ae.Transaction.SIGHASH_DEFAULT,S.hash);return{pubkey:n,hash:y,leafHash:S.hash}});return _.concat(g)}function Hl(e,t){if(t&&t.indexOf(e)<0){let r=LS(e);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${r}`)}}function RS(e,t,r){let n;switch(t){case"multisig":let i=BS(e,r);n=lt.p2ms({output:e,signatures:i});break;case"pubkey":n=lt.p2pk({output:e,signature:r[0].signature});break;case"pubkeyhash":n=lt.p2pkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=lt.p2wpkh({output:e,pubkey:r[0].pubkey,signature:r[0].signature});break}return n}function HS(e,t,r){let n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!t.redeemScript,i.isP2WSH=!!t.witnessScript,t.witnessScript)i.script=t.witnessScript;else if(t.redeemScript)i.script=t.redeemScript;else if(t.nonWitnessUtxo){let s=es(r,t,e),o=n.ins[e].index;i.script=s.outs[o].script}else t.witnessUtxo&&(i.script=t.witnessUtxo.script);return(t.witnessScript||(0,Ee.isP2WPKH)(i.script))&&(i.isSegwit=!0),i}function Al(e,t,r){let n=(0,Re.checkForInput)(t,e);if(!n.bip32Derivation||n.bip32Derivation.length===0)throw new Error("Need bip32Derivation to sign with HD");let i=n.bip32Derivation.map(o=>{if(o.masterFingerprint.equals(r.fingerprint))return o}).filter(o=>!!o);if(i.length===0)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map(o=>{let a=r.derivePath(o.path);if(!o.pubkey.equals(a.publicKey))throw new Error("pubkey did not match bip32Derivation");return a})}function BS(e,t){return lt.p2ms({output:e}).pubkeys.map(n=>(t.filter(i=>i.pubkey.equals(n))[0]||{}).signature).filter(n=>!!n)}function Bl(e){let t=0;function r(o){return t+=o,e.slice(t-o,t)}function n(){let o=bl.decode(e,t);return t+=bl.decode.bytes,o}function i(){return r(n())}function s(){let o=n(),a=[];for(let l=0;l<o;l++)a.push(i());return a}return s()}function LS(e){let t=e&ae.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(e&31){case ae.Transaction.SIGHASH_ALL:t+="SIGHASH_ALL";break;case ae.Transaction.SIGHASH_SINGLE:t+="SIGHASH_SINGLE";break;case ae.Transaction.SIGHASH_NONE:t+="SIGHASH_NONE";break}return t}function Oo(e,t,r){e.__NON_WITNESS_UTXO_BUF_CACHE[r]=t.nonWitnessUtxo;let n=ae.Transaction.fromBuffer(t.nonWitnessUtxo);e.__NON_WITNESS_UTXO_TX_CACHE[r]=n;let i=e,s=r;delete t.nonWitnessUtxo,Object.defineProperty(t,"nonWitnessUtxo",{enumerable:!0,get(){let o=i.__NON_WITNESS_UTXO_BUF_CACHE[s],a=i.__NON_WITNESS_UTXO_TX_CACHE[s];if(o!==void 0)return o;{let l=a.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[s]=l,l}},set(o){i.__NON_WITNESS_UTXO_BUF_CACHE[s]=o}})}function Ll(e,t,r,n){let i=0;e.forEach((l,u)=>{if(n&&l.finalScriptSig&&(t.ins[u].script=l.finalScriptSig),n&&l.finalScriptWitness&&(t.ins[u].witness=Bl(l.finalScriptWitness)),l.witnessUtxo)i+=l.witnessUtxo.value;else if(l.nonWitnessUtxo){let c=es(r,l,u),p=t.ins[u].index;i+=c.outs[p].value}});let s=t.outs.reduce((l,u)=>l+u.value,0),o=i-s;if(o<0)throw new Error("Outputs are spending more than Inputs");let a=t.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=t,r.__FEE_RATE=Math.floor(o/a)}function es(e,t,r){let n=e.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||Oo(e,t,r),n[r]}function Ul(e,t,r){let{script:n}=Ml(e,t,r);return n}function Ml(e,t,r){if(t.witnessUtxo!==void 0)return{script:t.witnessUtxo.script,value:t.witnessUtxo.value};if(t.nonWitnessUtxo!==void 0){let i=es(r,t,e).outs[r.__TX.ins[e].index];return{script:i.script,value:i.value}}else throw new Error("Can't find pubkey in input without Utxo data")}function US(e,t,r,n){let i=Ul(r,t,n),{meaningfulScript:s}=ts(i,r,"input",t.redeemScript,t.witnessScript);return(0,Ee.pubkeyInScript)(e,s)}function MS(e,t,r,n){let i=n.__TX.outs[r].script,{meaningfulScript:s}=ts(i,r,"output",t.redeemScript,t.witnessScript);return(0,Ee.pubkeyInScript)(e,s)}function DS(e){if(!e)return;let t=Xt.decompile(e);if(!t)return;let r=t[t.length-1];if(!(!f.Buffer.isBuffer(r)||Dl(r)||qS(r)||!Xt.decompile(r)))return r}function FS(e){if(!e)return;let t=Bl(e),r=t[t.length-1];if(!(Dl(r)||!Xt.decompile(r)))return r}function KS(e){if(e.length===65){let t=e[64]&1,r=e.slice(0,33);return r[0]=2|t,r}return e.slice()}function Dl(e){return e.length===33&&Xt.isCanonicalPubKey(e)}function qS(e){return Xt.isCanonicalScriptSignature(e)}function ts(e,t,r,n,i){let s=(0,Ee.isP2SHScript)(e),o=s&&n&&(0,Ee.isP2WSHScript)(n),a=(0,Ee.isP2WSHScript)(e);if(s&&n===void 0)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((a||o)&&i===void 0)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let l;return o?(l=i,vl(t,e,n,r),Ol(t,n,i,r),Ji(l)):a?(l=i,Ol(t,e,i,r),Ji(l)):s?(l=n,vl(t,e,n,r)):l=e,{meaningfulScript:l,type:o?"p2sh-p2wsh":s?"p2sh":a?"p2wsh":"raw"}}function Ji(e){if((0,Ee.isP2WPKH)(e)||(0,Ee.isP2SHScript)(e))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Fl(e){return(0,Ee.isP2WPKH)(e)?"witnesspubkeyhash":(0,Ee.isP2PKH)(e)?"pubkeyhash":(0,Ee.isP2MS)(e)?"multisig":(0,Ee.isP2PK)(e)?"pubkey":"nonstandard"}function Mn(e){return[...Array(e).keys()]}});var Ql=T(C=>{"use strict";h();d();var jS=C&&C.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),GS=C&&C.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),jl=C&&C.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&jS(t,e,r);return GS(t,e),t};Object.defineProperty(C,"__esModule",{value:!0});C.generateMPCSignedPSBT=C.generateMPCUnsignedPSBT=C.generateMPCSignedBuyingTx=C.generateMPCUnsignedBuyingPSBT=C.generateMPCSignedListingPSBT=C.generateMPCUnsignedListingPSBT=C.generateSignedBuyingTx=C.mergeSignedBuyingPsbt=C.generateUnsignedBuyingPsbt=C.generateSignedListingPsbt=C.generateUnsignedListingPsbt=C.extractPsbtTransaction=C.psbtSignImpl=C.signPsbtWithKeyPathAndScriptPathImpl=C.signPsbtWithKeyPathAndScriptPath=C.signPsbtWithKeyPathAndScriptPathBatch=C.psbtDecode=C.psbtSign=C.classicToPsbt=C.buildPsbt=void 0;var Fe=rs(),H=ke(),ce=Wn(),L=Gn(),gr=jl(Kn()),mt=To(),WS=xr(),VS=Zr(),Kl=tn(),Ao=jl(ye()),XS=St(),zS=qp(),qn=H.signUtil.schnorr.secp256k1.schnorr,jn=5e3;function ko(e,t,r){return Gl(e,t,r).toHex()}C.buildPsbt=ko;function Gl(e,t,r){let n=new Fe.Psbt({network:t,maximumFeeRate:r||jn});return e.inputs.forEach(i=>{let s=(0,WS.toOutputScript)(i.address,t),o={hash:i.txId,index:i.vOut,witnessUtxo:{script:s,value:i.amount}},a=(0,ce.getAddressType)(i.address,t||L.networks.bitcoin);i.bip32Derivation&&(a==="segwit_taproot"?o.tapBip32Derivation=i.bip32Derivation.map(l=>{let u=H.base.fromHex(l.pubkey);return u.length!=32&&(u=u.slice(1)),{masterFingerprint:H.base.fromHex(l.masterFingerprint),pubkey:u,path:l.path,leafHashes:l.leafHashes.map(c=>f.Buffer.from(c,"hex"))}}):o.bip32Derivation=i.bip32Derivation.map(l=>({masterFingerprint:H.base.fromHex(l.masterFingerprint),pubkey:H.base.fromHex(l.pubkey),path:l.path}))),a==="legacy"?o.nonWitnessUtxo=H.base.fromHex(i.nonWitnessUtxo):a==="segwit_taproot"?i.publicKey&&(o.tapInternalKey=(0,mt.toXOnly)(H.base.fromHex(i.publicKey))):a==="segwit_nested"&&(o.redeemScript=L.payments.p2wpkh({pubkey:f.Buffer.from(i.publicKey,"hex"),network:t}).output),i.sighashType&&(o.sighashType=i.sighashType),n.addInput(o)}),e.outputs.forEach(i=>{if(i.omniScript)n.addOutput({script:H.base.fromHex(i.omniScript),value:0});else{let s={address:i.address,value:i.amount};i.bip32Derivation&&(s.bip32Derivation=i.bip32Derivation.map(o=>({masterFingerprint:H.base.fromHex(o.masterFingerprint),pubkey:H.base.fromHex(o.pubkey),path:o.path}))),n.addOutput(s)}}),n}C.classicToPsbt=Gl;function No(e,t,r,n){let i=Fe.Psbt.fromBase64(e,{network:r,maximumFeeRate:n||jn});return Xl(i,t,r),i.toBase64()}C.psbtSign=No;function YS(e,t,r){try{let n=Fe.Psbt.fromHex(e,{network:t,maximumFeeRate:r||jn});return n.txInputs?n.txInputs.filter(i=>!i.hash.equals(f.Buffer.alloc(32))).map(i=>({txId:H.base.toHex(H.base.reverseBuffer(i.hash)),vOut:i.index})):[]}catch{let i=Fe.Psbt.fromBase64(e,{network:t,maximumFeeRate:r||jn});return i.txInputs?i.txInputs.filter(s=>!s.hash.equals(f.Buffer.alloc(32))).map(s=>({txId:H.base.toHex(H.base.reverseBuffer(s.hash)),vOut:s.index})):[]}}C.psbtDecode=YS;function $S(e,t,r,n){if(e==null||e.length==0)return[];let i=[],s=n==null?0:n.length,o=0;for(o=0;o<e.length;o++){let a={};o<s&&n&&(a=n[o]);let l=Wl(e[o],t,r,{autoFinalized:a.autoFinalized,toSignInputs:a.toSignInputs});i.push(l)}return i}C.signPsbtWithKeyPathAndScriptPathBatch=$S;function Wl(e,t,r,n={}){let i=xo(e,r);return Vl(i,t,r,n.autoFinalized,n.toSignInputs),i.toHex()}C.signPsbtWithKeyPathAndScriptPath=Wl;function Vl(e,t,r,n,i){r=r||L.networks.bitcoin;let s=(0,ce.privateKeyFromWIF)(t,r),o=new Map;i?.map(p=>{o.set(p.index,p)});let a={psbtIndex:0,needTweak:!0,tweakHash:f.Buffer.alloc(0),toSignInputsMap:o,publicKey:f.Buffer.alloc(0),sign(p){return(0,ce.sign)(p,s)},signSchnorr(p){let _=gr.taprootTweakPrivKey(H.base.fromHex(s));return this.toSignInputsMap?.has(this.psbtIndex)&&this.toSignInputsMap.get(this.psbtIndex)?.disableTweakSigner?f.Buffer.from(qn.sign(p,s,H.base.randomBytes(32))):this.needTweak?(this.needTweak&&this.tweakHash.length>0&&(_=gr.taprootTweakPrivKey(H.base.fromHex(s),this.tweakHash)),f.Buffer.from(qn.sign(p,_,H.base.randomBytes(32)))):f.Buffer.from(qn.sign(p,s,H.base.randomBytes(32)))}},l=[L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL,L.Transaction.SIGHASH_DEFAULT],u=()=>({psbtIndex:0,needTweak:!0,tweakHash:f.Buffer.alloc(0),toSignInputsMap:o,publicKey:f.Buffer.alloc(0),getPrivateKey(){let p=H.base.fromHex(s);return this.needTweak&&(p=f.Buffer.from(gr.taprootTweakPrivKey(p,this.tweakHash))),p},sign(p){return(0,ce.sign)(p,this.getPrivateKey().toString("hex"))},signSchnorr(p){return f.Buffer.from(qn.sign(p,this.getPrivateKey(),H.base.randomBytes(32)))}}),c=()=>[L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL,L.Transaction.SIGHASH_DEFAULT];for(let p=0;p<e.inputCount;p++)if(!(o?.size>0&&!o?.has(p)))if(o?.get(p)?.useTweakSigner!==void 0){let _=e.data.inputs[p],g,S=u(),y=c();S.psbtIndex=p,S.publicKey=(0,ce.wif2Public)(t,r);let m=o.get(p);m.sighashTypes!==void 0&&(y=m.sighashTypes),S.needTweak=m.useTweakSigner,S.needTweak&&(S.publicKey=f.Buffer.from(gr.taprootTweakPubkey((0,mt.toXOnly)((0,ce.wif2Public)(t,r)),S.tweakHash)[0])),(0,mt.isTaprootInput)(_)&&(!_.tapInternalKey&&!_.tapLeafScript&&(_.tapInternalKey=(0,mt.toXOnly)((0,ce.wif2Public)(t,r))),m.tapLeafHashToSign!==void 0&&(g=f.Buffer.from(m.tapLeafHashToSign,"hex")));try{if(e.signInput(p,S,y,g),n!=null&&!n)continue;e.finalizeInput(p)}catch(w){throw w}}else{a.psbtIndex=p;let _=e.data.inputs[p];(0,mt.isTaprootInput)(_)?(_.tapInternalKey||(_.tapInternalKey=(0,mt.toXOnly)((0,ce.wif2Public)(t,r))),a.needTweak=!0,a.publicKey=f.Buffer.from(gr.taprootTweakPubkey((0,mt.toXOnly)((0,ce.wif2Public)(t,r)))[0]),o?.has(p)&&o?.get(p)?.disableTweakSigner&&(a.publicKey=(0,ce.wif2Public)(t,r),a.needTweak=!1),_.tapLeafScript&&_.tapLeafScript?.length>0&&!_.tapMerkleRoot?_.tapLeafScript.map(g=>{g.controlBlock&&g.script&&(a.publicKey=(0,ce.wif2Public)(t,r),a.needTweak=!1)}):_.tapMerkleRoot&&(a.needTweak=!0,a.tweakHash=_.tapMerkleRoot,a.publicKey=f.Buffer.from(gr.taprootTweakPubkey((0,mt.toXOnly)((0,ce.wif2Public)(t,r)),_.tapMerkleRoot)[0]))):(a.needTweak=!1,a.tweakHash=f.Buffer.alloc(0),a.publicKey=(0,ce.wif2Public)(t,r));try{if(o?.has(p)){let g=o?.get(p)?.sighashTypes;g!=null&&(l=g)}if(e.signInput(p,a,l),n!=null&&!n)continue;e.finalizeInput(p)}catch(g){if(o?.size>0&&o?.has(p))throw g}}}C.signPsbtWithKeyPathAndScriptPathImpl=Vl;function Xl(e,t,r){r=r||L.networks.bitcoin;let n=(0,ce.privateKeyFromWIF)(t,r),i={publicKey:f.Buffer.alloc(0),sign(o){return(0,ce.sign)(o,n)},signSchnorr(o){let a=gr.taprootTweakPrivKey(H.base.fromHex(n));return f.Buffer.from(qn.sign(o,a,H.base.randomBytes(32)))}},s=[L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL,L.Transaction.SIGHASH_DEFAULT];for(let o=0;o<e.inputCount;o++){if((0,mt.isTaprootInput)(e.data.inputs[o])){let a=e.data.inputs[o];a.tapInternalKey||(a.tapInternalKey=(0,mt.toXOnly)((0,ce.wif2Public)(t,r))),i.publicKey=f.Buffer.from(gr.taprootTweakPubkey((0,mt.toXOnly)((0,ce.wif2Public)(t,r)))[0])}else i.publicKey=(0,ce.wif2Public)(t,r);try{e.signInput(o,i,s)}catch{}}}C.psbtSignImpl=Xl;function Co(e,t,r){let n=Fe.Psbt.fromHex(e,{network:t,maximumFeeRate:r||jn}),i;try{i=n.finalizeAllInputs().extractTransaction()}catch(s){i=n.extractTransaction(),console.log(s)}return i.toHex()}C.extractPsbtTransaction=Co;function zl(e,t,r){let n=L.address.toOutputScript(e.nftAddress,t);if(((0,Kl.isP2SHScript)(n)||(0,Kl.isP2TR)(n))&&!r)throw new Error("Missing publicKey");let i={inputs:[],outputs:[]},s="bc1pcyj5mt2q4t4py8jnur8vpxvxxchke4pzy7tdr9yvj3u3kdfgrj6sw3rzmr";t===L.networks.testnet&&(s="tb1pcyj5mt2q4t4py8jnur8vpxvxxchke4pzy7tdr9yvj3u3kdfgrj6see4dpv"),i.inputs.push({txId:"0".repeat(64),vOut:0,amount:0,address:s},{txId:"0".repeat(64),vOut:1,amount:0,address:s}),i.outputs.push({address:s,amount:0},{address:s,amount:0}),i.inputs.push({txId:e.nftUtxo.txHash,vOut:e.nftUtxo.vout,address:e.nftAddress,amount:e.nftUtxo.coinAmount,publicKey:r,nonWitnessUtxo:e.nftUtxo.rawTransation,sighashType:L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY}),i.outputs.push({address:e.receiveBtcAddress,amount:e.price});let o=ko(i,t);return H.base.toBase64(H.base.fromHex(o))}C.generateUnsignedListingPsbt=zl;function ZS(e,t,r){let n=H.base.toHex((0,ce.wif2Public)(t,r));return No(zl(e,r,n),t,r)}C.generateSignedListingPsbt=ZS;var Sr=2,QS=600,JS=546;function Yl(e,t,r){let n={inputs:[],outputs:[],address:e.paymentAndChangeAddress,feePerB:e.feeRate};e.dummyUtxos.forEach(o=>{n.inputs.push({txId:o.txHash,vOut:o.vout,address:e.paymentAndChangeAddress,amount:o.coinAmount,publicKey:r,nonWitnessUtxo:o.rawTransation})}),n.outputs.push({address:e.paymentAndChangeAddress,amount:e.dummyUtxos.reduce((o,a)=>o+a.coinAmount,0)});let i=[];e.sellerPsbts.forEach(o=>{let a=Fe.Psbt.fromBase64(o,{network:t}),l=a.data.globalMap.unsignedTx.tx.ins[Sr];i.push(a.data.globalMap.unsignedTx.tx.outs[Sr]);let u=a.data.inputs[Sr].witnessUtxo;u||(u=L.Transaction.fromBuffer(a.data.inputs[Sr].nonWitnessUtxo).outs[l.index]),n.inputs.push({txId:H.base.toHex((0,VS.reverseBuffer)(l.hash)),vOut:l.index,address:L.address.fromOutputScript(u.script,t),amount:u.value,sighashType:L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY}),n.outputs.push({address:e.receiveNftAddress,amount:u.value})}),i.forEach(o=>{n.outputs.push({address:L.address.fromOutputScript(o.script,t),amount:o.value})}),e.paymentUtxos.forEach(o=>{n.inputs.push({txId:o.txHash,vOut:o.vout,address:e.paymentAndChangeAddress,amount:o.coinAmount,publicKey:r,nonWitnessUtxo:o.rawTransation})}),e.dummyUtxos.forEach(()=>{n.outputs.push({address:e.paymentAndChangeAddress,amount:QS})});let s=parseInt((0,ce.signBtc)(n,"",t,void 0,!1,!0));return s>=JS&&n.outputs.push({address:e.paymentAndChangeAddress,amount:s}),H.base.toBase64(H.base.fromHex(ko(n,t)))}C.generateUnsignedBuyingPsbt=Yl;function $l(e,t){let r=Fe.Psbt.fromBase64(e),n=t.length+1;return t.forEach((i,s)=>{let o=Fe.Psbt.fromBase64(i);r.data.globalMap.unsignedTx.tx.ins[n+s]=o.data.globalMap.unsignedTx.tx.ins[Sr],r.data.inputs[n+s]=o.data.inputs[Sr]}),r}C.mergeSignedBuyingPsbt=$l;function ey(e,t,r){let n=H.base.toHex((0,ce.wif2Public)(t,r)),i=No(Yl(e,r,n),t,r);return Co($l(i,e.sellerPsbts).toHex(),r)}C.generateSignedBuyingTx=ey;function ty(e,t,r){let n=Fe.Psbt.fromBase64(e,{network:r}),i=H.base.fromHex(t),s=[L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY],o=[];for(let a=0;a<n.inputCount;a++){if(a!=Sr)continue;let{hash:l,sighashType:u}=n.getHashAndSighashType(a,i,s);o.push(H.base.toHex(l))}return{psbtBase64:e,signHashList:o}}C.generateMPCUnsignedListingPSBT=ty;function ry(e,t,r,n){let i=Fe.Psbt.fromBase64(e,{network:n}),o=[{pubkey:H.base.fromHex(t),signature:Ao.signature.encode(H.base.fromHex(r),L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY)}];return i.data.updateInput(Sr,{partialSig:o}),i.toBase64()}C.generateMPCSignedListingPSBT=ry;function ny(e,t,r,n=1){let i=Fe.Psbt.fromBase64(e,{network:r}),s=H.base.fromHex(t),o=[L.Transaction.SIGHASH_ALL],a=[],l=n+1;for(let u=0;u<i.inputCount;u++){if(u>=l&&u<l+n)continue;let{hash:c,sighashType:p}=i.getHashAndSighashType(u,s,o);a.push(H.base.toHex(c))}return{psbtBase64:e,signHashList:a}}C.generateMPCUnsignedBuyingPSBT=ny;function iy(e,t,r,n,i=1){let s=Fe.Psbt.fromBase64(e,{network:n}),o=H.base.fromHex(t),a=i+1;for(let l=0;l<s.inputCount;l++){if(l>=a&&l<a+i)continue;let u=[{pubkey:o,signature:Ao.signature.encode(H.base.fromHex(r[l]),L.Transaction.SIGHASH_ALL)}];s.data.updateInput(l,{partialSig:u})}return Co(s.toHex(),n)}C.generateMPCSignedBuyingTx=iy;function Zl(e,t,r){let n=xo(e,r),i=H.base.fromHex(t),s=[L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_SINGLE|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL|L.Transaction.SIGHASH_ANYONECANPAY,L.Transaction.SIGHASH_ALL,L.Transaction.SIGHASH_DEFAULT],o=[];for(let l=0;l<n.inputCount;l++)try{let{hash:u,sighashType:c}=n.getHashAndSighashType(l,i,s);o.push(H.base.toHex(u))}catch{let c=ql();o.push(c)}let a=new Map;return o.map((l,u)=>{let c=a.get(l);c=c??0,c!=null&&c>=1&&(o[u]=ql()),a.set(l,c+1)}),{psbtStr:e,signHashList:o}}C.generateMPCUnsignedPSBT=Zl;function ql(){let e=(0,XS.sha256)((0,zS.randomBytes)(32)),t=H.base.toHex(e.slice(0,28));return"ffffffff"+t}function sy(e,t,r,n){let i=xo(e,n),s=H.base.fromHex(t),o=L.Transaction.SIGHASH_ALL,l=Zl(e,t,n).signHashList;for(let u=0;u<i.inputCount;u++){if(l[u].slice(0,8)=="ffffffff")continue;i.data.inputs[u].sighashType!=null&&(o=i.data.inputs[u].sighashType);let c=[{pubkey:s,signature:Ao.signature.encode(H.base.fromHex(r[u]),o)}];try{i.data.updateInput(u,{partialSig:c})}catch{}}return i.toHex()}C.generateMPCSignedPSBT=sy;function xo(e,t){let r;return H.base.isHexString("0x"+e)?r=Fe.Psbt.fromHex(e,{network:t}):r=Fe.Psbt.fromBase64(e,{network:t}),r}});var sp=T(un=>{"use strict";h();d();Object.defineProperty(un,"__esModule",{value:!0});un.verifySimple=un.signSimple=void 0;var an=ke(),ep=xr(),tp=Jr(),rp=rs(),Jl=to(),oy=Ql(),ay=Wn(),np=tn();function ip(e){let t="BIP0322-signed-message",r=an.base.sha256(f.Buffer.from(t)),n=an.base.sha256(f.Buffer.concat([r,r,f.Buffer.from(e)]));return an.base.toHex(n)}async function uy(e,t,r,n){let i=(0,ep.toOutputScript)(t,n),s=f.Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),o=4294967295,a=0,l=f.Buffer.concat([f.Buffer.from("0020","hex"),f.Buffer.from(ip(e),"hex")]),u=new tp.Transaction;u.version=0,u.addInput(s,o,a,l),u.addOutput(i,0);let c=new rp.Psbt({network:n});c.setVersion(0),c.addInput({hash:u.getHash(),index:0,sequence:0,witnessUtxo:{script:i,value:0}}),(0,np.isP2TR)(i)&&c.updateInput(0,{tapInternalKey:(0,ay.wif2Public)(r,n).slice(1)}),c.addOutput({script:f.Buffer.from("6a","hex"),value:0}),(0,oy.psbtSignImpl)(c,r,n),c.finalizeAllInputs();let p=c.extractTransaction();function _(y){return f.Buffer.concat([(0,Jl.encode)(y.byteLength),y])}let g=(0,Jl.encode)(p.ins[0].witness.length),S=f.Buffer.concat([g,...p.ins[0].witness.map(y=>_(y))]);return an.base.toBase64(S)}un.signSimple=uy;function cy(e,t,r,n,i){let s=(0,ep.toOutputScript)(t,i),o=f.Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),a=4294967295,l=0,u=f.Buffer.concat([f.Buffer.from("0020","hex"),f.Buffer.from(ip(e),"hex")]),c=new tp.Transaction;c.version=0,c.addInput(o,a,l,u),c.addOutput(s,0);let p=new rp.Psbt;p.setVersion(0),p.addInput({hash:c.getHash(),index:0,sequence:0,witnessUtxo:{script:s,value:0}});let _=an.base.fromHex(n);return(0,np.isP2TR)(s)&&p.updateInput(0,{tapInternalKey:_.slice(1)}),p.addOutput({script:f.Buffer.from("6a","hex"),value:0}),p.verify(_,f.Buffer.from(an.base.fromBase64(r)))}un.verifySimple=cy});var Gn=T($=>{"use strict";h();d();var fy=$&&$.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),ly=$&&$.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Rr=$&&$.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&fy(t,e,r);return ly(t,e),t};Object.defineProperty($,"__esModule",{value:!0});$.BufferWriter=$.Transaction=$.psbt=$.bip0322=$.script=$.payments=$.networks=$.crypto=$.address=void 0;var py=Rr(xr());$.address=py;var hy=Rr(St());$.crypto=hy;var dy=Rr(Ve());$.networks=dy;var _y=Rr(rn());$.payments=_y;var gy=Rr(ye());$.script=gy;var Sy=Rr(sp());$.bip0322=Sy;var yy=Rr(rs());$.psbt=yy;var my=Jr();Object.defineProperty($,"Transaction",{enumerable:!0,get:function(){return my.Transaction}});var wy=Zr();Object.defineProperty($,"BufferWriter",{enumerable:!0,get:function(){return wy.BufferWriter}})});var ap=T(Lt=>{"use strict";h();d();Object.defineProperty(Lt,"__esModule",{value:!0});Lt.encode=Lt.decode=Lt.encodeRaw=Lt.decodeRaw=void 0;var Ro=ke();function op(e,t){if(t!==void 0&&e[0]!==t)throw new Error("Invalid network version");if(e.length===33)return{version:e[0],privateKey:e.slice(1,33),compressed:!1};if(e.length!==34)throw new Error("Invalid WIF length");if(e[33]!==1)throw new Error("Invalid compression flag");return{version:e[0],privateKey:e.slice(1,33),compressed:!0}}Lt.decodeRaw=op;function Ho(e,t,r){let n=f.Buffer.alloc(r?34:33);return n.writeUInt8(e,0),t.copy(n,1),r&&(n[33]=1),n}Lt.encodeRaw=Ho;function by(e,t){return op(Ro.base.fromBase58Check(e),t)}Lt.decode=by;function Ey(e,t,r){return typeof e=="number"?Ro.base.toBase58Check(Ho(e,t,r)):Ro.base.toBase58Check(Ho(e.version,e.privateKey,e.compressed))}Lt.encode=Ey});var cp=T(Ke=>{"use strict";h();d();var Ty=Ke&&Ke.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Iy=Ke&&Ke.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),vy=Ke&&Ke.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Ty(t,e,r);return Iy(t,e),t};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.countAdjustedVsize=Ke.convertScriptSigAsm=Ke.countScriptSigops=void 0;var Oy=Pn(),Py=Wn(),up=ke(),Ay=vy(Gn());function Vn(e,t=!1,r=!1){if(!e?.length)return 0;let n=0;if(n+=e.match(/OP_CHECKSIG/g)?.length||0,t)n+=20*(e.match(/OP_CHECKMULTISIG/g)?.length||0);else{let i=e.matchAll(/(?:OP_(?:PUSHNUM_)?(\d+))? OP_CHECKMULTISIG/g);for(let s of i){let o=parseInt(s[1]);Number.isInteger(o)?n+=o:n+=20}}return r?n:n*4}Ke.countScriptSigops=Vn;function Xn(e){if(e?.length==0)return"";let t=[],r=0;for(;r<e.length;){let n=e[r];if(n>=1&&n<=78){r++;let i;n===76?(i=e.readUInt8(r),t.push("OP_PUSHDATA1"),r+=1):n===77?(i=e.readUInt16LE(r),t.push("OP_PUSHDATA2"),r+=2):n===78?(i=e.readUInt32LE(r),t.push("OP_PUSHDATA4"),r+=4):(i=n,t.push("OP_PUSHBYTES_"+i));let s=e.slice(r,r+i);if(s.length!==i)break;t.push(s.toString("hex")),r+=s.length}else{if(n===0)t.push("OP_0");else if(n===79)t.push("OP_PUSHNUM_NEG1");else if(n===177)t.push("OP_CLTV");else if(n===178)t.push("OP_CSV");else if(n===186)t.push("OP_CHECKSIGADD");else{let i=Oy.REVERSE_OPS[n];i&&n<253?/^OP_(\d+)$/.test(i)?t.push(i.replace(/^OP_(\d+)$/,"OP_PUSHNUM_$1")):t.push(i):t.push("OP_RETURN_"+n)}r+=1}}return t.join(" ")}Ke.convertScriptSigAsm=Xn;function ky(e,t,r){if(e==null)return 0;r==null&&(r=Ay.networks.bitcoin);let n=0;(t!=null||null)&&t.length==e.ins.length&&e.ins.forEach((s,o)=>{if(s.script!=null&&(n+=Vn(Xn(s.script),!0)),t.length<=o||t[o]==null||null||t[o]=="")return;let a=(0,Py.getAddressType)(t[o],r);switch(!0){case(a==="segwit_nested"&&s.witness?.length===2&&s.script&&up.base.toHex(s.script).startsWith("160014")):case a==="segwit_native":n+=1;break;case(a==="segwit_nested"&&s.witness?.length&&s.script&&up.base.toHex(s.script).startsWith("220020")):case a==="segwit_native":s.witness?.length&&(n+=Vn(Xn(s.witness[s.witness.length-1]),!1,!0));break;case a==="segwit_nested":s.script&&(n+=Vn(Xn(s.script)));break}});for(let s of e.outs)s&&(n+=Vn(Xn(s.script),!0));let i=e.virtualSize();return i>n*5?i:n*5}Ke.countAdjustedVsize=ky});var Wn=T(D=>{"use strict";h();d();var Ny=D&&D.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Cy=D&&D.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),zn=D&&D.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Ny(t,e,r);return Cy(t,e),t};Object.defineProperty(D,"__esModule",{value:!0});D.estimateBchFee=D.estimateBtcFee=D.ValidSignedTransaction=D.getMPCTransaction=D.calculateBchTxSize=D.calculateTxSize=D.signBch=D.getAddressType=D.signBtc=D.TxBuild=D.private2Wif=D.wif2Public=D.sign=D.private2public=D.privateKeyFromWIF=D.Array=void 0;var q=zn(Gn()),lp=Gn(),O=ke(),pp=zn(ap()),fp=xr(),hp=zn(St()),dp=zn(Kn()),zt=zn(ye()),yr=Pn(),xy=cp(),_p=O.signUtil.schnorr.secp256k1.schnorr;D.Array=O.typeforce.Array;function Bo(e,t){let r=pp.decode(e),n=r.version;if((0,D.Array)(t)){if(t=t.filter(i=>n===i.wif).pop(),!t)throw new Error("Unknown network version")}else if(t=t||q.networks.bitcoin,n!==t.wif)throw new Error("Invalid network version");return O.base.toHex(r.privateKey)}D.privateKeyFromWIF=Bo;function Lo(e){return O.signUtil.secp256k1.publicKeyCreate(O.base.fromHex(e),!0)}D.private2public=Lo;function ns(e,t){let{signature:r}=O.signUtil.secp256k1.sign(e,O.base.fromHex(t));return f.Buffer.from(r)}D.sign=ns;function Ry(e,t){let r=Bo(e,t);return Lo(r)}D.wif2Public=Ry;function Yn(e,t){return t=t||q.networks.bitcoin,pp.encode(t.wif,e,!0)}D.private2Wif=Yn;var Hr=class{constructor(t,r,n,i){this.tx=new q.Transaction,this.network=q.networks.bitcoin,t?this.tx.version=t:this.tx.version=2,r&&(this.network=r),this.inputs=[],this.outputs=[],this.bitcoinCash=n||!1,this.hardware=i||!1}addInput(t,r,n,i,s,o,a,l){this.inputs.push({txId:t,index:r,privateKey:n,address:i,script:s,value:o,publicKey:a,sequence:l})}addOutput(t,r,n){this.outputs.push({address:t,value:r,omniScript:n})}build(t){let r=[];for(let n of this.inputs){let i=O.base.reverseBuffer(f.Buffer.from(n.txId,"hex"));this.tx.addInput(i,n.index,n.sequence),n.privateKey?r.push(Bo(n.privateKey,this.network)):r.push("")}for(let n of this.outputs)if(n.omniScript)this.tx.addOutput(O.base.fromHex(n.omniScript),0);else{let i=q.address.toOutputScript(n.address,this.network);this.tx.addOutput(i,n.value)}if(this.hardware)return this.tx.toHex();for(let n=0;n<r.length;n++){let i=r[n],s;i?s=Lo(i):this.hardware||(s=O.base.fromHex(this.inputs[n].publicKey));let o,a=q.Transaction.SIGHASH_ALL;if(this.bitcoinCash){let l=q.payments.p2pkh({pubkey:s}).output;a=q.Transaction.SIGHASH_ALL|q.Transaction.SIGHASH_BITCOINCASHBIP143;let u=this.inputs[n].value||0;o=this.tx.hashForCashSignature(n,l,u,a);let c;t?(t.push(O.base.toHex(o)),c=f.Buffer.alloc(64,0)):c=ns(o,i);let p=q.payments.p2pkh({output:l,pubkey:s,signature:q.script.signature.encode(c,a)});p.input&&(this.tx.ins[n].script=p.input)}else{let l=gp(this.inputs[n].address,this.network);if(l==="legacy"){let u=q.payments.p2pkh({pubkey:s}).output;o=this.tx.hashForSignature(n,u,a);let c;t?(t.push(O.base.toHex(o)),c=f.Buffer.alloc(64,0)):c=ns(o,i);let p=q.payments.p2pkh({output:u,pubkey:s,signature:q.script.signature.encode(c,a)});p.input&&(this.tx.ins[n].script=p.input)}else if(l==="segwit_taproot"){let u=this.inputs.map(_=>q.address.toOutputScript(_.address,this.network)),c=this.inputs.map(_=>_.value);o=this.tx.hashForWitnessV1(n,u,c,q.Transaction.SIGHASH_DEFAULT);let p;if(t)t.push(O.base.toHex(o)),p=f.Buffer.alloc(64,0);else{let _=dp.taprootTweakPrivKey(O.base.fromHex(i));p=f.Buffer.from(_p.sign(o,_,O.base.randomBytes(32)))}this.tx.ins[n].witness=[f.Buffer.from(p)]}else{let u=hp.hash160(s),c=f.Buffer.of(25,118,169,20,...u,136,172),p=this.inputs[n].value||0;o=this.tx.hashForWitness(n,c,p,a);let _;t?(t.push(O.base.toHex(o)),_=f.Buffer.alloc(64,0)):_=ns(o,i),this.tx.ins[n].witness=[],this.tx.ins[n].witness.push(q.script.signature.encode(_,a)),this.tx.ins[n].witness.push(s);let g=f.Buffer.of(22,0,20,...u);l!=="segwit_native"&&(this.tx.ins[n].script=g)}}}return this.tx.toHex()}virtualSize(){return(0,xy.countAdjustedVsize)(this.tx,this.inputs.map(t=>t.address),this.network||q.networks.bitcoin)}};D.TxBuild=Hr;function Hy(e,t,r,n,i,s){let o=e.inputs,a=e.outputs,l=e.address,u=e.feePerB||10,c=e.dustSize||546;if(r=r||q.networks.bitcoin,e.memo&&(O.base.isHexString(e.memo)?O.base.fromHex(e.memo):f.Buffer.from(O.base.toUtf8(e.memo))).length>80)throw new Error("data after op_return is  too long");let p=t;if(p||(p=Yn(O.base.fromHex("853fd8960ff34838208d662ecd3b9f8cf413e13e0f74f95e554f8089f5058db0"),r)),s){let{inputAmount:w,outputAmount:A,virtualSize:v}=is(o,a,l,p,r,c,!1,e.memo,e.memoPos);return(w-A-v*u).toString()}let{inputAmount:_,outputAmount:g,virtualSize:S}=is(o,a,l,p,r,c,!1,e.memo,e.memoPos),y=_-g-S*u,m=new Hr(2,r,!1,i);for(let w=0;w<o.length;w++){let A=o[w],v=A.privateKey||t,E=A.address||l;m.addInput(A.txId,A.vOut,v,E,A.reedScript,A.amount,A.publicKey,A.sequence)}e.memo&&e.memoPos==0&&m.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(e.memo)?O.base.fromHex(e.memo):f.Buffer.from(O.base.toUtf8(e.memo))))));for(let w=0;w<a.length;w++){let A=a[w];m.addOutput(A.address,A.amount,A.omniScript),e.memo&&e.memoPos&&m.outputs.length==e.memoPos&&m.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(e.memo)?O.base.fromHex(e.memo):f.Buffer.from(O.base.toUtf8(e.memo))))))}return y>c&&(m.addOutput(l,y),e.memo&&e.memoPos&&m.outputs.length==e.memoPos&&m.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(e.memo)?O.base.fromHex(e.memo):f.Buffer.from(O.base.toUtf8(e.memo))))))),e.memo&&(e.memoPos==null||e.memoPos<0||e.memoPos>m.outputs.length)&&m.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(e.memo)?O.base.fromHex(e.memo):f.Buffer.from(O.base.toUtf8(e.memo)))))),m.build(n)}D.signBtc=Hy;function gp(e,t){let r,n;try{r=(0,fp.fromBase58Check)(e)}catch{}if(r){if(r.version===t.pubKeyHash)return"legacy";if(r.version===t.scriptHash)return"segwit_nested"}else{try{n=(0,fp.fromBech32)(e)}catch{}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(n.version===0)return"segwit_native";if(n.version===1)return"segwit_taproot"}}return"legacy"}D.getAddressType=gp;function By(e,t,r,n,i){let s=e.inputs,o=e.outputs,a=e.address,l=e.feePerB||10,u=e.dustSize||546;r=r||q.networks.bitcoin;let c=t;c||(c=Yn(O.base.fromHex("853fd8960ff34838208d662ecd3b9f8cf413e13e0f74f95e554f8089f5058db0"),r));let{inputAmount:p,outputAmount:_,virtualSize:g}=Uo(s,o,a,c,r,u),S=p-_-g*l,y=new Hr(2,r,!0,i);for(let m=0;m<s.length;m++){let w=s[m];y.addInput(w.txId,w.vOut,t,a,void 0,w.amount,w.publicKey,w.sequence)}for(let m=0;m<o.length;m++){let w=o[m];y.addOutput(w.address,w.amount)}return S>u&&y.addOutput(a,S),y.build(n)}D.signBch=By;function is(e,t,r,n,i,s,o,a,l){let u=new Hr(2,i,!1,o),c=0;for(let S=0;S<e.length;S++){let y=e[S],m=y.privateKey||n,w=y.address||r;u.addInput(y.txId,y.vOut,m,w,y.reedScript,y.amount,y.publicKey,y.sequence),c=c+(y.amount||0)}a&&l==0&&u.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(a)?O.base.fromHex(a):f.Buffer.from(O.base.toUtf8(a))))));let p=0;for(let S=0;S<t.length;S++){let y=t[S];u.addOutput(y.address,y.amount,y.omniScript),p=p+y.amount,a&&l&&u.outputs.length==l&&u.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(a)?O.base.fromHex(a):f.Buffer.from(O.base.toUtf8(a))))))}c-p>s&&(u.addOutput(r,c-p),a&&l&&u.outputs.length==l&&u.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(a)?O.base.fromHex(a):f.Buffer.from(O.base.toUtf8(a))))))),a&&(l==null||l<0||l>u.outputs.length)&&u.addOutput("",0,O.base.toHex(zt.compile([yr.OPS.OP_RETURN].concat(O.base.isHexString(a)?O.base.fromHex(a):f.Buffer.from(O.base.toUtf8(a))))));let _=u.build(),g=u.virtualSize();return{inputAmount:c,outputAmount:p,virtualSize:g,txHex:_}}D.calculateTxSize=is;function Uo(e,t,r,n,i,s,o){let a=new Hr(2,i,!0,o),l=0;for(let _=0;_<e.length;_++){let g=e[_];a.addInput(g.txId,g.vOut,n,r,void 0,g.amount,g.publicKey,g.sequence),l=l+(g.amount||0)}let u=0;for(let _=0;_<t.length;_++){let g=t[_];a.addOutput(g.address,g.amount),u=u+g.amount}l-u>s&&a.addOutput(r,l-u);let c=a.build(),p=a.tx.virtualSize();return{inputAmount:l,outputAmount:u,virtualSize:p,txHex:c}}D.calculateBchTxSize=Uo;function Ly(e,t,r){let n=lp.Transaction.fromBuffer(O.base.fromHex(e),!1);for(let i=0;i<n.ins.length;i++){let s=n.ins[i],o=O.base.fromHex(t[i]),a=q.Transaction.SIGHASH_ALL;if(r){a=q.Transaction.SIGHASH_ALL|q.Transaction.SIGHASH_BITCOINCASHBIP143;let l=q.payments.p2pkh({input:s.script}),u=q.payments.p2pkh({pubkey:l.pubkey,signature:q.script.signature.encode(o,a)});u.input&&(s.script=u.input)}else{let l;if(s.witness.length===2)l="segwit_native";else if(s.witness.length===1)l="segwit_taproot";else if(s.witness.length===0)l="legacy";else throw Error("unknown witness length");if(l==="legacy"){let u=q.payments.p2pkh({input:s.script}),c=q.payments.p2pkh({pubkey:u.pubkey,signature:q.script.signature.encode(o,a)});c.input&&(s.script=c.input)}else l==="segwit_taproot"?s.witness=[o]:s.witness[0]=q.script.signature.encode(o,a)}}return n.toHex()}D.getMPCTransaction=Ly;function Uy(e,t,r){let n=lp.Transaction.fromBuffer(O.base.fromHex(e),!1);if(!t)return n;for(let i=0;i<n.ins.length;i++){let s=n.ins[i],o=t[i],a;if(s.witness.length===2)a="segwit_native";else if(s.witness.length===1)a="segwit_taproot";else if(s.witness.length===0)a="legacy";else throw Error("unknown witness length");if(a==="legacy"){let l=zt.decompile(s.script),u=l[0],c=l[1],p=q.script.signature.decode(u),_=q.address.toOutputScript(o.address,r),g=n.hashForSignature(i,_,p.hashType);if(!O.signUtil.secp256k1.verifyWithNoRecovery(g,p.signature,c))throw Error("signature error")}else if(a==="segwit_native"){let l=s.witness[0],u=s.witness[1],c=q.script.signature.decode(l),p=f.Buffer.of(25,118,169,20,...hp.hash160(u),136,172),_=n.hashForWitness(i,p,o.value,c.hashType);if(!O.signUtil.secp256k1.verifyWithNoRecovery(_,c.signature,u))throw Error("signature error")}else{let l=s.witness[0],u=t.map(g=>q.address.toOutputScript(g.address,r)),c=t.map(g=>g.value),p=n.hashForWitnessV1(i,u,c,q.Transaction.SIGHASH_DEFAULT),_=dp.taprootTweakPubkey(O.base.fromHex(o.publicKey).slice(1))[0];if(!_p.verify(O.base.toHex(l),O.base.toHex(p),O.base.toHex(_)))throw Error("signature error")}}for(let i of n.ins)i.hash=O.base.reverseBuffer(i.hash);return n}D.ValidSignedTransaction=Uy;function My(e,t){let r=e.inputs,n=e.outputs,i=e.feePerB||10,s=e.dustSize||546;t=t||q.networks.bitcoin;let o=Yn(O.base.fromHex("853fd8960ff34838208d662ecd3b9f8cf413e13e0f74f95e554f8089f5058db0"),t),{virtualSize:a}=is(r,n,e.address,o,t,s,!1,e.memo);return a*i}D.estimateBtcFee=My;function Dy(e,t){let r=e.inputs,n=e.outputs,i=e.feePerB||10,s=e.dustSize||546;t=t||q.networks.bitcoin;let o=Yn(O.base.fromHex("853fd8960ff34838208d662ecd3b9f8cf413e13e0f74f95e554f8089f5058db0"),t),{virtualSize:a}=Uo(r,n,e.address,o,t,s);return a*i}D.estimateBchFee=Dy});var Kn=T(mr=>{"use strict";h();d();Object.defineProperty(mr,"__esModule",{value:!0});mr.taprootSignSighash=mr.taprootTweakPubkey=mr.taprootTweakPrivKey=void 0;var Mo=ke(),Fy=Wn(),Fo=Mo.signUtil.schnorr.secp256k1,ss=Fo.schnorr,Sp=Fo.secp256k1.ProjectivePoint,Do=Fo.secp256k1.CURVE.n;function yp(e,t){let r=ss.utils,n=r.taggedHash("TapTweak",e,t),i=r.bytesToNumberBE(n);if(i>=Do)throw new Error("tweak higher than curve order");return i}function mp(e,t=new Uint8Array){let r=ss.utils,n=r.bytesToNumberBE(e),i=Sp.fromPrivateKey(n),s=i.hasEvenY()?n:r.mod(-n,Do),o=r.pointToBytes(i),a=yp(o,t);return r.numberToBytesBE(r.mod(s+a,Do),32)}mr.taprootTweakPrivKey=mp;function Ky(e,t){t||(t=new Uint8Array);let r=ss.utils,n=yp(e,t),s=r.lift_x(r.bytesToNumberBE(e)).add(Sp.fromPrivateKey(n)),o=s.hasEvenY()?0:1;return[r.pointToBytes(s),o]}mr.taprootTweakPubkey=Ky;function qy(e,t,r){let n=mp(Mo.base.fromHex((0,Fy.privateKeyFromWIF)(e)));return t.map(s=>{let o=f.Buffer.from(ss.sign(s,n,r));return Mo.base.toHex(o)})}mr.taprootSignSighash=qy});var $i=T(ee=>{"use strict";h();d();var jy=ee&&ee.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Gy=ee&&ee.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Wy=ee&&ee.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&jy(t,e,r);return Gy(t,e),t};Object.defineProperty(ee,"__esModule",{value:!0});ee.tweakKey=ee.tapTweakHash=ee.tapleafHash=ee.findScriptPath=ee.toHashTree=ee.rootHashFromPath=ee.MAX_TAPTREE_DEPTH=ee.LEAF_VERSION_TAPSCRIPT=void 0;var wr=fs(),Go=Wy(St()),wp=Zr(),Vy=Pe(),Xy=Kn();ee.LEAF_VERSION_TAPSCRIPT=192;ee.MAX_TAPTREE_DEPTH=128;var zy=e=>"left"in e&&"right"in e;function Yy(e,t){if(e.length<33)throw new TypeError(`The control-block length is too small. Got ${e.length}, expected min 33.`);let r=(e.length-33)/32,n=t;for(let i=0;i<r;i++){let s=e.slice(33+32*i,65+32*i);n.compare(s)<0?n=jo(n,s):n=jo(s,n)}return n}ee.rootHashFromPath=Yy;function Ko(e){if((0,Vy.isTapleaf)(e))return{hash:bp(e)};let t=[Ko(e[0]),Ko(e[1])];t.sort((i,s)=>i.hash.compare(s.hash));let[r,n]=t;return{hash:jo(r.hash,n.hash),left:r,right:n}}ee.toHashTree=Ko;function qo(e,t){if(zy(e)){let r=qo(e.left,t);if(r!==void 0)return[...r,e.right.hash];let n=qo(e.right,t);if(n!==void 0)return[...n,e.left.hash]}else if(e.hash.equals(t))return[]}ee.findScriptPath=qo;function bp(e){let t=e.version||ee.LEAF_VERSION_TAPSCRIPT;return Go.taggedHash("TapLeaf",wr.Buffer.concat([wr.Buffer.from([t]),Qy(e.output)]))}ee.tapleafHash=bp;function $y(e,t){return Go.taggedHash("TapTweak",wr.Buffer.concat(t?[e,t]:[e]))}ee.tapTweakHash=$y;function Zy(e,t){if(!wr.Buffer.isBuffer(e)||e.length!==32||t&&t.length!==32)return null;let r=(0,Xy.taprootTweakPubkey)(e,t);return{parity:r[1],x:wr.Buffer.from(r[0])}}ee.tweakKey=Zy;function jo(e,t){return Go.taggedHash("TapBranch",wr.Buffer.concat([e,t]))}function Qy(e){let t=wp.varuint.encodingLength(e.length),r=wr.Buffer.allocUnsafe(t);return wp.varuint.encode(e.length,r),wr.Buffer.concat([r,e])}});var vp=T(Ut=>{"use strict";h();d();var Jy=Ut&&Ut.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),em=Ut&&Ut.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ip=Ut&&Ut.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Jy(t,e,r);return em(t,e),t};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.p2tr=void 0;var os=fs(),tm=Ve(),Wo=Ip(ye()),V=Pe(),qe=$i(),ht=Ip(qt()),as=ke(),Ep=Wo.OPS,Tp=1,rm=80;function nm(e,t){if(!e.address&&!e.output&&!e.pubkey&&!e.internalPubkey&&!(e.witness&&e.witness.length>1))throw new TypeError("Not enough data");t=Object.assign({validate:!0},t||{}),(0,V.typeforce)({address:V.typeforce.maybe(V.typeforce.String),input:V.typeforce.maybe(V.typeforce.BufferN(0)),network:V.typeforce.maybe(V.typeforce.Object),output:V.typeforce.maybe(V.typeforce.BufferN(34)),internalPubkey:V.typeforce.maybe(V.typeforce.BufferN(32)),hash:V.typeforce.maybe(V.typeforce.BufferN(32)),pubkey:V.typeforce.maybe(V.typeforce.BufferN(32)),witness:V.typeforce.maybe(V.typeforce.arrayOf(V.typeforce.Buffer)),scriptTree:V.typeforce.maybe(V.isTaptree),redeem:V.typeforce.maybe({output:V.typeforce.maybe(V.typeforce.Buffer),redeemVersion:V.typeforce.maybe(V.typeforce.Number),witness:V.typeforce.maybe(V.typeforce.arrayOf(V.typeforce.Buffer))}),redeemVersion:V.typeforce.maybe(V.typeforce.Number)},e);let r=ht.value(()=>{let a=as.base.bech32m.decode(e.address),l=a.words.shift(),u=as.base.bech32m.fromWords(a.words);return{version:l,prefix:a.prefix,data:os.Buffer.from(u)}}),n=ht.value(()=>{if(!(!e.witness||!e.witness.length))return e.witness.length>=2&&e.witness[e.witness.length-1][0]===rm?e.witness.slice(0,-1):e.witness.slice()}),i=ht.value(()=>{if(e.scriptTree)return(0,qe.toHashTree)(e.scriptTree);if(e.hash)return{hash:e.hash}}),s=e.network||tm.bitcoin,o={name:"p2tr",network:s};if(ht.prop(o,"address",()=>{if(!o.pubkey)return;let a=as.base.bech32m.toWords(o.pubkey);return a.unshift(Tp),as.base.bech32m.encode(s.bech32,a)}),ht.prop(o,"hash",()=>{let a=i();if(a)return a.hash;let l=n();if(l&&l.length>1){let u=l[l.length-1],c=u[0]&V.TAPLEAF_VERSION_MASK,p=l[l.length-2],_=(0,qe.tapleafHash)({output:p,version:c});return(0,qe.rootHashFromPath)(u,_)}return null}),ht.prop(o,"output",()=>{if(!!o.pubkey)return Wo.compile([Ep.OP_1,o.pubkey])}),ht.prop(o,"redeemVersion",()=>e.redeemVersion?e.redeemVersion:e.redeem&&e.redeem.redeemVersion!==void 0&&e.redeem.redeemVersion!==null?e.redeem.redeemVersion:qe.LEAF_VERSION_TAPSCRIPT),ht.prop(o,"redeem",()=>{let a=n();if(!(!a||a.length<2))return{output:a[a.length-2],witness:a.slice(0,-2),redeemVersion:a[a.length-1][0]&V.TAPLEAF_VERSION_MASK}}),ht.prop(o,"pubkey",()=>{if(e.pubkey)return e.pubkey;if(e.output)return e.output.slice(2);if(e.address)return r().data;if(o.internalPubkey){let a=(0,qe.tweakKey)(o.internalPubkey,o.hash);if(a)return a.x}}),ht.prop(o,"internalPubkey",()=>{if(e.internalPubkey)return e.internalPubkey;let a=n();if(a&&a.length>1)return a[a.length-1].slice(1,33)}),ht.prop(o,"signature",()=>{if(e.signature)return e.signature;let a=n();if(!(!a||a.length!==1))return a[0]}),ht.prop(o,"witness",()=>{if(e.witness)return e.witness;let a=i();if(a&&e.redeem&&e.redeem.output&&e.internalPubkey){let l=(0,qe.tapleafHash)({output:e.redeem.output,version:o.redeemVersion}),u=(0,qe.findScriptPath)(a,l);if(!u)return;let c=(0,qe.tweakKey)(e.internalPubkey,a.hash);if(!c)return;let p=os.Buffer.concat([os.Buffer.from([o.redeemVersion|c.parity]),e.internalPubkey].concat(u));return[e.redeem.output,p]}if(e.signature)return[e.signature]}),t.validate){let a=os.Buffer.from([]);if(e.address){if(s&&s.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(r().version!==Tp)throw new TypeError("Invalid address version");if(r().data.length!==32)throw new TypeError("Invalid address data");a=r().data}if(e.pubkey){if(a.length>0&&!a.equals(e.pubkey))throw new TypeError("Pubkey mismatch");a=e.pubkey}if(e.output){if(e.output.length!==34||e.output[0]!==Ep.OP_1||e.output[1]!==32)throw new TypeError("Output is invalid");if(a.length>0&&!a.equals(e.output.slice(2)))throw new TypeError("Pubkey mismatch");a=e.output.slice(2)}if(e.internalPubkey){let c=(0,qe.tweakKey)(e.internalPubkey,o.hash);if(a.length>0&&!a.equals(c.x))throw new TypeError("Pubkey mismatch");a=c.x}if(a&&a.length&&a.length!==32)throw new TypeError("Invalid pubkey for p2tr");let l=i();if(e.hash&&l&&!e.hash.equals(l.hash))throw new TypeError("Hash mismatch");if(e.redeem&&e.redeem.output&&l){let c=(0,qe.tapleafHash)({output:e.redeem.output,version:o.redeemVersion});if(!(0,qe.findScriptPath)(l,c))throw new TypeError("Redeem script not in tree")}let u=n();if(e.redeem&&o.redeem){if(e.redeem.redeemVersion&&e.redeem.redeemVersion!==o.redeem.redeemVersion)throw new TypeError("Redeem.redeemVersion and witness mismatch");if(e.redeem.output){if(Wo.decompile(e.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");if(o.redeem.output&&!e.redeem.output.equals(o.redeem.output))throw new TypeError("Redeem.output and witness mismatch")}if(e.redeem.witness&&o.redeem.witness&&!im(e.redeem.witness,o.redeem.witness))throw new TypeError("Redeem.witness and witness mismatch")}if(u&&u.length)if(u.length===1){if(e.signature&&!e.signature.equals(u[0]))throw new TypeError("Signature mismatch")}else{let c=u[u.length-1];if(c.length<33)throw new TypeError(`The control-block length is too small. Got ${c.length}, expected min 33.`);if((c.length-33)%32!==0)throw new TypeError(`The control-block length of ${c.length} is incorrect!`);let p=(c.length-33)/32;if(p>128)throw new TypeError(`The script path is too long. Got ${p}, expected max 128.`);let _=c.slice(1,33);if(e.internalPubkey&&!e.internalPubkey.equals(_))throw new TypeError("Internal pubkey mismatch");if(_.length!==32)throw new TypeError("Invalid internalPubkey for p2tr witness");let g=c[0]&V.TAPLEAF_VERSION_MASK,S=u[u.length-2],y=(0,qe.tapleafHash)({output:S,version:g}),m=(0,qe.rootHashFromPath)(c,y),w=(0,qe.tweakKey)(_,m);if(!w)throw new TypeError("Invalid outputKey for p2tr witness");if(a.length&&!a.equals(w.x))throw new TypeError("Pubkey mismatch for p2tr witness");if(w.parity!==(c[0]&1))throw new Error("Incorrect parity")}}return Object.assign(o,e)}Ut.p2tr=nm;function im(e,t){return e.length!==t.length?!1:e.every((r,n)=>r.equals(t[n]))}});var rn=T(Te=>{"use strict";h();d();Object.defineProperty(Te,"__esModule",{value:!0});Te.p2tr=Te.p2wsh=Te.p2wpkh=Te.p2sh=Te.p2pkh=Te.p2pk=Te.p2ms=Te.embed=void 0;var sm=Hc();Object.defineProperty(Te,"embed",{enumerable:!0,get:function(){return sm.p2data}});var om=Uc();Object.defineProperty(Te,"p2ms",{enumerable:!0,get:function(){return om.p2ms}});var am=Fc();Object.defineProperty(Te,"p2pk",{enumerable:!0,get:function(){return am.p2pk}});var um=Gc();Object.defineProperty(Te,"p2pkh",{enumerable:!0,get:function(){return um.p2pkh}});var cm=Xc();Object.defineProperty(Te,"p2sh",{enumerable:!0,get:function(){return cm.p2sh}});var fm=Yc();Object.defineProperty(Te,"p2wpkh",{enumerable:!0,get:function(){return fm.p2wpkh}});var lm=Qc();Object.defineProperty(Te,"p2wsh",{enumerable:!0,get:function(){return lm.p2wsh}});var pm=vp();Object.defineProperty(Te,"p2tr",{enumerable:!0,get:function(){return pm.p2tr}})});var xr=T(_e=>{"use strict";h();d();var hm=_e&&_e.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),dm=_e&&_e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),cs=_e&&_e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&hm(t,e,r);return dm(t,e),t};Object.defineProperty(_e,"__esModule",{value:!0});_e.toOutputScript=_e.fromOutputScript=_e.toBech32=_e.toBase58Check=_e.fromBech32=_e.fromBase58Check=void 0;var Op=cs(Ve()),Mt=cs(rn()),Pp=cs(ye()),us=cs(Pe()),br=ke(),{typeforce:_m}=us,Ap=40,kp=2,Np=16,Cp=2,xp=80,Rp="WARNING: Sending to a future segwit version address can lead to loss of funds. End users MUST be warned carefully in the GUI and asked if they wish to proceed with caution. Wallets should verify the segwit version from the output of fromBech32, then decide when it is safe to use which version of segwit.";function gm(e,t){let r=e.slice(2);if(r.length<kp||r.length>Ap)throw new TypeError("Invalid program length for segwit address");let n=e[0]-xp;if(n<Cp||n>Np)throw new TypeError("Invalid version for segwit address");if(e[1]!==r.length)throw new TypeError("Invalid script for segwit address");return console.warn(Rp),Lp(r,n,t.bech32)}function Hp(e){let t=br.base.fromBase58Check(e);if(t.length<21)throw new TypeError(e+" is too short");if(t.length>21)throw new TypeError(e+" is too long");let r=t.readUInt8(0),n=t.slice(1);return{version:r,hash:n}}_e.fromBase58Check=Hp;function Bp(e){let t,r;try{t=br.base.bech32.decode(e)}catch{}if(t){if(r=t.words[0],r!==0)throw new TypeError(e+" uses wrong encoding")}else if(t=br.base.bech32m.decode(e),r=t.words[0],r===0)throw new TypeError(e+" uses wrong encoding");let n=br.base.bech32.fromWords(t.words.slice(1));return{version:r,prefix:t.prefix,data:f.Buffer.from(n)}}_e.fromBech32=Bp;function Sm(e,t){_m(us.tuple(us.Hash160bit,us.UInt8),arguments);let r=f.Buffer.allocUnsafe(21);return r.writeUInt8(t,0),e.copy(r,1),br.base.toBase58Check(r)}_e.toBase58Check=Sm;function Lp(e,t,r){let n=br.base.bech32.toWords(e);return n.unshift(t),t===0?br.base.bech32.encode(r,n):br.base.bech32m.encode(r,n)}_e.toBech32=Lp;function ym(e,t){t=t||Op.bitcoin;try{return Mt.p2pkh({output:e,network:t}).address}catch{}try{return Mt.p2sh({output:e,network:t}).address}catch{}try{return Mt.p2wpkh({output:e,network:t}).address}catch{}try{return Mt.p2wsh({output:e,network:t}).address}catch{}try{return Mt.p2tr({output:e,network:t}).address}catch{}try{return gm(e,t)}catch{}throw new Error(Pp.toASM(e)+" has no matching Address")}_e.fromOutputScript=ym;function mm(e,t){t=t||Op.bitcoin;let r,n;try{r=Hp(e)}catch{}if(r){if(r.version===t.pubKeyHash)return Mt.p2pkh({hash:r.hash}).output;if(r.version===t.scriptHash)return Mt.p2sh({hash:r.hash}).output}else{try{n=Bp(e)}catch{}if(n){if(n.prefix!==t.bech32)throw new Error(e+" has an invalid prefix");if(n.version===0){if(n.data.length===20)return Mt.p2wpkh({hash:n.data}).output;if(n.data.length===32)return Mt.p2wsh({hash:n.data}).output}else if(n.version===1){if(n.data.length===32)return Mt.p2tr({pubkey:n.data}).output}else if(n.version>=Cp&&n.version<=Np&&n.data.length>=kp&&n.data.length<=Ap)return console.warn(Rp),Pp.compile([n.version+xp,n.data])}}throw new Error(e+" has no matching Script")}_e.toOutputScript=mm});h();d();var ii=le(je());h();d();h();d();var Aa=le(je());function Pa(e,t){let{chainId:r,isNativeToken:n,balance:i,availableBalance:s}=t,{fromToStore:o,accountStore:a}=Ne(),{getTokenBalanceByAccount:l}=o,u=Qt(r,bt.BTC_MAINNET)&&n;(0,Aa.useEffect)(()=>{u&&a.computedSpecialWalletAddress&&l(e,t)},[u,i,s,a.computedSpecialWalletAddress])}function Gp(){let{fromToStore:e}=Ne(),{from:t,to:r}=e;Pa(gs.FROM,_n(t)),Pa(gs.TO,_n(r))}var ka=Gp;function Wp(){ka()}var Na=Wp;function Vp(){let{accountStore:e,fromToStore:t}=Ne(),{computedAccountId:r,address:n,setFromChainId:i}=e,{from:s,to:o,setBalanceState:a,getSwapTokenBalance:l,computedIsToAddressEqualsCurrentToAddress:u}=t,{amount:c,chainId:p}=s;(0,ii.useEffect)(()=>{ri(p)&&i(p)},[p,i]),(0,ii.useEffect)(()=>{l()},[r,l]),(0,ii.useEffect)(()=>{a({amount:c,address:n,from:s,to:o})},[c,n,s,o,a,u]),Na()}var Mm=Vp;h();d();var Ca=le(je());var jm=()=>{(0,Ca.useEffect)(()=>{ga()},[])};h();d();var Or=le(je()),Fa=le(Ss());h();d();var Sn=le(je()),ys=le(Ss());var Xp=({showIconBg:e=!1,iconName:t="",onClick:r,iconStyle:n,category:i=Ae.CATEGORY.fill,size:s=Ae.SIZE.lg,type:o=Ae.TYPE.gray,iconClassName:a=""})=>e?Sn.default.createElement(Ae,{strictCircle:!0,category:i,type:o,size:s,style:{padding:"0px"},iconType:Ae.ICON_POSITION.tailing,onClick:r,icon:Sn.default.createElement(ps,{className:(0,ys.default)(t,a),style:n})}):Sn.default.createElement(ra,{onClick:r},Sn.default.createElement(ps,{className:(0,ys.default)(t,a),style:n})),xa=Xp;h();d();var yn=le(je());var zp=()=>{let{fromToStore:e={},commonStore:t,accountStore:r}=Ne(),{computedIsMarket:n,computedIsWalletEnv:i}=t,{address:s}=r,{from:o={},to:a={}}=e,{tokenContractAddress:l,tokenName:u,chainName:c}=o,{tokenContractAddress:p,tokenName:_}=a,g=(0,yn.useMemo)(()=>({user_id:s,terminal_type:i?"Extension":"Web",from_token_address:l,from_token_name:u,to_token_address:n?"":p,to_token_name:n?"":_,chain_name:c}),[s,c,n,i,l,u,p,_]),S=(0,yn.useCallback)(()=>{(n?ma:ba)(g)},[g,n]),y=(0,yn.useCallback)(m=>{let w=n?Ea:wa,A={...g,content:m};w(A)},[g,n]);return{monitorShareClickEvent:S,monitorCopyClickEvent:y}},si=zp;h();d();var Ge=le(je()),Ua=le(jp()),ms=le(Ss());h();d();var Ba=le(je());h();d();var Tt=le(je());Ur();var Yp=e=>{let{fromToStore:t={},commonStore:r}=Ne(),{computedIsMarket:n}=r,[i,s]=(0,Tt.useState)(""),[o,a]=(0,Tt.useState)(!1),[l,u]=(0,Tt.useState)(null),{from:c={},to:p={}}=t,{chainId:_,tokenContractAddress:g}=c,{chainId:S,tokenContractAddress:y}=p,m=(0,Tt.useCallback)(async()=>{a(!0),u(null);let[w,A]=await Qn(ni.get(la,{params:{source:n?1:0,fromTokenAddress:g,toTokenAddress:y,chainId:_}}));if(a(!1),w){u(w);return}s(A?.data?.url)},[n,g,y,_]);return(0,Tt.useEffect)(()=>{g&&y&&_&&S&&e&&m()},[g,y,_,S,e,m]),(0,Tt.useMemo)(()=>({shareLink:i,loading:o,error:l,refresh:m}),[i,o,l,m])},Ra=Yp;h();d();var It=le(je());Ur();var $p=e=>{let[t,r]=(0,It.useState)(""),[n,i]=(0,It.useState)(!1),[s,o]=(0,It.useState)(null),a=(0,It.useCallback)(async()=>{i(!0),o(null);let{url:l}=new ea,u=`${l?.pathname}${l?.hash}${l?.search}`,[c,p]=await Qn(ni.get(pa,{params:{originalUrl:u}}));if(i(!1),c){o(c);return}r(p?.data?.universalLink||"")},[]);return(0,It.useEffect)(()=>{e&&a()},[e]),(0,It.useMemo)(()=>({shareShortLink:t,shortLoading:n,shortError:s,shortRefresh:a}),[t,n,s,a])},Ha=$p;var Zp=({isShareShortLink:e,visible:t})=>{let{shareLink:r,loading:n,error:i,refresh:s}=Ra(!!t&&!e),{shareShortLink:o,shortLoading:a,shortError:l,shortRefresh:u}=Ha(!!t&&e),{tokenInfoStore:c}=Ne();return(0,Ba.useMemo)(()=>{let _=n||i,g={href:Ia(r),target:"__blank",icon:"okx-defi-dex-twitter",iconType:Ae.ICON_POSITION.leading},S=i,y=n,m=U("swaptrade_mid_dialog_header_share_as_blink"),w=U("swaptrade_mid_dialog_btn_share_on_x"),A=s,v=()=>{},E=r;if(e){let{latestInfo:b}=c;_=a||l,g={},S=l,y=a,A=u,m=U("swaptrade_market_token_dialog_header_share_link"),w=U("commonall_enterfield_btn_copy_link"),v=()=>{Jn.success(U("swaptrade_order_info_label_from_copy_success")),Ta(o),Sa({chain_id:b?.chainId,token_name:b?.tokenName,button_name:"url_share"})},E=o}return{status:_,hrefConfig:g,infoError:S,infoLoading:y,infoRefresh:A,title:m,confirmText:w,displayLink:E,onConfirm:v}},[n,a,i,l,r,o,s,u,e,c])},La=Zp;h();d();var Jt={"share-button":"_share-button_hlj9x_1",shareButton:"_share-button_hlj9x_1",description:"_description_hlj9x_4",input:"_input_hlj9x_10","copy-button":"_copy-button_hlj9x_15",copyButton:"_copy-button_hlj9x_15",loading:"_loading_hlj9x_18",empty:"_empty_hlj9x_21","copy-container":"_copy-container_hlj9x_24",copyContainer:"_copy-container_hlj9x_24","copy-address":"_copy-address_hlj9x_32",copyAddress:"_copy-address_hlj9x_32"};var Qp=({shareLink:e="",shareBlinkEnable:t=!1,supportShortLink:r=!1})=>{let{monitorCopyClickEvent:n}=si(),s=r&&!t?"":U("swaptrade_dialog_dialog_title_share_x");return Ge.default.createElement(Ge.default.Fragment,null,Ge.default.createElement("div",{className:Jt.copyContainer},Ge.default.createElement("div",{className:Jt.copyAddress},Ge.default.createElement("span",{className:"ellipsis"},e)),!r||t?Ge.default.createElement(Ua.CopyToClipboard,{text:e,onCopy:()=>{n(e),Jn.success(U("swaptrade_order_info_label_from_copy_success"))}},Ge.default.createElement(Ae,{className:Jt.copyButton,category:Ae.CATEGORY.outline,type:Ae.TYPE.primary,size:Ae.SIZE.xxs},U("swaptrade_dialog_btn_desc_copy"))):null),s&&Ge.default.createElement("p",{className:(0,ms.default)(Jt.description)},s))},Jp=({visible:e,shareBlinkEnable:t,supportShortLink:r,...n})=>{let s=La({isShareShortLink:r&&!t,visible:e}),o=()=>s.infoError?Ge.default.createElement(ds.State,{className:Jt.empty,type:ds.State.TYPE.noNetwork,title:U("swaptrade_general_emptystate_title_loading_fail"),description:U("swaptrade_general_emptystate_subtitle_network_error"),buttonText:U("swaptrade_recent_transaction_dialog_btn_reload"),onButtonClick:s.infoRefresh}):s.infoLoading?Ge.default.createElement(hs.Circle,{className:(0,ms.default)(Jt.loading,"flex justify-center"),size:hs.SIZE.xl}):Ge.default.createElement(Qp,{shareLink:s.displayLink,shareBlinkEnable:t,supportShortLink:r});return Ge.default.createElement(dn.Confirmation,{title:s.title,hideCloseBtn:!1,onConfirm:s.onConfirm,confirmText:s.status?void 0:s.confirmText,visible:e,width:420,confirmBtnProps:s.status?void 0:{...s.hrefConfig,className:Jt.shareButton,size:ta.lg},...n},o())},Ma=Jp;h();d();var Da={icon:"_icon_m9cj5_1"};var eh=({iconStyle:e={fontSize:"24px"},iconClassName:t,tooltipProps:r,showIconBg:n=!1,shareBlinkEnable:i,supportShortLink:s})=>{let[o,a]=Or.default.useState(!1),{monitorShareClickEvent:l}=si();return Or.default.createElement(Or.default.Fragment,null,Or.default.createElement(_s,{placement:_s.DIRECTION.bottom,title:s&&!i?U("swaptrade_market_token_tooltips_share_link"):U("swaptrade_mid_dialog_header_share_as_blink"),...r},Or.default.createElement(xa,{showIconBg:n,iconName:(0,Fa.default)("okx-defi-nft-share2",Da.icon,t),iconStyle:e,onClick:()=>{l(),a(!0)}})),Or.default.createElement(Ma,{visible:o,onClose:()=>a(!1),shareBlinkEnable:i,supportShortLink:s}))},Jw=eh;h();d();var Ka=le(je());var th=()=>{let{fromToStore:e={},commonStore:t}=Ne(),{from:r={},to:n={},computedIsSolanaChain:i}=e,{currentTab:s,computedIsMarket:o}=t,a=s===fa.SWAP,l=o,{chainId:u,tokenContractAddress:c,isHoneypot:p}=r,{chainId:_,tokenContractAddress:g,isHoneypot:S}=n;return(0,Ka.useMemo)(()=>!(!u||!c||!_||!g||p||S||u!==_||!i||!(a||l)),[u,c,_,g,p,S,i,a,l])},sb=th;h();d();h();d();var Ga=le(je());h();d();var oi=le(je());h();d();var qa={"warn-state-container":"_warn-state-container_1n8v8_1",warnStateContainer:"_warn-state-container_1n8v8_1","error-state-container":"_error-state-container_1n8v8_2",errorStateContainer:"_error-state-container_1n8v8_2","error-state-title":"_error-state-title_1n8v8_15",errorStateTitle:"_error-state-title_1n8v8_15","error-state-content":"_error-state-content_1n8v8_21",errorStateContent:"_error-state-content_1n8v8_21","add-funds":"_add-funds_1n8v8_28",addFunds:"_add-funds_1n8v8_28",warning:"_warning_1n8v8_33",error:"_error_1n8v8_2","ledger-network-tips":"_ledger-network-tips_1n8v8_39",ledgerNetworkTips:"_ledger-network-tips_1n8v8_39",mb16:"_mb16_1n8v8_42","error-icon":"_error-icon_1n8v8_45",errorIcon:"_error-icon_1n8v8_45","warn-icon":"_warn-icon_1n8v8_46",warnIcon:"_warn-icon_1n8v8_46"};var rh=({chainName:e})=>{let t=()=>{let r=dn.tip({infoType:dn.Tip.INFO_TYPE.default,children:U("swaptrade_top_modaldesc_ledger_supported_paychains"),confirmText:U("swaptrade_card_btn_value_difference_gotit"),onConfirm:()=>{r.destroy()},confirmBtnProps:{block:!0,size:Ae.SIZE.md}})};return oi.default.createElement(oi.default.Fragment,null,U("swaptrade_top_alert_desc_paychain_not_supported",{payChain:e}),oi.default.createElement(hn,{className:qa.ledgerNetworkTips,type:hn.TYPE.primary,weight:hn.WEIGHT.muted,size:hn.SIZE.xs,onClick:t},U("swaptrade_top_alert_textbtn_view_supported_chains")))},ja=rh;var nh=e=>{let t=U("swaptrade_adjustslip_modal_title_wrongnetwork"),r=U("swaptrade_card_alert_switch_wallet_to_match",{chainName:e});return Zt()?(t=U("swaptrade_extension_mid_plzswitch_wallet"),r=U("swaptrade_extension_mid_plzswitch_wallettips",{chain:e})):Oa&&(t=U("swaptrade_top_alert_title_please_switch_network"),r=Ga.default.createElement(ja,{chainName:e})),{title:t,content:r}},er={default:()=>({type:"",title:"",content:"",errorType:""}),quote:()=>({type:"error",title:U("swap_title_quote_server_error"),content:U("swaptrade_quote_server_error_content"),errorType:$t.QUOTE_ERROR}),honeypot:e=>({type:"error",title:U("wallet_swap_alert_scamtoken",{tokenSymbol:e}),titleEquation:U("wallet_swap_alert_scamtoken",{tokenSymbol:Et(e)}),content:U("wallet_swap_toast_scam_token_desc"),errorType:$t.QUOTE_ERROR}),leverageToken:(e,t)=>{let r=e&&t?U("swaptrade_mid_alert_highrisk_both_token",{sellToken:e.tokenSymbol,receiveToken:t.tokenSymbol}):U("swaptrade_mid_alert_highrisk_token",{token:e?.tokenSymbol||t?.tokenSymbol}),n=e&&t?U("swaptrade_mid_alert_highrisk_both_token",{sellToken:Et(e.tokenSymbol),receiveToken:Et(t.tokenSymbol)}):U("swaptrade_mid_alert_highrisk_token",{token:Et(e?.tokenSymbol)||Et(t?.tokenSymbol)});return{type:"error",title:r,titleEquation:n,content:U("swaptrade_top_text_protect_capital"),errorType:$t.QUOTE_ERROR}},wrongNetwork:e=>{let{title:t,content:r}=nh(e);return{type:"warning",title:t,content:r,errorType:$t.NETWORK_ERROR}},feeConfig:()=>({type:"error",title:U("swaptrade_card_reminder_title_parameter_error"),content:U("swaptrade_card_reminder_desc_feepercent",{feePercent:"feePercent",value1:"0",value2:vr(ua,{needZero:!1})}),errorType:$t.FEE_CONFIG_ERROR}),accountErrorTips:()=>({type:"warning",title:U("swaptrade_adjustslip_modal_title_wrongnetwork"),content:U("swaptrade_mid_alert_desc_vm_wallet"),errorType:$t.FEE_CONFIG_ERROR})},xb={handleBalanceErrorState:({state:e})=>e.errorType===$t.BALANCE_ERROR?er.default():"",handleQuoteErrorState:({quote:e,honeypotToken:t,hasLeverageToken:r,leverageTokenPair:n=[]})=>{let{quoteError:i}=e;return i?er.quote():t?er.honeypot(t.tokenSymbol):r?er.leverageToken(n[0],n[1]):""},handleNetworkErrorState:e=>(ya({type:aa.SWITCH_WALLET}),er.wrongNetwork(e)),handleDefaultState:()=>er.default(),handleFeeConfigErrorState:()=>er.feeConfig(),handleFacetTokenAccountErrorState:()=>er.accountErrorTips()};h();d();var dt={MARKET:"marketFee",FAST:"fastFee",TURBO:"turboFee",CUSTOM:"custom"},Lb={[dt.MARKET]:{text:"swaptrade_modal_dialog_option_market",icon:"okx-defi-nft-gas-slow",iconColor:"var(--okd-color-semantic-notice)"},[dt.FAST]:{text:"swaptrade_modal_dialog_option_fast5x",icon:"okx-defi-nft-gas-standard",iconColor:"var(--okd-color-semantic-informative)"},[dt.TURBO]:{text:"swaptrade_modal_dialog_option_turbo10x",icon:"okx-defi-nft-gas-fast",iconColor:"var(--okd-color-semantic-positive)"},[dt.CUSTOM]:{text:"swaptrade_market_sort_label_custom",icon:"okx-defi-nft-gas-custom",iconColor:"var(--okd-color-content-contrast)"}},Ub=[dt.MARKET,dt.FAST,dt.TURBO],Mb={[dt.MARKET]:"fee_Market",[dt.FAST]:"fee_Fast",[dt.TURBO]:"fee_Turbo",[dt.CUSTOM]:"fee_custom"};h();d();Yt();Ur();h();d();Ur();function ws(){return Zt()?{walletType:"okwallet-extension"}:Jo.getProjectStorage("onChain")}var Wa={HEART:"heart",HEART_FINISH:"heartFinish",UPDATE_HASH:"updateHash",UPDATE_HASH_ERROR:"updateHashError",SAVE_ORDER:"saveOrder",SAVE_ORDER_PARAMS:"saveOrderParams",SAVE_ORDER_ERROR:"saveOrderError",SEND_ERROR:"sendError",ON_WALLET_FAIL:"onWalletFail",PAYLOAD:"payload",UPDATE_NONCE:"updateNonce",UPDATE_NONCE_FAIL:"updateNonceFail",CLOSE_CONFIRM_SWAP:"closeConfirmSwap",BEFOREUNLOAD:"beforeunload",CANCEL_ORDER:"cancelOrder",REDEEM_ORDER:"redeemOrder",ERROR_BOUNDARY:"errorBoundary",STUFF_LOG:"stuffLog",GET_LIMIT_CALL_DATA_ERROR:"getLimitCallDataError",SAVE_APPROVE:"saveApprove",SAVE_APPROVE_ERROR:"saveApproveError",APPROVE_DATA:"approveData",APPROVE_TOKEN_ERROR:"approveTokenError",CHAIN_ID_ADDRESS_MAP_IS_EMPTY:"chainIdAddressMapIsEmpty",UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP:"updateBtcBalanceErrorBeforeSwap",CHAIN_INFO:"chainInfo",ON_CHAIN_CHANGE:"onChainChange",LINK_SWITCH_START:"linkSwitchStart",LINK_SWITCH_SUCCESS:"linkSwitchSuccess",LINK_SWITCH_FAILED:"linkSwitchFailed",LINK_SWITCH_END:"linkSwitchEnd",DOUBLE_CHECK_CHAIN_ID_SUCCESS:"doubleCheckChainIdSuccess",DOUBLE_CHECK_CHAIN_ID_FAILED:"doubleCheckChainIdFailed",GET_CHAIN_ID_FAILED:"getChainIdFailed",UPDATE_APPROVAL_GAS_INFO_ERROR:"updateApprovalGasInfoError",WALLET_INFO:"walletInfo",OVER_VIEW_PRE_DATA_ERROR:"overViewInfoPreDataError",TRANSACTION_HISTORY_PRE_DATA_ERROR:"transactionHistoryPreDataError",REDEEM_ORDER_CALL_DATA:"redeemOrderCallData",REDEEM_ORDER_CALL_DATA_ERROR:"redeemOrderCallDataError",REDEEM_ORDER_ERROR:"redeemOrderError",INTENT_QUOTE_CALLDATA_ERROR:"intentQuoteCallDataError",INTENT_SWAP_SIGN_ERROR:"intentSwapSignError",INTENT_ORDER_CREATE_ERROR:"intentOrderCreateError",INTENT_SWAP_CALLDATA_ERROR:"intentSwapCalldataError",INTENT_SWAP_PROCESS_ERROR:"intentSwapProcessError",REGISTER_CO_LISTING_ERROR:"registerCoListingError",BEFORE_SEND_TRANSACTION_ERROR:"beforeSendTransactionError",TRANSACTION_HISTORY_LIST_ERROR:"transaction_history_list_error",TRANSACTION_HISTORY_INFO_ERROR:"transaction_history_info_error",EXTENSION_SWITCH_BTC_ADDRESS_ERROR:"extensionSwitchBtcAddressError",CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION:"checkChainIdBeforeSendTransaction",CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION:"checkChainIdAfterSendTransaction",WIDGET_UPDATE_PROVIDER_ERROR:"widgetUpdateProviderError",WIDGET_DISCONNECT_WALLET_ERROR:"widgetDisconnectWalletError",OK_GLOBAL_LOCALE_MAP_IS_EMPTY:"okGlobalLocaleMapIsEmpty",SET_LANGUAGE_ERROR:"setLanguageError",SIGN_PERMIT2_DATA:"signPermit2Data",LIMIT_ORDER_TOKEN_PAIR_ERROR:"limitOrderTokenPairError",LIMIT_TOKEN_CONFIG_EMPTY:"limitChainListTokenConfigIsEmpty",LIMIT_TOKEN_CONFIG_DIFF_CHAIN:"limitChainListTokenConfigIsDiffChain",SWAP_SLIPPAGER_MEV_SETTING:"swapSlippagerMevSetting",BA_FANG_SDK_INIT_ERROR:"baFangSdkInitError",BA_FANG_SDK_INIT_SUCCESS:"baFangSdkInitSuccess",BA_FANG_SDK_INIT_FAILED:"baFangSdkInitFailed",MEME_SWAP_VALUE_DIFF_ERROR:"memeSwapValueDiffError",MEME_SWAP_GET_CALLDATA_PARAMS:"memeSwapGetCalldataParams",MEME_SWAP_GET_CALLDATA_ERROR:"memeSwapGetCalldataError",MEME_SWAP_PRE_EXECUTE_ERR:"memeSwapPreExecuteErr",MEME_SWAP_PRE_EXECUTE_RESULT_ERR:"memeSwapPreExecuteResultErr",MEME_SWAP_PRE_EXECUTE_RESULT:"memeSwapPreExecuteResult",MEME_SWAP_SIGN_SUCCESS:"memeSwapSgSuccess",MEME_SWAP_SIGN_ERROR:"memeSwapSgERROR",MEME_SWAP_BROADCAST_PARAMS:"memeSwapBroadcastParams",MEME_SWAP_BROADCAST_ERROR:"memeSwapBroadcastError",MEME_SWAP_BROADCAST_SUCCESS:"memeSwapBroadcastSuccess",GET_BALANCE:"getBalance",CLICK_WALLET_SWAP_BUTTON:"clickWalletSwapButton",BALANCE_IS_ERROR:"balanceIsError"};var ih={business:"dex"},bs=class{constructor(t){I(this,"setTags",t=>{this.tags={...this.tags,...t}});I(this,"extendTags",()=>{let{walletType:t,scanAppType:r}=ws();return $o({walletType:t,scanAppType:r,taskId:this.uid,...this.tags},Yo)});I(this,"wrapHandle",(t,r,n={})=>{t(r,{...n,tags:{...this.extendTags(),...n?.tags}})});I(this,"debug",(...t)=>{this.wrapHandle(Ir.debug,...t)});I(this,"info",(...t)=>{this.wrapHandle(Ir.info,...t)});I(this,"error",(...t)=>{this.wrapHandle(Ir.error,...t)});I(this,"warn",(...t)=>{this.wrapHandle(Ir.warn,...t)});I(this,"stuff",(...t)=>{t.length===1&&typeof t[0]=="string"?this.wrapHandle(Ir.info,Wa.STUFF_LOG,{msg:t[0]}):this.wrapHandle(Ir.info,Wa.STUFF_LOG,...t)});I(this,"generateUUID",()=>{this.uid=va()});I(this,"timerRef",null);I(this,"heartNumber",0);I(this,"uid","");I(this,"keepLive",()=>{this.generateUUID(),this.heartNumber=0,this.timerRef&&clearInterval(this.timerRef),this.heartCheck(),this.timerRef=setInterval(()=>{this.heartCheck()},30*1e3)});I(this,"heartCheck",()=>{this.info("heart",{tags:{heartNumber:this.heartNumber}}),this.heartNumber++});I(this,"removeKeep",()=>{this.timerRef&&clearInterval(this.timerRef),this.info("heart finish",{tags:{heartNumber:this.heartNumber}}),this.heartNumber=0,this.uid=""});this.tags=t}};var Va=new bs(ih);h();d();Yt();h();d();var Es="1",sh="2",oh="3",tE="0",rE={[Es]:"swaptrade_aggregator_tag_best_value",[sh]:"swaptrade_xrouting_tag_fastest",[oh]:"swaptrade_xrouting_tag_best_in_all_dimensions"};h();d();var Xa={AUTO:1,CUSTOM:2,DEFAULT:3};var ah=()=>{let{accountStore:e,quoteStore:t}=gn(),r=W(t,"quote.bestRoute",{}),n=r.defiPlatformInfoList?.findIndex(i=>i.defiPlatformId===t.aggregateSelectId)+1;return{wallet_address:e.address,provider_name:r.name,best_price:r.isBest?"yes":"no",price_difference:_a(r.reducePercent),price_ranking:n}},dE=()=>{let{accountStore:e,liquidityChooseStore:t,quoteStore:r}=gn(),{bestRoute:n}=r.quote;if(!n)return{};let{slippage:i,slippageType:s}=r.computedSlippage,{fromToken:o,fromTokenAmount:a,fromTokenPrice:l,toTokenPrice:u,receiveAmount:c,toToken:p,swapType:_,routerLabel:g}=n,S=Number(_)===0,y=S?{liquidity_source:t.computedMonitorLiquidSelectType}:{},m=S?{}:{bridge_selection:g?.includes(Es)?"overall best":"custom"};return{wallet_address:e.address,from_token_name:o?.tokenName,from_token_address:o?.tokenContractAddress,from_token_amount:a,from_amount_usdt:l,to_token_address:p?.tokenContractAddress,to_token_amount:c,to_amount_usdt:u,chain:o?.chainName,from_chain:o?.chainName,to_chain:p?.chainName,swap_type:S?"swap":"cross_chain_swap",slippage:{type:s===Xa.AUTO?"auto":"custom",amount:i},...y,...m,...ah()}};h();d();Yt();h();d();var ai=(e,t)=>({networkFeeAmount:e,networkFeeTokenSymbol:t,formattedNetworkFeeAmount:e?`${da(e)} ${t}`:"--"}),ui=e=>{let{commonStore:t}=gn(),{computedNowCurrencySymbol:r,currencyConversion:n}=t;return{networkFeeUsd:e,formattedNetworkFeeUsd:e?ha(n(e).toString(),r):"--"}},Ts=e=>{let{estimateGasFeeAmount:t,fromNativeTokenSymbol:r,estimateGasFeeAmountUsd:n,bridge:i,fromToken:s,toToken:o,crossChainFee:a,bridgeFeeUsd:l,toSwapFee:u,toNativeTokenSymbol:c,toSwapFeeUsd:p}=e||{},{estimateBridgeFeeAmountUsd:_,estimateBridgeFeeAmount:g,bridgeName:S,bridgeLogoUrl:y}=i||{},m=ai(a,i?.crossToToken?.tokenSymbol),w=ui(l);return{from:{chainName:s?.chainName,chainLogo:s?.chainLogoUrl,...ai(t,r),...ui(n)},bridge:{bridgeName:S,bridgeLogo:y,...ai(g,r),...ui(_),bridgeFeeAmount:m.networkFeeAmount,bridgeFeeTokenSymbol:m.networkFeeTokenSymbol,formattedBridgeFeeAmount:m.formattedNetworkFeeAmount,bridgeFeeUsd:w.networkFeeUsd,formattedBridgeFeeUsd:w.formattedNetworkFeeUsd},to:{chainName:o?.chainName,chainLogo:o?.chainLogoUrl,...ai(u,c),...ui(p)}}},uh=()=>{let{quoteStore:e}=Ne(),{quote:t}=e;return Ts(t?.bestRoute)},wE=uh;h();d();Yt();h();d();Yt();h();d();Yt();h();d();var mn=class{constructor(t,r){I(this,"percent","");I(this,"exactPercent","");I(this,"dexRouterPercent","");Object.assign(this,r),this.dexRouterPercent=t}get computedPercent(){return this.percent?vr(this.percent,{needZero:!1}):""}get computedExactPercent(){let t=ti.BigNumber(this.percent).multipliedBy(this.dexRouterPercent).dividedBy(100);return t.isNaN()?"":vr(t.toNumber(),{needZero:!1})}};var wn=class{constructor(t,r,n){I(this,"fromToken",{});I(this,"toToken",{});I(this,"dexQuoteInfoList",[]);let{fromToken:i={},toToken:s={},dexQuoteInfoList:o}=r||{};this.fromToken=i,this.toToken=s,this.dialogHeaderText=n?Et(this.toToken?.tokenSymbol):`${Et(this.fromToken?.tokenSymbol)}/${Et(this.toToken?.tokenSymbol)}`,Lr(o)&&(this.dexQuoteInfoList=o.map(a=>new mn(t,a)))}};var bn=class{constructor(t,r){I(this,"percent","");I(this,"router","");I(this,"subRouterList",[]);I(this,"flag","");let{percent:n="",router:i="",flag:s="",subRouterList:o}=t||{};this.percent=n,this.router=i,this.flag=s,Lr(o)&&(this.subRouterList=o.map(a=>new wn(n,a,r)))}get computedPercent(){return this.percent?vr(this.percent,{needZero:!1}):""}};var tr=class{constructor(t,r=!1){I(this,"data",[]);Lr(t)&&(this.data=t.map(n=>new bn(n,r)))}};var Ye={DEFAULT:0,LOADING:1,DISCONNECTION:2,NO_DATA:3,SHOW_DATA:4},Dt={DISMISS:"0",FROM:"1",BRIDGE:"2",TO:"3"},Is={IN_CHAIN:"0",CROSS_CHAIN:"1"},fi={NORMAL_PERCENT:0,EXACT_PERCENT:1},vs=class{constructor({swapStore:t,fromToStore:r,swapDappStore:n}){I(this,"showEntryForPc",!1);I(this,"isShowShowAll",!0);I(this,"updateIsShowShowAll",(t=!1)=>{this.isShowShowAll=t});I(this,"status",Ye.LOADING);I(this,"percentType",fi.NORMAL_PERCENT);I(this,"swapType",Is.IN_CHAIN);I(this,"tokenInfo",{dexRouter:{token0:{},token1:{}},fromDexRouter:{token0:{},token1:{}},bridge:{token0:{},token1:{}},toDexRouter:{token0:{},token1:{}}});I(this,"dexRouterList",[]);I(this,"fromDexRouterList",[]);I(this,"toDexRouterToList",[]);I(this,"bridgeRouterList",[]);I(this,"getInfoByMenuType",t=>{if(this.swapType===Is.IN_CHAIN)return{routerList:this.dexRouterList,tokenInfo:this.tokenInfo.dexRouter};switch(t){case Dt.FROM:return{routerList:this.fromDexRouterList,tokenInfo:this.tokenInfo.fromDexRouter};case Dt.BRIDGE:return{routerList:this.bridgeRouterList,tokenInfo:this.tokenInfo.bridge};case Dt.TO:return{routerList:this.toDexRouterToList,tokenInfo:this.tokenInfo.toDexRouter};default:return{routerList:[],tokenInfo:this.tokenInfo.dexRouter}}});I(this,"currentMenu",Dt.DISMISS);I(this,"menuList",[]);I(this,"showMenuList",!0);I(this,"isCrossBridgeOnly",!1);I(this,"showXRouteModal",ca.SWAP);I(this,"subRouterData",null);I(this,"subRouterModal",!1);I(this,"setSubRouterModal",t=>{this.subRouterModal=t});I(this,"dexQuoteInfoListData",[]);I(this,"setDexQuoteInfoListData",t=>{this.dexQuoteInfoListData=t});I(this,"oldRouterModal",!1);I(this,"allGasFee",{});this.fromToStore=r||{},this.quoteStore=t.quoteStore||{},this.swapDappStore=n||{},sa(this,{},{autoBind:!0}),ia(()=>({isFetchQuoting:this.quoteStore.quote?.isFetchQuoting,bestRoute:this.quoteStore.computedRouterForSmartRouterStore,quoteError:this.quoteStore.quote?.quoteError,quoteNull:this.quoteStore.quote?.quoteNull,fromToken:this.fromToStore.from,toToken:this.fromToStore.to,shouldPauseQuote:this.swapDappStore.computedSupportDappTradeByChain}),({isFetchQuoting:i,bestRoute:s,quoteError:o,quoteNull:a,shouldPauseQuote:l})=>{let u=s?_n(s):{},c=u.commonDexInfo||{},p=l?{}:{...c,...u};this.setStatusByQuote({isFetchQuoting:i,quoteError:o,bestRoute:p,quoteNull:a,shouldPauseQuote:l}),this.updateData(p||{}),this.updateAllGasFee(p||{})},{equals:na.shallow})}setShowEntryForPc(t){this.showEntryForPc=t}setStatus(t){let n=ls(Ye).some(i=>i===t);this.status=n?t:Ye.DEFAULT}setStatusByQuote({isFetchQuoting:t,quoteError:r,bestRoute:n,quoteNull:i,shouldPauseQuote:s}){if(s){this.setStatus(Ye.NO_DATA);return}if(!r&&!n&&!i&&ti.BigNumber(this.fromToStore?.computedTypedValue).gt(0)){this.setStatus(Ye.LOADING);return}if(t&&this.status!==Ye.SHOW_DATA&&this.status!==Ye.NO_DATA){this.setStatus(Ye.LOADING);return}if(r){this.setStatus(Ye.DISCONNECTION);return}if(i&&wt(n?.dexRouterList)&&wt(n?.fromDexRouterList)&&wt(n?.bridge)&&wt(n?.toDexRouterToList)){this.setStatus(Ye.NO_DATA);return}if(!wt(n?.dexRouterList)||!wt(n?.fromDexRouterList)||!wt(n?.bridge)||!wt(n?.toDexRouterToList)){this.setStatus(Ye.SHOW_DATA);return}this.setStatus(Ye.DEFAULT)}switchPercentType(){this.percentType=this.percentType===fi.NORMAL_PERCENT?fi.EXACT_PERCENT:fi.NORMAL_PERCENT}setSwapType(t){this.swapType=t}updateTokenInfo(t){pn(this.tokenInfo,"dexRouter",{token0:this.fromToStore.from||{},token1:this.fromToStore.to||{}}),pn(this.tokenInfo,"fromDexRouter",{token0:{...W(t,"fromToken",{}),amountIn:W(t,"fromTokenAmount","")},token1:{...W(t,"fromSwapToTokenInfo",{}),amountOut:W(t,"bridge.bridgeAmountIn","")}}),pn(this.tokenInfo,"bridge",{token0:this.isCrossBridgeOnly?{...W(t,"fromToken",{}),amountIn:W(t,"bridge.bridgeAmountIn","")}:{...W(t,"bridge.crossFromToken",{}),amountIn:W(t,"bridge.bridgeAmountIn","")},token1:this.isCrossBridgeOnly?{...W(t,"toToken",{}),amountOut:W(t,"bridge.bridgeAmountOut","")}:{...W(t,"bridge.crossToToken",{}),amountOut:W(t,"bridge.bridgeAmountOut","")}}),pn(this.tokenInfo,"toDexRouter",{token0:{...W(t,"toSwapFromTokenInfo",{}),amountIn:W(t,"bridge.bridgeAmountOut","")},token1:{...W(t,"toToken",{}),amountOut:W(t,"receiveAmount","")}})}setDexRouterList(t){this.dexRouterList=new tr(t).data}setFromDexRouterList(t){this.fromDexRouterList=new tr(t).data}setToDexRouterToList(t){this.toDexRouterToList=new tr(t).data}setBridgeRouterList(t,r){let n=(i={},s)=>({...i,tokenSymbol:s,fromBridge:!0});this.bridgeRouterList=new tr([{percent:W(r,"percent")||"100",subRouterList:[{dexQuoteInfoList:[{dexName:W(r,"bridgeName"),percent:"100",okLinkUrl:W(r,"fromPoolAddress")}],fromToken:{},toToken:n(W(r,"crossFromToken"),W(r,"fromPoolName"))},{dexQuoteInfoList:[{dexName:W(r,"bridgeName"),percent:"100",okLinkUrl:W(r,"toPoolAddress")}],fromToken:{},toToken:n(W(r,"crossToToken"),W(r,"toPoolName"))}]}],!0).data}checkIsManyQuote(t){if(t.length>1)return!1;let r=t.length>0?W(t,[0,"subRouterList"],[]):[];return r.length>1?!1:W(r,[0,"dexQuoteInfoList","length"])>5}checkIsFewRouter(t){return t.length===1&&W(t,[0,"subRouterList","length"])<3}get computedIsFewRouter(){let{routerList:t}=this.computedCurrentRouter;return this.checkIsFewRouter(t)}get computedIsManyQuoteInfo(){let{routerList:t}=this.computedCurrentRouter;return this.checkIsManyQuote(t)}get computedCurrentRouter(){return this.getInfoByMenuType(this.currentMenu)}setCurrentMenu(t){let n=ls(Dt).some(i=>i===t);this.currentMenu=n?t:Dt.DISMISS}setMenuListAndCurrentMenu(t,r,n){if(!Array.isArray(t)||wt(t))this.showMenuList=!1,this.isCrossBridgeOnly=!1,this.setCurrentMenu(Dt.DISMISS);else{this.menuList=t.map(s=>({...s,bridge:{...n}}));let i=W(t,[0,"smartRoutingMenuType"]);(!this.showMenuList||this.currentMenu===Dt.DISMISS||!t.some(s=>W(s,"smartRoutingMenuType")===this.currentMenu))&&this.setCurrentMenu(i),this.isCrossBridgeOnly=t.length===1&&i===Dt.BRIDGE&&r===Is.CROSS_CHAIN,this.showMenuList=!this.isCrossBridgeOnly}}updateData(t){let{swapType:r,smartRoutingMenuVoList:n,dexRouterList:i,fromDexRouterList:s,bridge:o,toDexRouterToList:a}=t;this.setSwapType(r),this.setMenuListAndCurrentMenu(n,r,o),this.setDexRouterList(i),this.setFromDexRouterList(s),this.setBridgeRouterList(t,o),this.setToDexRouterToList(a),this.updateTokenInfo(t)}setXRouteModal(t){this.showXRouteModal=t}setSubRouterData(t){this.subRouterData=t}setOldRouterModal(t){this.oldRouterModal=t}updateAllGasFee(t){this.allGasFee=Ts(t)}};h();d();Ur();h();d();var ic=le(tc());h();d();h();d();h();d();h();d();var yi=()=>Boolean(typeof window>"u"||process.env.SSR_ENV);h();d();var Us={PING:"ping",PONG:"pong"},Kr={CONNECTED:0,DISCONNECTED:1,PING_PENDING:2,PING_PENDING_OVER:3},rr=!yi(),mi=rr&&!window.inOKXExtension;var Wh=/^\{|\[/,rc="";rr&&(rc=window?.okGlobal?.socketBaseUrls?.trade);var wi={isPushingJSON(e){return Wh.test(e)},getRealConnectUrl(e=rc){return e}};h();d();var nc={decode(e){let t=0,r,n,i,s,o,a=[],l=e.length;for(;t<l;)r=e[t++],r<128?o=r:r<224?(n=e[t++],o=(r&31)<<6|n&63):r<240?(n=e[t++],i=e[t++],o=(r&15)<<12|(n&63)<<6|i&63):(n=e[t++],i=e[t++],s=e[t++],o=(r&7)<<18|(n&63)<<12|(i&63)<<6|s&63),a.push(String.fromCodePoint(o));return a.join("")}};var sc=nc;if(rr&&mi){let{location:e,TextDecoder:t}=window;t&&(sc=new t("utf-8")),window.$has_debug_push_param$=e.href.indexOf("debug_push=true")>-1}var Ms={};function Ds(e={}){let t=this,r=wi.getRealConnectUrl(e.connectUrl),n={maxPendingTime:5e3,maxReconnectTime:1e4,maxWaitingResponseTime:1e4,maxSleepRecoveringTime:3e3,...e,connectUrl:r},i=Ms[n.connectUrl];if(i)return i;let s={isConnected:!1,isConnectPending:!1,isClosingByClient:!1,isKillingUnWakeUp:!1,isPingPending:!1},o,a={reconnectTimer:0,handlePendingTimer:0,discontinueTimer:0,killingUnWakeUpTimer:0,pingPendingTimer:0},l={currReconnectTime:0,lastReceivingTime:0},u=[],c=[],p=[],_=[],g=[],S=()=>{},y=()=>{this.isConnected()&&(S(),a.pingPendingTimer=setTimeout(()=>{s.isPingPending=!0,_.forEach(P=>{P(Kr.PING_PENDING)})},n.maxPendingTime))},m=(P,fe)=>{for(let ze=0;ze<P.length;ze++)if(P[ze]===fe){P.splice(ze,1);break}},w=()=>{s.isPingPending=!1,clearTimeout(a.pingPendingTimer)},A=()=>{clearInterval(a.handlePendingTimer)},v=()=>{l.currReconnectTime=0,a.reconnectTimer&&(clearTimeout(a.reconnectTimer),delete a.reconnectTimer)},E=()=>{!this.isConnected()&&!s.isConnectPending&&(v(),b())},b=function(){o=new WebSocket(n.connectUrl),s.isConnectPending=!0,o.onopen=B,o.onmessage=x,o.onclose=ie,o.onerror=R,a.handlePendingTimer=setInterval(t.handleConnectPending,n.maxPendingTime)},B=function(){s.isConnected=!0,s.isConnectPending=!1,s.isClosingByClient=!1,v(),A(),c.forEach(P=>{P(),P.triggered=!0}),_.forEach(P=>{P(Kr.CONNECTED)})},F=function(){s.isPingPending&&_.forEach(P=>{P(Kr.PING_PENDING_OVER)}),w()},x=function(P){if(l.lastReceivingTime=Date.now(),clearTimeout(a.discontinueTimer),clearTimeout(a.killingUnWakeUpTimer),a.discontinueTimer=setTimeout(y,n.maxPendingTime),P.data instanceof Blob){let fe=P.data,ze=new FileReader,Er={done:!1,resultString:""};g.push(Er),ze.onload=function(Tr){if(Tr.target.readyState==FileReader.DONE){let Br=(0,ic.inflateRaw)(Tr.target.result);for(Er.done=!0,Er.resultString=sc.decode(Br);g[0]&&g[0].done;){let{resultString:ln}=g.shift();ln===Us.PONG&&F();let zo=wi.isPushingJSON(ln)?JSON.parse(ln):ln;He(zo),window.$has_debug_push_param$&&(console.log(ln),window.$ok_debug_push_callback$&&window.$ok_debug_push_callback$(zo))}}},ze.readAsArrayBuffer(fe)}else{let fe=P.data;fe===Us.PONG&&F(),He(wi.isPushingJSON(fe)?JSON.parse(fe):fe),window.$has_debug_push_param$&&console.log(fe)}},j=function(){s.isConnected=!1,s.isConnectPending=!1,w(),c.forEach(P=>{P.triggered=!1})},ie=function(){if(s.isKillingUnWakeUp){s.isKillingUnWakeUp=!1;return}s.isClosingByClient?j():a.reconnectTimer||R()},R=function(){j(),A(),u.forEach(fe=>{fe()}),_.forEach(fe=>{fe(Kr.DISCONNECTED)}),a.reconnectTimer=setTimeout(b,l.currReconnectTime);let P=l.currReconnectTime+1e3;P>n.maxReconnectTime&&(P=n.maxReconnectTime),l.currReconnectTime=P},He=function(P){if(P.event==="error"&&Number(P.errorCode)===30026){o.close();return}p.forEach(ze=>ze(P))};if(this.setPushDataResolver=function(P){return p.push(P),()=>{m(p,P)}},this.connect=function(){if(rr){if(this.isConnected()){c.forEach(P=>{P.triggered||(P(),P.triggered=!0)});return}!this.isConnected()&&!s.isConnectPending&&b()}},this.disconnect=function(){clearTimeout(a.reconnectTimer),clearTimeout(a.discontinueTimer),delete a.reconnectTimer,delete a.discontinueTimer,s.isClosingByClient=!0,o.close(),u.length=0,c.length=0,p.length=0,S=()=>{},delete Ms[n.connectUrl];let{connection:P}=navigator;P&&P.removeEventListener&&P.removeEventListener("change",this.handleConnectionChange),mi&&document.removeEventListener("visibilitychange",this.handleVisibilityChange)},this.isConnected=function(){return s.isConnected},this.sendChannel=function(P){o.readyState===WebSocket.OPEN?o.send(P):console.error("WebSocket is not in open state, can not send!")},this.onSocketConnected=function(P){return c.push(P),()=>{m(c,P)}},this.onSocketError=function(P){return u.push(P),()=>{m(u,P)}},this.onPushDiscontinue=function(P){return S=P,()=>{}},this.onStatusChange=function(P){return _.push(P),()=>{m(_,P)}},this.handleConnectPending=function(){s.isConnectPending&&u.forEach(P=>{P()})},this.handleConnectionChange=()=>{navigator.onLine===!0&&E()},this.handleVisibilityChange=()=>{if(!document.hidden){if(!this.isConnected()){E();return}Date.now()-l.lastReceivingTime>n.maxWaitingResponseTime&&(y(),a.killingUnWakeUpTimer=setTimeout(()=>{j(),v(),s.isKillingUnWakeUp=!0,o.close(),b()},n.maxSleepRecoveringTime))}},rr){let{connection:P}=navigator;P&&P.addEventListener&&P.addEventListener("change",this.handleConnectionChange),mi&&document.addEventListener("visibilitychange",this.handleVisibilityChange)}return Ms[n.connectUrl]=this,this}Ds.STATUS=Kr;rr&&!window.WebSocketCore&&(window.WebSocketCore=Ds);var bi=Ds;var oc={DEX_PUSH_ENGINE:"dex-across-order-info",WALLET_ASSET:"wallet-asset"},Vh=e=>e.reduce((t,r)=>{let{channel:n}=r;return t.has(n)||t.set(n,new Set),t},new Map),ac=e=>e?e.split(",").map(r=>({token:r})):[],Fs=class{constructor(){I(this,"initEventList",()=>{this.errorHandlerList=new Set,this.connectedHandlerList=new Set,this.channelList=Object.keys(oc).map(t=>({channel:oc[t]})),this.eventList=Vh(this.channelList)});I(this,"connectUrl",()=>{let t="";return Zt()?process.env.ASSETS_BUILD_TYPE==="dev"||process.env.ASSETS_BUILD_TYPE==="daily"?"wss://wsdexpre.coinall.ltd:8443/ws/v5/iprivate":ei.global.urlConfig.serverPushUrl:(t=Zn.socketBaseUrls?.dex||"",`${t}/ws/v5/iprivate`)});I(this,"init",t=>{if(!$n()){if(this.isLoginDone=!1,!t){this.tokens="";return}if(this.tokens=t,this.isConnected()){this.connectedCallback();return}this.wsInstance||(this.wsInstance=new bi({connectUrl:this.connectUrl(),reconnectTime:1e4,maxPendingTime:2e4}),this.setCallbacks(),this.wsInstance.connect())}});I(this,"getInstance",()=>this.wsInstance);I(this,"setCallbacks",()=>{this.wsInstance.onSocketConnected(this.connectedCallback),this.wsInstance.onSocketError(this.errorCallback),this.wsInstance.onPushDiscontinue(()=>{this.wsInstance.sendChannel("ping")}),this.wsInstance.setPushDataResolver(t=>this.dataCallback(t))});I(this,"connectedCallback",()=>{this.login(this.tokens).then(()=>(this.subscribe(),this.isLoginDone=!0,!0)).catch(()=>{Va.stuff("ws login fail")}),this.connectedHandlerList.forEach(t=>{t()})});I(this,"errorCallback",t=>{this.errorHandlerList.forEach(r=>{r(t)})});I(this,"dataCallback",t=>{this.isLoginDone?this.dataHandler(t):this.loginHandler(t)});I(this,"login",t=>new Promise((r,n)=>{this.isLoginDone=!1,this.wsInstance.sendChannel(JSON.stringify({op:"login",args:ac(t)})),this.loginResolveFn=r,this.loginRejectFn=n}));I(this,"loginHandler",t=>{let{event:r,code:n}=t;if(r==="login"){if(Number(n)===0){this.loginResolveFn();return}this.loginRejectFn()}});I(this,"dataHandler",t=>{let{arg:r,data:n}=t,i=r?.channel,s=this.eventList.get(i);s?.size>0&&s.forEach(o=>{o(n)})});I(this,"logout",t=>{this.isConnected()&&this.wsInstance.sendChannel(JSON.stringify({op:"logout",args:ac(t)}))});I(this,"subscribe",()=>{this.wsInstance.sendChannel(JSON.stringify({op:"subscribe",args:this.channelList}))});I(this,"unsubscribe",()=>{this.isConnected()&&this.wsInstance.sendChannel(JSON.stringify({op:"unsubscribe",args:this.channelList}))});I(this,"addListen",(t,r)=>{if(t==="error"){this.errorHandlerList.add(r);return}if(t==="connect"){this.connectedHandlerList.add(r);return}this.eventList.has(t)&&this.eventList.get(t).add(r)});I(this,"removeListen",(t,r=()=>{})=>{if(t==="error"){this.errorHandlerList.delete(r);return}this.eventList.has(t)&&this.eventList.get(t).delete(r)});I(this,"removeAll",()=>{this.initEventList()});I(this,"isConnected",()=>!!this.wsInstance?.isConnected());I(this,"disconnect",()=>{this.wsInstance?.disconnect(),this.initEventList()});this.wsInstance=null,this.initEventList()}},kI=new Fs;h();d();Yt();var uc=e=>!!(Number(e?.isNativeToken)===oa.TRUE||e?.isNativeToken===!0||e?.isBaseCoin),MI=e=>e?ri(e.chainId)&&e.tokenContractAddress:!1,DI=({chainId:e,tokenContractAddress:t,tokenAddress:r=void 0}={})=>`${e}_${(t||r)?.toLowerCase()}`;function cc(e,t=!1){let r=e?.tokenContractAddress||e?.tokenAddress||"";return t?r:Zo(r)}function Xh(e,t){return Number(e?.chainId)===Number(t?.chainId)}function FI(e,t,r=!1){if(!Xh(e,t))return!1;let i=cc(e,r),s=cc(t,r);return i&&s?i===s:uc(e)&&uc(t)}h();d();h();d();var Up=le(xr()),Mp=le(Ve());h();d();function cn(e){return e.default||e}async function Vo(e){if(Qt(e,bt.SOLANA_MAINNET)){let n=await import("./SolWallet-6IEERDZZ.js"),{SolWallet:i}=cn(n);return new i}else if(Qt(e,bt.STARKNET_MAINNET)){let n=await import("./StarknetWallet-3OSCC5PT.js"),{StarknetWallet:i}=cn(n);return new i}else if(Qt(e,bt.SUI_MAINNET)){let n=await import("./SuiWallet-2F7QTSRF.js"),{SuiWallet:i}=cn(n);return new i}else if(Qt(e,bt.TRON_MAINNET)){let n=await import("./TrxWallet-E6MIOUEV.js"),{TrxWallet:i}=cn(n);return new i}else if(Qt(e,bt.TON_MAINNET)){let n=await import("./TonWallet-J3OCEOWD.js"),{TonWallet:i}=cn(n);return new i}let t=await import("./EthWallet-EH5BUZZK.js"),{EthWallet:r}=cn(t);return new r}function wm(e){let t=!1;try{(0,Up.toOutputScript)(e,Mp.bitcoin)&&(t=!0)}catch{t=!1}return t}async function bm(e,t){return bt.BTC_MAINNET===e?wm(t):(await(await Vo(e)).validAddress({address:t})).isValid}h();d();Ur();var Em="dex-market",Dp="dex-market-v3";var Fp={subscribe:"subscribe",unsubscribe:"unsubscribe"};var Tm=e=>e?e==="1"?Dp:Em:Dp,Xo=class{constructor(){this.initEventList=()=>{this.errorHandlerList=new Set,this.connectedHandleList=new Set,this.eventList=new Map};this.getConnectUrl=()=>{let t="";return Zt()?process.env.ASSETS_BUILD_TYPE==="dev"||process.env.ASSETS_BUILD_TYPE==="daily"?t="wss://wsdexpre.coinall.ltd:8443":t=`wss://${ei.global?.getWssHostname()}`:t=Zn.socketBaseUrls?.dex,`${t||""}/ws/v5/ipublic`};this.connect=(t=()=>{})=>{if($n())return;if(this.initDone){t();return}this.initDone=!0;let r=localStorage.getItem("dev_ct_wsPress");this.wsInstance||(this.wsInstance=new bi({connectUrl:r||this.getConnectUrl(),reconnectTime:1e4,maxPendingTime:2e4})),this.setCallbacks(),this.wsInstance.onSocketConnected(t),this.wsInstance.connect()};this.setCallbacks=()=>{this.wsInstance.onSocketConnected(this.connectedCallback),this.wsInstance.onSocketError(this.errorCallback),this.wsInstance.onPushDiscontinue(()=>{this.wsInstance.sendChannel("ping")}),this.wsInstance.setPushDataResolver(t=>this.dataCallback(t))};this.connectedCallback=()=>{this.connectedHandleList.forEach(t=>{t()}),this.cacheArgs.forEach(t=>{try{this.subscribe(JSON.parse(t))}catch{this.subscribe(t)}})};this.errorCallback=t=>{this.errorHandlerList.forEach(r=>{r(t)})};this.dataCallback=t=>{this.dataHandler(t)};this.dataHandler=t=>{let{arg:r}=t,n=r?.channel,i=this.eventList.get(n);i?.size>0&&i.forEach(s=>{s(t)})};this.cacheArgs=new Set;this.subscribe=t=>{let r=Array.isArray(t)?t:[t];r.forEach(n=>{this.cacheArgs.add(JSON.stringify(n))}),this.isConnected()&&this.wsInstance.sendChannel(JSON.stringify({op:Fp.subscribe,args:r}))};this.unsubscribe=t=>{let r=Array.isArray(t)?t:[t];r.forEach(n=>{this.cacheArgs.delete(JSON.stringify(n))}),this.isConnected()&&this.wsInstance.sendChannel(JSON.stringify({op:Fp.unsubscribe,args:r}))};this.addListen=(t,r)=>t==="error"?(this.errorHandlerList.add(r),null):t==="connected"?(this.connectedHandleList.add(r),null):(this.eventList.has(t)||this.eventList.set(t,new Set),this.eventList.get(t).add(r),()=>{this.removeListen(t,r)});this.addConnected=t=>(this.connectedHandleList.add(t),()=>{this.connectedHandleList.delete(t)});this.addListenError=t=>(this.errorHandlerList.add(()=>{t()}),()=>{this.errorHandlerList.delete(t)});this.removeListen=(t,r=()=>{})=>{if(t==="error"){this.errorHandlerList.delete(r);return}if(t==="connected"){this.connectedHandleList.delete(r);return}this.eventList.has(t)&&this.eventList.get(t).delete(r)};this.genTokensArgs=t=>Array.isArray(t)?t.map(r=>({channel:Tm(r?.isTxPrice),chainId:r?.chainId,tokenAddress:r?.tokenContractAddress})):[];this.isConnected=()=>!!this.wsInstance?.isConnected();this.disconnect=()=>{this.wsInstance?.disconnect(),this.initEventList()};this.wsInstance=null,this.initEventList(),this.initDone=!1}},fn=new Xo;h();d();Yt();var KA=({subscribeParams:e,onSubscribeSuccess:t,onListenData:r,onListenError:n,onListenReconnected:i})=>{let s=Array.isArray(e)?e:[e];if(s.length<=0||!e)return()=>{};fn.subscribe(s);let a=Qo(s.map(c=>c.channel)).map(c=>{let p=!1;return fn.addListen(c,_=>{let{data:g,event:S,arg:y}=_;if(S==="subscribe"){t?.(c),p=!0;return}!g||!p||r?.(g,y)})}),l=fn.addListenError(c=>{n?.(c)}),u=fn.addConnected(()=>{i?.()});return()=>{fn.unsubscribe(s),a.forEach(c=>{c?.()}),l(),u()}};export{Wa as a,Va as b,oc as c,kI as d,Mm as e,Es as f,sh as g,oh as h,tE as i,Xa as j,ah as k,dE as l,xa as m,Jw as n,sb as o,bm as p,er as q,xb as r,MI as s,DI as t,cc as u,Xh as v,FI as w,Dp as x,fn as y,KA as z,dt as A,Lb as B,Ub as C,Mb as D,ui as E,Ts as F,wE as G,Ye as H,Dt as I,Is as J,fi as K,vs as L,jm as M};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-6G5SGP4W.js.map
